(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[4],{wkTd:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return ac})),n.d(e,"b",(function(){return oc})),n.d(e,"c",(function(){return A})),n.d(e,"d",(function(){return rc})),n.d(e,"e",(function(){return uc})),n.d(e,"f",(function(){return pc})),n.d(e,"g",(function(){return lc})),n.d(e,"h",(function(){return ga})),n.d(e,"i",(function(){return dc})),n.d(e,"j",(function(){return mc})),n.d(e,"k",(function(){return ma})),n.d(e,"l",(function(){return yc})),n.d(e,"m",(function(){return bc})),n.d(e,"n",(function(){return sc})),n.d(e,"o",(function(){return Ss})),n.d(e,"p",(function(){return nc})),n.d(e,"q",(function(){return wc})),n.d(e,"r",(function(){return M}));var r=n("q/0M"),i=n("qOnz"),o=n("x7I3"),u=n("mrSG"),s=new r.b("@firebase/firestore");function a(){return s.logLevel}function c(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(s.logLevel<=r.a.DEBUG){var i=e.map(l);s.debug.apply(s,Object(u.g)(["Firestore (8.2.1): "+t],i))}}function h(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(s.logLevel<=r.a.ERROR){var i=e.map(l);s.error.apply(s,Object(u.g)(["Firestore (8.2.1): "+t],i))}}function f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(s.logLevel<=r.a.WARN){var i=e.map(l);s.warn.apply(s,Object(u.g)(["Firestore (8.2.1): "+t],i))}}function l(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function p(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.2.1) INTERNAL ASSERTION FAILED: "+t;throw h(e),new Error(e)}function d(t,e){t||p()}function v(t,e){return t}function y(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var m=function(){function t(){}return t.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=y(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function g(t,e){return t<e?-1:t>e?1:0}function b(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function w(t){return t+"\0"}var I=function(){function t(t){this.i=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.i,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.i)},t.prototype.o=function(){return 2*this.i.length},t.prototype.u=function(t){return g(this.i,t.i)},t.prototype.isEqual=function(t){return this.i===t.i},t}();I.h=new I("");var _={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},E=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(u.c)(e,t),e}(Error),O=function(){function t(t){this.l=t}return t.fromBase64String=function(e){try{return new t(I.fromBase64String(e))}catch(e){throw new E(_.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(I.fromUint8Array(e))},t.prototype.toBase64=function(){return this.l.toBase64()},t.prototype.toUint8Array=function(){return this.l.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.l.isEqual(t.l)},t}(),T=function(t){this._=t};function N(){if("undefined"==typeof Uint8Array)throw new E(_.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function j(){if("undefined"==typeof atob)throw new E(_.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.fromBase64String=function(t){return j(),new e(O.fromBase64String(t))},e.fromUint8Array=function(t){return N(),new e(O.fromUint8Array(t))},e.prototype.toBase64=function(){return j(),this._.toBase64()},e.prototype.toUint8Array=function(){return N(),this._.toUint8Array()},e.prototype.isEqual=function(t){return this._.isEqual(t._)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(T),S=function(t,e,n,r,i,o){this.T=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.I=o},x=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"m",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),D=function(){function t(t){this.uid=t}return t.prototype.A=function(){return null!=this.uid},t.prototype.R=function(){return this.A()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();D.UNAUTHENTICATED=new D(null),D.P=new D("google-credentials-uid"),D.g=new D("first-party-uid");var k=function(t,e){this.user=e,this.type="OAuth",this.V={},this.V.Authorization="Bearer "+t},P=function(){function t(){this.p=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.v=function(){},t.prototype.S=function(t){this.p=t,t(D.UNAUTHENTICATED)},t.prototype.D=function(){this.p=null},t}(),C=function(){function t(t){var e=this;this.C=null,this.currentUser=D.UNAUTHENTICATED,this.N=!1,this.F=0,this.p=null,this.forceRefresh=!1,this.C=function(){e.F++,e.currentUser=e.O(),e.N=!0,e.p&&e.p(e.currentUser)},this.F=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.C):(this.C(null),t.get().then((function(t){e.auth=t,e.C&&e.auth.addAuthTokenListener(e.C)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.F,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.F!==e?(c("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(d("string"==typeof n.accessToken),new k(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.v=function(){this.forceRefresh=!0},t.prototype.S=function(t){this.p=t,this.N&&t(this.currentUser)},t.prototype.D=function(){this.auth&&this.auth.removeAuthTokenListener(this.C),this.C=null,this.p=null},t.prototype.O=function(){var t=this.auth&&this.auth.getUid();return d(null===t||"string"==typeof t),new D(t)},t}(),L=function(){function t(t,e){this.k=t,this.M=e,this.type="FirstParty",this.user=D.g}return Object.defineProperty(t.prototype,"V",{get:function(){var t={"X-Goog-AuthUser":this.M},e=this.k.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),R=function(){function t(t,e){this.k=t,this.M=e}return t.prototype.getToken=function(){return Promise.resolve(new L(this.k,this.M))},t.prototype.S=function(t){t(D.g)},t.prototype.D=function(){},t.prototype.v=function(){},t}(),V=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.L=function(t){return n.$(t)},this.B=function(t){return e.q(t)})}return t.prototype.$=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.B&&this.B(t),t},t}();V.U=-1;var M=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new E(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new E(_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new E(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new E(_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.K=function(t){return this.seconds===t.seconds?g(this.nanoseconds,t.nanoseconds):g(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),U=function(){function t(t){this.timestamp=t}return t.W=function(e){return new t(e)},t.min=function(){return new t(new M(0,0))},t.prototype.u=function(t){return this.timestamp.K(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.j=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.G=function(){return this.timestamp},t}(),q=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&p(),void 0===n?n=t.length-e:n>t.length-e&&p(),this.segments=t,this.offset=e,this.H=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.H},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.J(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.Y(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.X=function(t){return t=void 0===t?1:t,this.Y(this.segments,this.offset+t,this.length-t)},t.prototype.Z=function(){return this.Y(this.segments,this.offset,this.length-1)},t.prototype.tt=function(){return this.segments[this.offset]},t.prototype.et=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.nt=function(){return 0===this.length},t.prototype.st=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.it=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.rt=function(){return this.segments.slice(this.offset,this.limit())},t.J=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.Y=function(t,n,r){return new e(t,n,r)},e.prototype.ot=function(){return this.rt().join("/")},e.prototype.toString=function(){return this.ot()},e.ct=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var u=o[i];if(u.indexOf("//")>=0)throw new E(_.INVALID_ARGUMENT,"Invalid segment ("+u+"). Paths must not contain // in them.");r.push.apply(r,u.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.at=function(){return new e([])},e}(q),z=/^[_a-zA-Z][_a-zA-Z0-9]*$/,G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.Y=function(t,n,r){return new e(t,n,r)},e.ut=function(t){return z.test(t)},e.prototype.ot=function(){return this.rt().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.ut(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.ot()},e.prototype.ht=function(){return 1===this.length&&"__name__"===this.get(0)},e.lt=function(){return new e(["__name__"])},e._t=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new E(_.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},u=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new E(_.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[i+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new E(_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=a,i+=2}else"`"===s?(u=!u,i++):"."!==s||u?(r+=s,i++):(o(),i++)}if(o(),u)throw new E(_.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.at=function(){return new e([])},e}(q),B=function(){function t(t){this.path=t}return t.ft=function(e){return new t(F.ct(e))},t.dt=function(e){return new t(F.ct(e).X(5))},t.prototype.wt=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===F.J(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.J=function(t,e){return F.J(t.path,e.path)},t.Et=function(t){return t.length%2==0},t.Tt=function(e){return new t(new F(e.slice()))},t}();function K(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function H(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function J(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var W=function(){function t(t){this.fields=t,t.sort(G.J)}return t.prototype.It=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].st(t))return!0;return!1},t.prototype.isEqual=function(t){return b(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Q=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Y(t){if(d(!!t),"string"==typeof t){var e=0,n=Q.exec(t);if(d(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:$(t.seconds),nanos:$(t.nanos)}}function $(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function X(t){return"string"==typeof t?I.fromBase64String(t):I.fromUint8Array(t)}function Z(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function tt(t){var e=Y(t.mapValue.fields.__local_write_time__.timestampValue);return new M(e.seconds,e.nanos)}function et(t){return null==t}function nt(t){return 0===t&&1/t==-1/0}function rt(t){return"number"==typeof t&&Number.isInteger(t)&&!nt(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function it(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Z(t)?4:10:p()}function ot(t,e){var n=it(t);if(n!==it(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return tt(t).isEqual(tt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Y(t.timestampValue),r=Y(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return X(t.bytesValue).isEqual(X(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return $(t.geoPointValue.latitude)===$(e.geoPointValue.latitude)&&$(t.geoPointValue.longitude)===$(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return $(t.integerValue)===$(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=$(t.doubleValue),r=$(e.doubleValue);return n===r?nt(n)===nt(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return b(t.arrayValue.values||[],e.arrayValue.values||[],ot);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(K(n)!==K(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ot(n[i],r[i])))return!1;return!0}(t,e);default:return p()}}function ut(t,e){return void 0!==(t.values||[]).find((function(t){return ot(t,e)}))}function st(t,e){var n=it(t),r=it(e);if(n!==r)return g(n,r);switch(n){case 0:return 0;case 1:return g(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=$(t.integerValue||t.doubleValue),r=$(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return at(t.timestampValue,e.timestampValue);case 4:return at(tt(t),tt(e));case 5:return g(t.stringValue,e.stringValue);case 6:return function(t,e){var n=X(t),r=X(e);return n.u(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=g(n[i],r[i]);if(0!==o)return o}return g(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=g($(t.latitude),$(e.latitude));return 0!==n?n:g($(t.longitude),$(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=st(n[i],r[i]);if(o)return o}return g(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var u=0;u<r.length&&u<o.length;++u){var s=g(r[u],o[u]);if(0!==s)return s;var a=st(n[r[u]],i[o[u]]);if(0!==a)return a}return g(r.length,o.length)}(t.mapValue,e.mapValue);default:throw p()}}function at(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return g(t,e);var n=Y(t),r=Y(e),i=g(n.seconds,r.seconds);return 0!==i?i:g(n.nanos,r.nanos)}function ct(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){var e=Y(t);return"time("+e.seconds+","+e.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?X(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,B.dt(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var u=o[i];r?r=!1:n+=",",n+=u+":"+t(e.fields[u])}return n+"}"}(e.mapValue):p();var n,r}(t)}function ht(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.ot()}}function ft(t){return!!t&&"integerValue"in t}function lt(t){return!!t&&"arrayValue"in t}function pt(t){return!!t&&"nullValue"in t}function dt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function vt(t){return!!t&&"mapValue"in t}var yt=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.nt())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!vt(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.et()])||null},t.prototype.isEqual=function(t){return ot(this.proto,t.proto)},t}(),mt=function(){function t(t){void 0===t&&(t=yt.empty()),this.At=t,this.Rt=new Map}return t.prototype.set=function(t,e){return this.Pt(t,e),this},t.prototype.delete=function(t){return this.Pt(t,null),this},t.prototype.Pt=function(t,e){for(var n=this.Rt,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===it(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.et(),e)},t.prototype.yt=function(){var t=this.gt(G.at(),this.Rt);return null!=t?new yt(t):this.At},t.prototype.gt=function(t,e){var n=this,r=!1,i=this.At.field(t),o=vt(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var u=n.gt(t.child(i),e);null!=u&&(o[i]=u,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function gt(t){var e=[];return H(t.fields||{},(function(t,n){var r=new G([t]);if(vt(n)){var i=gt(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,u=i;o<u.length;o++){var s=u[o];e.push(r.child(s))}}else e.push(r)})),new W(e)}var bt=function(t,e){this.key=t,this.version=e},wt=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).Vt=r,o.bt=!!i.bt,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return Object(u.c)(e,t),e.prototype.field=function(t){return this.Vt.field(t)},e.prototype.data=function(){return this.Vt},e.prototype.vt=function(){return this.Vt.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.bt===t.bt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Vt.isEqual(t.Vt)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Vt.toString()+", {hasLocalMutations: "+this.bt+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.bt||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(bt),It=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Object(u.c)(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(bt),_t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(bt),Et=function(t,e,n,r,i,o,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=u,this.St=null};function Ot(t,e,n,r,i,o,u){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=null),new Et(t,e,n,r,i,o,u)}function Tt(t){var e=v(t);if(null===e.St){var n=e.path.ot();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.ot()+t.op.toString()+ct(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.ot()+t.dir}(t)})).join(","),et(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Mt(e.startAt)),e.endAt&&(n+="|ub:",n+=Mt(e.endAt)),e.St=n}return e.St}function Nt(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!qt(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!ot(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!zt(t.startAt,e.startAt)&&zt(t.endAt,e.endAt)}function jt(t){return B.Et(t.path)&&null===t.collectionGroup&&0===t.filters.length}var At=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(u.c)(e,t),e.create=function(t,n,r){return t.ht()?"in"===n||"not-in"===n?this.Dt(t,n,r):new St(t,n,r):"array-contains"===n?new Pt(t,r):"in"===n?new Ct(t,r):"not-in"===n?new Lt(t,r):"array-contains-any"===n?new Rt(t,r):new e(t,n,r)},e.Dt=function(t,e,n){return"in"===e?new xt(t,n):new Dt(t,n)},e.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.Ct(st(e,this.value)):null!==e&&it(this.value)===it(e)&&this.Ct(st(e,this.value))},e.prototype.Ct=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return p()}},e.prototype.xt=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),St=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=B.dt(r.referenceValue),i}return Object(u.c)(e,t),e.prototype.matches=function(t){var e=B.J(t.key,this.key);return this.Ct(e)},e}(At),xt=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=kt("in",n),r}return Object(u.c)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(At),Dt=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=kt("not-in",n),r}return Object(u.c)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(At);function kt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return B.dt(t.referenceValue)}))}var Pt=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(u.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return lt(e)&&ut(e.arrayValue,this.value)},e}(At),Ct=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(u.c)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&ut(this.value.arrayValue,e)},e}(At),Lt=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(u.c)(e,t),e.prototype.matches=function(t){if(ut(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!ut(this.value.arrayValue,e)},e}(At),Rt=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(u.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!lt(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return ut(e.value.arrayValue,t)}))},e}(At),Vt=function(t,e){this.position=t,this.before=e};function Mt(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return ct(t)})).join(",")}var Ut=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function qt(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ft(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],u=t.position[i];if(r=o.field.ht()?B.J(B.dt(u.referenceValue),n.key):st(u,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function zt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ot(t.position[n],e.position[n]))return!1;return!0}var Gt=function(t,e,n,r,i,o,u,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===u&&(u=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.Nt=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=u,this.endAt=s,this.Ft=null,this.Ot=null,this.startAt,this.endAt};function Bt(t,e,n,r,i,o,u,s){return new Gt(t,e,n,r,i,o,u,s)}function Kt(t){return new Gt(t)}function Ht(t){return!et(t.limit)&&"F"===t.limitType}function Jt(t){return!et(t.limit)&&"L"===t.limitType}function Wt(t){return t.Nt.length>0?t.Nt[0].field:null}function Qt(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.xt())return r.field}return null}function Yt(t){return null!==t.collectionGroup}function $t(t){var e=v(t);if(null===e.Ft){e.Ft=[];var n=Qt(e),r=Wt(e);if(null!==n&&null===r)n.ht()||e.Ft.push(new Ut(n)),e.Ft.push(new Ut(G.lt(),"asc"));else{for(var i=!1,o=0,u=e.Nt;o<u.length;o++){var s=u[o];e.Ft.push(s),s.field.ht()&&(i=!0)}if(!i){var a=e.Nt.length>0?e.Nt[e.Nt.length-1].dir:"asc";e.Ft.push(new Ut(G.lt(),a))}}}return e.Ft}function Xt(t){var e=v(t);if(!e.Ot)if("F"===e.limitType)e.Ot=Ot(e.path,e.collectionGroup,$t(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=$t(e);r<i.length;r++){var o=i[r],u="desc"===o.dir?"asc":"desc";n.push(new Ut(o.field,u))}var s=e.endAt?new Vt(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Vt(e.startAt.position,!e.startAt.before):null;e.Ot=Ot(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.Ot}function Zt(t,e,n){return new Gt(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function te(t,e){return Nt(Xt(t),Xt(e))&&t.limitType===e.limitType}function ee(t){return Tt(Xt(t))+"|lt:"+t.limitType}function ne(t){return"Query(target="+function(t){var e=t.path.ot();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.ot()+" "+e.op+" "+ct(e.value);var e})).join(", ")+"]"),et(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.ot()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Mt(t.startAt)),t.endAt&&(e+=", endAt: "+Mt(t.endAt)),"Target("+e+")"}(Xt(t))+"; limitType="+t.limitType+")"}function re(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.wt(t.collectionGroup)&&t.path.st(n):B.Et(t.path)?t.path.isEqual(n):t.path.it(n)}(t,e)&&function(t,e){for(var n=0,r=t.Nt;n<r.length;n++){var i=r[n];if(!i.field.ht()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Ft(t.startAt,$t(t),e))&&(!t.endAt||!Ft(t.endAt,$t(t),e))}(t,e)}function ie(t){return function(e,n){for(var r=!1,i=0,o=$t(t);i<o.length;i++){var u=o[i],s=oe(u,e,n);if(0!==s)return s;r=r||u.field.ht()}return 0}}function oe(t,e,n){var r=t.field.ht()?B.J(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?st(r,i):p()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return p()}}var ue=function(){function t(t,e,n,r,i,o,u){void 0===i&&(i=U.min()),void 0===o&&(o=U.min()),void 0===u&&(u=I.h),this.target=t,this.targetId=e,this.kt=n,this.sequenceNumber=r,this.Mt=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u}return t.prototype.Lt=function(e){return new t(this.target,this.targetId,this.kt,e,this.Mt,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.$t=function(e,n){return new t(this.target,this.targetId,this.kt,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.Bt=function(e){return new t(this.target,this.targetId,this.kt,this.sequenceNumber,this.Mt,e,this.resumeToken)},t}();function se(t,e){if(t.qt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nt(e)?"-0":e}}function ae(t){return{integerValue:""+t}}function ce(t,e){return rt(e)?ae(e):se(t,e)}var he=function(){this.Ut=void 0};function fe(t,e,n){return t instanceof de?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ve?ye(t,e):t instanceof me?ge(t,e):function(t,e){var n=pe(t,e),r=we(n)+we(t.Qt);return ft(n)&&ft(t.Qt)?ae(r):se(t.Kt,r)}(t,e)}function le(t,e,n){return t instanceof ve?ye(t,e):t instanceof me?ge(t,e):n}function pe(t,e){return t instanceof be?ft(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var de=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e}(he),ve=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(u.c)(e,t),e}(he);function ye(t,e){for(var n=Ie(e),r=function(t){n.some((function(e){return ot(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var me=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(u.c)(e,t),e}(he);function ge(t,e){for(var n=Ie(e),r=function(t){n=n.filter((function(e){return!ot(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var be=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Kt=e,r.Qt=n,r}return Object(u.c)(e,t),e}(he);function we(t){return $(t.integerValue||t.doubleValue)}function Ie(t){return lt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var _e=function(t,e){this.field=t,this.transform=e},Ee=function(t,e){this.version=t,this.transformResults=e},Oe=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.Wt=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"jt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Te(t,e){return void 0!==t.updateTime?e instanceof wt&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof wt}var Ne=function(){};function je(t,e,n){return t instanceof ke?function(t,e,n){var r=t.value;if(n.transformResults){var i=Le(t.fieldTransforms,e,n.transformResults);r=Ve(t.fieldTransforms,r,i)}return new wt(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Pe?function(t,e,n){if(!Te(t.Gt,e))return new _t(t.key,n.version);var r=Ce(t,e,n.transformResults?Le(t.fieldTransforms,e,n.transformResults):[]);return new wt(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new It(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Ae(t,e,n,r){return t instanceof ke?function(t,e,n,r){if(!Te(t.Gt,e))return e;var i=t.value;if(t.fieldTransforms){var o=Re(t.fieldTransforms,n,e,r);i=Ve(t.fieldTransforms,i,o)}var u=De(e);return new wt(t.key,u,i,{bt:!0})}(t,e,r,n):t instanceof Pe?function(t,e,n,r){if(!Te(t.Gt,e))return e;var i=De(e),o=Ce(t,e,Re(t.fieldTransforms,n,e,r));return new wt(t.key,i,o,{bt:!0})}(t,e,r,n):function(t,e){return Te(t.Gt,e)?new It(t.key,U.min()):e}(t,e)}function Se(t,e){return void 0!==t.fieldTransforms?function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],u=e instanceof wt?e.field(o.field):void 0,s=pe(o.transform,u||null);null!=s&&(n=null==n?(new mt).set(o.field,s):n.set(o.field,s))}return n?n.yt():null}(t.fieldTransforms,e):null}function xe(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Gt.isEqual(e.Gt)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&b(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ve&&e instanceof ve||t instanceof me&&e instanceof me?b(t.elements,e.elements,ot):t instanceof be&&e instanceof be?ot(t.Qt,e.Qt):t instanceof de&&e instanceof de}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.zt.isEqual(e.zt))}function De(t){return t instanceof wt?t.version:U.min()}var ke=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.Gt=r,o.fieldTransforms=i,o.type=0,o}return Object(u.c)(e,t),e}(Ne),Pe=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var u=this;return(u=t.call(this)||this).key=e,u.data=n,u.zt=r,u.Gt=i,u.fieldTransforms=o,u.type=1,u}return Object(u.c)(e,t),e}(Ne);function Ce(t,e,n){var r;return r=function(t,e){var n=new mt(e);return t.zt.fields.forEach((function(e){if(!e.nt()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.yt()}(t,r=e instanceof wt?e.data():yt.empty()),Ve(t.fieldTransforms,r,n)}function Le(t,e,n){var r=[];d(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],u=o.transform,s=null;e instanceof wt&&(s=e.field(o.field)),r.push(le(u,s,n[i]))}return r}function Re(t,e,n,r){for(var i=[],o=0,u=t;o<u.length;o++){var s=u[o],a=s.transform,c=null;n instanceof wt&&(c=n.field(s.field)),null===c&&r instanceof wt&&(c=r.field(s.field)),i.push(fe(a,c,e))}return i}function Ve(t,e,n){for(var r=new mt(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.yt()}var Me,Ue,qe=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Gt=n,r.type=2,r.fieldTransforms=[],r}return Object(u.c)(e,t),e}(Ne),Fe=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Gt=n,r.type=3,r.fieldTransforms=[],r}return Object(u.c)(e,t),e}(Ne),ze=function(t){this.count=t};function Ge(t){switch(t){case _.OK:return p();case _.CANCELLED:case _.UNKNOWN:case _.DEADLINE_EXCEEDED:case _.RESOURCE_EXHAUSTED:case _.INTERNAL:case _.UNAVAILABLE:case _.UNAUTHENTICATED:return!1;case _.INVALID_ARGUMENT:case _.NOT_FOUND:case _.ALREADY_EXISTS:case _.PERMISSION_DENIED:case _.FAILED_PRECONDITION:case _.ABORTED:case _.OUT_OF_RANGE:case _.UNIMPLEMENTED:case _.DATA_LOSS:return!0;default:return p()}}function Be(t){if(void 0===t)return h("GRPC error has no .code"),_.UNKNOWN;switch(t){case Me.OK:return _.OK;case Me.CANCELLED:return _.CANCELLED;case Me.UNKNOWN:return _.UNKNOWN;case Me.DEADLINE_EXCEEDED:return _.DEADLINE_EXCEEDED;case Me.RESOURCE_EXHAUSTED:return _.RESOURCE_EXHAUSTED;case Me.INTERNAL:return _.INTERNAL;case Me.UNAVAILABLE:return _.UNAVAILABLE;case Me.UNAUTHENTICATED:return _.UNAUTHENTICATED;case Me.INVALID_ARGUMENT:return _.INVALID_ARGUMENT;case Me.NOT_FOUND:return _.NOT_FOUND;case Me.ALREADY_EXISTS:return _.ALREADY_EXISTS;case Me.PERMISSION_DENIED:return _.PERMISSION_DENIED;case Me.FAILED_PRECONDITION:return _.FAILED_PRECONDITION;case Me.ABORTED:return _.ABORTED;case Me.OUT_OF_RANGE:return _.OUT_OF_RANGE;case Me.UNIMPLEMENTED:return _.UNIMPLEMENTED;case Me.DATA_LOSS:return _.DATA_LOSS;default:return p()}}(Ue=Me||(Me={}))[Ue.OK=0]="OK",Ue[Ue.CANCELLED=1]="CANCELLED",Ue[Ue.UNKNOWN=2]="UNKNOWN",Ue[Ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ue[Ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ue[Ue.NOT_FOUND=5]="NOT_FOUND",Ue[Ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ue[Ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ue[Ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ue[Ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ue[Ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ue[Ue.ABORTED=10]="ABORTED",Ue[Ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ue[Ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ue[Ue.INTERNAL=13]="INTERNAL",Ue[Ue.UNAVAILABLE=14]="UNAVAILABLE",Ue[Ue.DATA_LOSS=15]="DATA_LOSS";var Ke=function(){function t(t,e){this.J=t,this.root=e||Je.EMPTY}return t.prototype.Ht=function(e,n){return new t(this.J,this.root.Ht(e,n,this.J).copy(null,null,Je.Jt,null,null))},t.prototype.remove=function(e){return new t(this.J,this.root.remove(e,this.J).copy(null,null,Je.Jt,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.nt();){var n=this.J(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.nt();){var r=this.J(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.nt=function(){return this.root.nt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.Yt=function(){return this.root.Yt()},t.prototype.Xt=function(){return this.root.Xt()},t.prototype.Zt=function(t){return this.root.Zt(t)},t.prototype.forEach=function(t){this.Zt((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.Zt((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.te=function(t){return this.root.te(t)},t.prototype.ee=function(){return new He(this.root,null,this.J,!1)},t.prototype.ne=function(t){return new He(this.root,t,this.J,!1)},t.prototype.se=function(){return new He(this.root,null,this.J,!0)},t.prototype.ie=function(t){return new He(this.root,t,this.J,!0)},t}(),He=function(){function t(t,e,n,r){this.re=r,this.oe=[];for(var i=1;!t.nt();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.re?t.left:t.right;else{if(0===i){this.oe.push(t);break}this.oe.push(t),t=this.re?t.right:t.left}}return t.prototype.ce=function(){var t=this.oe.pop(),e={key:t.key,value:t.value};if(this.re)for(t=t.left;!t.nt();)this.oe.push(t),t=t.right;else for(t=t.right;!t.nt();)this.oe.push(t),t=t.left;return e},t.prototype.ae=function(){return this.oe.length>0},t.prototype.ue=function(){if(0===this.oe.length)return null;var t=this.oe[this.oe.length-1];return{key:t.key,value:t.value}},t}(),Je=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.nt=function(){return!1},t.prototype.Zt=function(t){return this.left.Zt(t)||t(this.key,this.value)||this.right.Zt(t)},t.prototype.te=function(t){return this.right.te(t)||t(this.key,this.value)||this.left.te(t)},t.prototype.min=function(){return this.left.nt()?this:this.left.min()},t.prototype.Yt=function(){return this.min().key},t.prototype.Xt=function(){return this.right.nt()?this.key:this.right.Xt()},t.prototype.Ht=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.Ht(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.Ht(t,e,n))).he()},t.prototype.le=function(){if(this.left.nt())return t.EMPTY;var e=this;return e.left._e()||e.left.left._e()||(e=e.fe()),(e=e.copy(null,null,null,e.left.le(),null)).he()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.nt()||i.left._e()||i.left.left._e()||(i=i.fe()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left._e()&&(i=i.de()),i.right.nt()||i.right._e()||i.right.left._e()||(i=i.we()),0===n(e,i.key)){if(i.right.nt())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.le())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.he()},t.prototype._e=function(){return this.color},t.prototype.he=function(){var t=this;return t.right._e()&&!t.left._e()&&(t=t.Ee()),t.left._e()&&t.left.left._e()&&(t=t.de()),t.left._e()&&t.right._e()&&(t=t.Te()),t},t.prototype.fe=function(){var t=this.Te();return t.right.left._e()&&(t=(t=(t=t.copy(null,null,null,null,t.right.de())).Ee()).Te()),t},t.prototype.we=function(){var t=this.Te();return t.left.left._e()&&(t=(t=t.de()).Te()),t},t.prototype.Ee=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.de=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.Te=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Ie=function(){var t=this.me();return Math.pow(2,t)<=this.size+1},t.prototype.me=function(){if(this._e()&&this.left._e())throw p();if(this.right._e())throw p();var t=this.left.me();if(t!==this.right.me())throw p();return t+(this._e()?0:1)},t}();Je.EMPTY=null,Je.RED=!0,Je.Jt=!1,Je.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw p()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw p()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw p()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw p()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw p()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.Ht=function(t,e,n){return new Je(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.nt=function(){return!0},t.prototype.Zt=function(t){return!1},t.prototype.te=function(t){return!1},t.prototype.Yt=function(){return null},t.prototype.Xt=function(){return null},t.prototype._e=function(){return!1},t.prototype.Ie=function(){return!0},t.prototype.me=function(){return 0},t}());var We=function(){function t(t){this.J=t,this.data=new Ke(this.J)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.Yt()},t.prototype.last=function(){return this.data.Xt()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.Zt((function(e,n){return t(e),!1}))},t.prototype.Ae=function(t,e){for(var n=this.data.ne(t[0]);n.ae();){var r=n.ce();if(this.J(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Re=function(t,e){var n;for(n=void 0!==e?this.data.ne(e):this.data.ee();n.ae();)if(!t(n.ce().key))return},t.prototype.Pe=function(t){var e=this.data.ne(t);return e.ae()?e.ce().key:null},t.prototype.ee=function(){return new Qe(this.data.ee())},t.prototype.ne=function(t){return new Qe(this.data.ne(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).Ht(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.nt=function(){return this.data.nt()},t.prototype.ye=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.ee(),r=e.data.ee();n.ae();){var i=n.ce().key,o=r.ce().key;if(0!==this.J(i,o))return!1}return!0},t.prototype.rt=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.J);return n.data=e,n},t}(),Qe=function(){function t(t){this.ge=t}return t.prototype.ce=function(){return this.ge.ce().key},t.prototype.ae=function(){return this.ge.ae()},t}(),Ye=new Ke(B.J);function $e(){return Ye}function Xe(){return $e()}var Ze=new Ke(B.J);function tn(){return Ze}var en=new Ke(B.J);function nn(){return en}var rn=new We(B.J);function on(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=rn,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var un=new We(g);function sn(){return un}var an=function(){function t(t){this.J=t?function(e,n){return t(e,n)||B.J(e.key,n.key)}:function(t,e){return B.J(t.key,e.key)},this.Ve=tn(),this.pe=new Ke(this.J)}return t.be=function(e){return new t(e.J)},t.prototype.has=function(t){return null!=this.Ve.get(t)},t.prototype.get=function(t){return this.Ve.get(t)},t.prototype.first=function(){return this.pe.Yt()},t.prototype.last=function(){return this.pe.Xt()},t.prototype.nt=function(){return this.pe.nt()},t.prototype.indexOf=function(t){var e=this.Ve.get(t);return e?this.pe.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.pe.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.pe.Zt((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ve.Ht(t.key,t),e.pe.Ht(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ve.remove(t),this.pe.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.pe.ee(),r=e.pe.ee();n.ae();){var i=n.ce().key,o=r.ce().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.J=this.J,r.Ve=e,r.pe=n,r},t}(),cn=function(){function t(){this.ve=new Ke(B.J)}return t.prototype.track=function(t){var e=t.doc.key,n=this.ve.get(e);n?0!==t.type&&3===n.type?this.ve=this.ve.Ht(e,t):3===t.type&&1!==n.type?this.ve=this.ve.Ht(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ve=this.ve.Ht(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ve=this.ve.Ht(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ve=this.ve.remove(e):1===t.type&&2===n.type?this.ve=this.ve.Ht(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ve=this.ve.Ht(e,{type:2,doc:t.doc}):p():this.ve=this.ve.Ht(e,t)},t.prototype.Se=function(){var t=[];return this.ve.Zt((function(e,n){t.push(n)})),t},t}(),hn=function(){function t(t,e,n,r,i,o,u,s){this.query=t,this.docs=e,this.De=n,this.docChanges=r,this.Ce=i,this.fromCache=o,this.xe=u,this.Ne=s}return t.Fe=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,an.be(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.Ce.nt()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.xe===t.xe&&this.Ce.isEqual(t.Ce)&&te(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.De.isEqual(t.De)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),fn=function(){function t(t,e,n,r,i){this.Mt=t,this.Oe=e,this.ke=n,this.Me=r,this.Le=i}return t.$e=function(e,n){var r=new Map;return r.set(e,ln.Be(e,n)),new t(U.min(),r,sn(),$e(),on())},t}(),ln=function(){function t(t,e,n,r,i){this.resumeToken=t,this.qe=e,this.Ue=n,this.Qe=r,this.Ke=i}return t.Be=function(e,n){return new t(I.h,n,on(),on(),on())},t}(),pn=function(t,e,n,r){this.We=t,this.removedTargetIds=e,this.key=n,this.je=r},dn=function(t,e){this.targetId=t,this.Ge=e},vn=function(t,e,n,r){void 0===n&&(n=I.h),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},yn=function(){function t(){this.ze=0,this.He=bn(),this.Je=I.h,this.Ye=!1,this.Xe=!0}return Object.defineProperty(t.prototype,"qe",{get:function(){return this.Ye},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.Je},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Ze",{get:function(){return 0!==this.ze},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tn",{get:function(){return this.Xe},enumerable:!1,configurable:!0}),t.prototype.en=function(t){t.o()>0&&(this.Xe=!0,this.Je=t)},t.prototype.nn=function(){var t=on(),e=on(),n=on();return this.He.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:p()}})),new ln(this.Je,this.Ye,t,e,n)},t.prototype.sn=function(){this.Xe=!1,this.He=bn()},t.prototype.rn=function(t,e){this.Xe=!0,this.He=this.He.Ht(t,e)},t.prototype.on=function(t){this.Xe=!0,this.He=this.He.remove(t)},t.prototype.cn=function(){this.ze+=1},t.prototype.an=function(){this.ze-=1},t.prototype.un=function(){this.Xe=!0,this.Ye=!0},t}(),mn=function(){function t(t){this.hn=t,this.ln=new Map,this._n=$e(),this.fn=gn(),this.dn=new We(g)}return t.prototype.wn=function(t){for(var e=0,n=t.We;e<n.length;e++){var r=n[e];t.je instanceof wt?this.En(r,t.je):t.je instanceof It&&this.Tn(r,t.key,t.je)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.Tn(r,t.key,t.je)},t.prototype.In=function(t){var e=this;this.mn(t,(function(n){var r=e.An(n);switch(t.state){case 0:e.Rn(n)&&r.en(t.resumeToken);break;case 1:r.an(),r.Ze||r.sn(),r.en(t.resumeToken);break;case 2:r.an(),r.Ze||e.removeTarget(n);break;case 3:e.Rn(n)&&(r.un(),r.en(t.resumeToken));break;case 4:e.Rn(n)&&(e.Pn(n),r.en(t.resumeToken));break;default:p()}}))},t.prototype.mn=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.ln.forEach((function(t,r){n.Rn(r)&&e(r)}))},t.prototype.yn=function(t){var e=t.targetId,n=t.Ge.count,r=this.gn(e);if(r){var i=r.target;if(jt(i))if(0===n){var o=new B(i.path);this.Tn(e,o,new It(o,U.min()))}else d(1===n);else this.Vn(e)!==n&&(this.Pn(e),this.dn=this.dn.add(e))}},t.prototype.pn=function(t){var e=this,n=new Map;this.ln.forEach((function(r,i){var o=e.gn(i);if(o){if(r.qe&&jt(o.target)){var u=new B(o.target.path);null!==e._n.get(u)||e.bn(i,u)||e.Tn(i,u,new It(u,t))}r.tn&&(n.set(i,r.nn()),r.sn())}}));var r=on();this.fn.forEach((function(t,n){var i=!0;n.Re((function(t){var n=e.gn(t);return!n||2===n.kt||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new fn(t,n,this.dn,this._n,r);return this._n=$e(),this.fn=gn(),this.dn=new We(g),i},t.prototype.En=function(t,e){if(this.Rn(t)){var n=this.bn(t,e.key)?2:0;this.An(t).rn(e.key,n),this._n=this._n.Ht(e.key,e),this.fn=this.fn.Ht(e.key,this.vn(e.key).add(t))}},t.prototype.Tn=function(t,e,n){if(this.Rn(t)){var r=this.An(t);this.bn(t,e)?r.rn(e,1):r.on(e),this.fn=this.fn.Ht(e,this.vn(e).delete(t)),n&&(this._n=this._n.Ht(e,n))}},t.prototype.removeTarget=function(t){this.ln.delete(t)},t.prototype.Vn=function(t){var e=this.An(t).nn();return this.hn.Sn(t).size+e.Ue.size-e.Ke.size},t.prototype.cn=function(t){this.An(t).cn()},t.prototype.An=function(t){var e=this.ln.get(t);return e||(e=new yn,this.ln.set(t,e)),e},t.prototype.vn=function(t){var e=this.fn.get(t);return e||(e=new We(g),this.fn=this.fn.Ht(t,e)),e},t.prototype.Rn=function(t){var e=null!==this.gn(t);return e||c("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.gn=function(t){var e=this.ln.get(t);return e&&e.Ze?null:this.hn.Dn(t)},t.prototype.Pn=function(t){var e=this;this.ln.set(t,new yn),this.hn.Sn(t).forEach((function(n){e.Tn(t,n,null)}))},t.prototype.bn=function(t,e){return this.hn.Sn(t).has(e)},t}();function gn(){return new Ke(B.J)}function bn(){return new Ke(B.J)}var wn={asc:"ASCENDING",desc:"DESCENDING"},In={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},_n=function(t,e){this.T=t,this.qt=e};function En(t,e){return t.qt?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function On(t,e){return t.qt?e.toBase64():e.toUint8Array()}function Tn(t,e){return En(t,e.G())}function Nn(t){return d(!!t),U.W(function(t){var e=Y(t);return new M(e.seconds,e.nanos)}(t))}function jn(t,e){return function(t){return new F(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).ot()}function An(t){var e=F.ct(t);return d($n(e)),e}function Sn(t,e){return jn(t.T,e.path)}function xn(t,e){var n=An(e);if(n.get(1)!==t.T.projectId)throw new E(_.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.T.projectId);if(n.get(3)!==t.T.database)throw new E(_.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.T.database);return new B(Cn(n))}function Dn(t,e){return jn(t.T,e)}function kn(t){var e=An(t);return 4===e.length?F.at():Cn(e)}function Pn(t){return new F(["projects",t.T.projectId,"databases",t.T.database]).ot()}function Cn(t){return d(t.length>4&&"documents"===t.get(4)),t.X(5)}function Ln(t,e,n){return{name:Sn(t,e),fields:n.proto.mapValue.fields}}function Rn(t,e,n){var r=xn(t,e.name),i=Nn(e.updateTime),o=new yt({mapValue:{fields:e.fields}});return new wt(r,i,o,{hasCommittedMutations:!!n})}function Vn(t,e){var n;if(e instanceof ke)n={update:Ln(t,e.key,e.value)};else if(e instanceof qe)n={delete:Sn(t,e.key)};else if(e instanceof Pe)n={update:Ln(t,e.key,e.data),updateMask:Yn(e.zt)};else{if(!(e instanceof Fe))return p();n={verify:Sn(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof de)return{fieldPath:e.field.ot(),setToServerValue:"REQUEST_TIME"};if(n instanceof ve)return{fieldPath:e.field.ot(),appendMissingElements:{values:n.elements}};if(n instanceof me)return{fieldPath:e.field.ot(),removeAllFromArray:{values:n.elements}};if(n instanceof be)return{fieldPath:e.field.ot(),increment:n.Qt};throw p()}(0,t)}))),e.Gt.jt||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Tn(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:p()}(t,e.Gt)),n}function Mn(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Oe.updateTime(Nn(t.updateTime)):void 0!==t.exists?Oe.exists(t.exists):Oe.Wt()}(e.currentDocument):Oe.Wt(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)d("REQUEST_TIME"===e.setToServerValue),n=new de;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new ve(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new me(i)}else"increment"in e?n=new be(t,e.increment):p();var o=G._t(e.fieldPath);return new _e(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=xn(t,e.update.name),o=new yt({mapValue:{fields:e.update.fields}});if(e.updateMask){var u=function(t){var e=t.fieldPaths||[];return new W(e.map((function(t){return G._t(t)})))}(e.updateMask);return new Pe(i,o,u,n,r)}return new ke(i,o,n,r)}if(e.delete){var s=xn(t,e.delete);return new qe(s,n)}if(e.verify){var a=xn(t,e.verify);return new Fe(a,n)}return p()}function Un(t,e){return{documents:[Dn(t,e.path)]}}function qn(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Dn(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Dn(t,r.Z()),n.structuredQuery.from=[{collectionId:r.et()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(dt(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NAN"}};if(pt(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(dt(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NOT_NAN"}};if(pt(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hn(t.field),op:Kn(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Hn(t.field),direction:Bn(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var u=function(t,e){return t.qt||et(e)?e:{value:e}}(t,e.limit);return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=zn(e.startAt)),e.endAt&&(n.structuredQuery.endAt=zn(e.endAt)),n}function Fn(t){var e=kn(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){d(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var u=[];n.where&&(u=function t(e){return e?void 0!==e.unaryFilter?[Qn(e)]:void 0!==e.fieldFilter?[Wn(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):p():[]}(n.where));var s=[];n.orderBy&&(s=n.orderBy.map((function(t){return function(t){return new Ut(Jn(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return et(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Gn(n.startAt));var h=null;return n.endAt&&(h=Gn(n.endAt)),Bt(e,i,s,u,a,"F",c,h)}function zn(t){return{before:t.before,values:t.position}}function Gn(t){var e=!!t.before,n=t.values||[];return new Vt(n,e)}function Bn(t){return wn[t]}function Kn(t){return In[t]}function Hn(t){return{fieldPath:t.ot()}}function Jn(t){return G._t(t.fieldPath)}function Wn(t){return At.create(Jn(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return p()}}(t.fieldFilter.op),t.fieldFilter.value)}function Qn(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Jn(t.unaryFilter.field);return At.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Jn(t.unaryFilter.field);return At.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Jn(t.unaryFilter.field);return At.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Jn(t.unaryFilter.field);return At.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return p()}}function Yn(t){var e=[];return t.fields.forEach((function(t){return e.push(t.ot())})),{fieldPaths:e}}function $n(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}var Xn=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Zn=function(){function t(t){var e=this;this.Cn=null,this.xn=null,this.result=void 0,this.error=void 0,this.Nn=!1,this.Fn=!1,t((function(t){e.Nn=!0,e.result=t,e.Cn&&e.Cn(t)}),(function(t){e.Nn=!0,e.error=t,e.xn&&e.xn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Fn&&p(),this.Fn=!0,this.Nn?this.error?this.On(n,this.error):this.kn(e,this.result):new t((function(t,i){r.Cn=function(n){r.kn(e,n).next(t,i)},r.xn=function(e){r.On(n,e).next(t,i)}}))},t.prototype.Mn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Ln=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.kn=function(e,n){return e?this.Ln((function(){return e(n)})):t.resolve(n)},t.prototype.On=function(e,n){return e?this.Ln((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.$n=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.Bn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.$n(r)},t}(),tr=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.qn=new Xn,this.transaction.oncomplete=function(){n.qn.resolve()},this.transaction.onabort=function(){e.error?n.qn.reject(new rr(t,e.error)):n.qn.resolve()},this.transaction.onerror=function(e){var r=ar(e.target.error);n.qn.reject(new rr(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new rr(n,e)}},Object.defineProperty(t.prototype,"Un",{get:function(){return this.qn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.qn.reject(t),this.aborted||(c("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new or(e)},t}(),er=function(){function e(t,n,r){this.name=t,this.version=n,this.Qn=r,12.2===e.Kn(Object(i.g)())&&h("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return c("SimpleDb","Removing database:",t),ur(window.indexedDB.deleteDatabase(t)).Mn()},e.Wn=function(){if("undefined"==typeof indexedDB)return!1;if(e.jn())return!0;var t=Object(i.g)(),n=e.Kn(t),r=0<n&&n<10,o=e.Gn(t),u=0<o&&o<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||u)},e.jn=function(){var e;return"undefined"!=typeof t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.zn)},e.Hn=function(t,e){return t.store(e)},e.Kn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},e.Gn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},e.prototype.Jn=function(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n=this;return Object(u.d)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(c("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new rr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new E(_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new rr(t,n))},i.onupgradeneeded=function(t){c("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.Qn.Yn(e,i.transaction,t.oldVersion,n.version).next((function(){c("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.Xn&&(this.db.onversionchange=function(t){return n.Xn(t)}),this.db)]}}))}))},e.prototype.Zn=function(t){this.Xn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},e.prototype.runTransaction=function(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o,s,a,h;return Object(u.d)(this,(function(f){switch(f.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,h,f,l;return Object(u.d)(this,(function(u){switch(u.label){case 0:++o,u.label=1;case 1:return u.trys.push([1,4,,5]),[4,a.Jn(t)];case 2:return a.db=u.sent(),e=tr.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),Zn.reject(t)})).Mn(),h={},s.catch((function(){})),[4,e.Un];case 3:return[2,(h.value=(u.sent(),s),h)];case 4:return f=u.sent(),l="FirebaseError"!==f.name&&o<3,c("SimpleDb","Transaction failed with error:",f.message,"Retrying:",l),a.close(),l?[3,5]:[2,{value:Promise.reject(f)}];case 5:return[2]}}))},a=this,f.label=1;case 1:return[5,s()];case 2:if("object"==typeof(h=f.sent()))return[2,h.value];f.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),nr=function(){function t(t){this.ts=t,this.es=!1,this.ns=null}return Object.defineProperty(t.prototype,"Nn",{get:function(){return this.es},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ss",{get:function(){return this.ns},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.ts=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.es=!0},t.prototype.rs=function(t){this.ns=t},t.prototype.delete=function(){return ur(this.ts.delete())},t}(),rr=function(t){function e(e,n){var r=this;return(r=t.call(this,_.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(u.c)(e,t),e}(E);function ir(t){return"IndexedDbTransactionError"===t.name}var or=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(c("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(c("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ur(n)},t.prototype.add=function(t){return c("SimpleDb","ADD",this.store.name,t,t),ur(this.store.add(t))},t.prototype.get=function(t){var e=this;return ur(this.store.get(t)).next((function(n){return void 0===n&&(n=null),c("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return c("SimpleDb","DELETE",this.store.name,t),ur(this.store.delete(t))},t.prototype.count=function(){return c("SimpleDb","COUNT",this.store.name),ur(this.store.count())},t.prototype.os=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.cs(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.us=function(t,e){c("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.hs=!1;var r=this.cursor(n);return this.cs(r,(function(t,e,n){return n.delete()}))},t.prototype.ls=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.cs(r,e)},t.prototype._s=function(t){var e=this.cursor({});return new Zn((function(n,r){e.onerror=function(t){var e=ar(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.cs=function(t,e){var n=[];return new Zn((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new nr(i),u=e(i.primaryKey,i.value,o);if(u instanceof Zn){var s=u.catch((function(t){return o.done(),Zn.reject(t)}));n.push(s)}o.Nn?r():null===o.ss?i.continue():i.continue(o.ss)}else r()}})).next((function(){return Zn.$n(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.hs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function ur(t){return new Zn((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=ar(t.target.error);n(e)}}))}var sr=!1;function ar(t){var e=er.Kn(Object(i.g)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new E("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return sr||(sr=!0,setTimeout((function(){throw r}),0)),r}}return t}var cr=function(){function t(t,e,n,r,i){this.fs=t,this.ds=e,this.ws=n,this.op=r,this.Es=i,this.Ts=new Xn,this.then=this.Ts.promise.then.bind(this.Ts.promise),this.Ts.promise.catch((function(t){}))}return t.Is=function(e,n,r,i,o){var u=new t(e,n,Date.now()+r,i,o);return u.start(r),u},t.prototype.start=function(t){var e=this;this.As=setTimeout((function(){return e.Rs()}),t)},t.prototype.Ps=function(){return this.Rs()},t.prototype.cancel=function(t){null!==this.As&&(this.clearTimeout(),this.Ts.reject(new E(_.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.Rs=function(){var t=this;this.fs.ys((function(){return null!==t.As?(t.clearTimeout(),t.op().then((function(e){return t.Ts.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.As&&(this.Es(this),clearTimeout(this.As),this.As=null)},t}();function hr(t,e){if(h("AsyncQueue",e+": "+t),ir(t))return new E(_.UNAVAILABLE,e+": "+t);throw t}var fr=function(t,e){this.progress=t,this.gs=e},lr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",pr=function(){function t(){this.Vs=[]}return t.prototype.ps=function(t){this.Vs.push(t)},t.prototype.bs=function(){this.Vs.forEach((function(t){return t()}))},t}();function dr(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=yr(e)),e=vr(t.get(n),e);return yr(e)}function vr(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function yr(t){return t+"\x01\x01"}function mr(t){var e=t.length;if(d(e>=2),2===e)return d("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),F.at();for(var n=e-2,r=[],i="",o=0;o<e;){var u=t.indexOf("\x01",o);switch((u<0||u>n)&&p(),t.charAt(u+1)){case"\x01":var s=t.substring(o,u),a=void 0;0===i.length?a=s:(a=i+=s,i=""),r.push(a);break;case"\x10":i+=t.substring(o,u),i+="\0";break;case"\x11":i+=t.substring(o,u+1);break;default:p()}o=u+2}return new F(r)}var gr=function(t,e){this.seconds=t,this.nanoseconds=e},br=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};br.store="owner",br.key="owner";var wr=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};wr.store="mutationQueues",wr.keyPath="userId";var Ir=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Ir.store="mutations",Ir.keyPath="batchId",Ir.userMutationsIndex="userMutationsIndex",Ir.userMutationsKeyPath=["userId","batchId"];var _r=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,dr(e)]},t.key=function(t,e,n){return[t,dr(e),n]},t}();_r.store="documentMutations",_r.PLACEHOLDER=new _r;var Er=function(t,e){this.path=t,this.readTime=e},Or=function(t,e){this.path=t,this.version=e},Tr=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Tr.store="remoteDocuments",Tr.readTimeIndex="readTimeIndex",Tr.readTimeIndexPath="readTime",Tr.collectionReadTimeIndex="collectionReadTimeIndex",Tr.collectionReadTimeIndexPath=["parentPath","readTime"];var Nr=function(t){this.byteSize=t};Nr.store="remoteDocumentGlobal",Nr.key="remoteDocumentGlobalKey";var jr=function(t,e,n,r,i,o,u){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=u};jr.store="targets",jr.keyPath="targetId",jr.queryTargetsIndexName="queryTargetsIndex",jr.queryTargetsKeyPath=["canonicalId","targetId"];var Ar=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ar.store="targetDocuments",Ar.keyPath=["targetId","path"],Ar.documentTargetsIndex="documentTargetsIndex",Ar.documentTargetsKeyPath=["path","targetId"];var Sr=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Sr.key="targetGlobalKey",Sr.store="targetGlobal";var xr=function(t,e){this.collectionId=t,this.parent=e};xr.store="collectionParents",xr.keyPath=["collectionId","parent"];var Dr=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Dr.store="clientMetadata",Dr.keyPath="clientId";var kr=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};kr.store="bundles",kr.keyPath="bundleId";var Pr=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Pr.store="namedQueries",Pr.keyPath="name";var Cr=Object(u.g)(Object(u.g)(Object(u.g)(Object(u.g)([wr.store,Ir.store,_r.store,Tr.store,jr.store,br.store,Sr.store,Ar.store],[Dr.store]),[Nr.store]),[xr.store]),[kr.store,Pr.store]),Lr=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).vs=e,r.Ss=n,r}return Object(u.c)(e,t),e}(pr);function Rr(t,e){var n=v(t);return er.Hn(n.vs,e)}var Vr=function(){function t(t,e,n,r){this.batchId=t,this.Ds=e,this.baseMutations=n,this.mutations=r}return t.prototype.Cs=function(t,e,n){for(var r=n.xs,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=je(o,e,r[i]))}return e},t.prototype.Ns=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Ae(i,e,e,this.Ds))}for(var o=e,u=0,s=this.mutations;u<s.length;u++){var a=s[u];a.key.isEqual(t)&&(e=Ae(a,e,o,this.Ds))}return e},t.prototype.Fs=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.Ns(r.key,t.get(r.key));i&&(n=n.Ht(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),on())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&b(this.mutations,t.mutations,(function(t,e){return xe(t,e)}))&&b(this.baseMutations,t.baseMutations,(function(t,e){return xe(t,e)}))},t}(),Mr=function(){function t(t,e,n,r){this.batch=t,this.Os=e,this.xs=n,this.ks=r}return t.from=function(e,n,r){d(e.mutations.length===r.length);for(var i=nn(),o=e.mutations,u=0;u<o.length;u++)i=i.Ht(o[u].key,r[u].version);return new t(e,n,r,i)},t}(),Ur=function(t){this.Ms=t};function qr(t,e){if(e.document)return Rn(t.Ms,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=B.Tt(e.noDocument.path),r=Kr(e.noDocument.readTime);return new It(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=B.Tt(e.unknownDocument.path);return r=Kr(e.unknownDocument.version),new _t(i,r)}return p()}function Fr(t,e,n){var r=zr(n),i=e.key.path.Z().rt();if(e instanceof wt){var o=function(t,e){return{name:Sn(t,e.key),fields:e.vt().mapValue.fields,updateTime:En(t,e.version.G())}}(t.Ms,e),u=e.hasCommittedMutations;return new Tr(null,null,o,u,r,i)}if(e instanceof It){var s=e.key.path.rt(),a=Br(e.version);return u=e.hasCommittedMutations,new Tr(null,new Er(s,a),null,u,r,i)}if(e instanceof _t){var c=e.key.path.rt(),h=Br(e.version);return new Tr(new Or(c,h),null,null,!0,r,i)}return p()}function zr(t){var e=t.G();return[e.seconds,e.nanoseconds]}function Gr(t){var e=new M(t[0],t[1]);return U.W(e)}function Br(t){var e=t.G();return new gr(e.seconds,e.nanoseconds)}function Kr(t){var e=new M(t.seconds,t.nanoseconds);return U.W(e)}function Hr(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Mn(t.Ms,e)})),r=e.mutations.length-1;r>=0;--r){var i=e.mutations[r];void 0!==(null==i?void 0:i.transform)&&(e.mutations[r-1].updateTransforms=i.transform.fieldTransforms,e.mutations.splice(r,1),--r)}var o=e.mutations.map((function(e){return Mn(t.Ms,e)})),u=M.fromMillis(e.localWriteTimeMs);return new Vr(e.batchId,u,n,o)}function Jr(t){var e,n,r=Kr(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Kr(t.lastLimboFreeSnapshotVersion):U.min();return void 0!==t.query.documents?(d(1===(n=t.query).documents.length),e=Xt(Kt(kn(n.documents[0])))):e=function(t){return Xt(Fn(t))}(t.query),new ue(e,t.targetId,0,t.lastListenSequenceNumber,r,i,I.fromBase64String(t.resumeToken))}function Wr(t,e){var n,r=Br(e.Mt),i=Br(e.lastLimboFreeSnapshotVersion);n=jt(e.target)?Un(t.Ms,e.target):qn(t.Ms,e.target);var o=e.resumeToken.toBase64();return new jr(e.targetId,Tt(e.target),r,o,e.sequenceNumber,i,n)}function Qr(t){var e=Fn({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Zt(e,e.limit,"L"):e}var Yr=function(){function t(){}return t.prototype.Ls=function(t,e){return $r(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Kr(e.createTime),version:e.version};var e}))},t.prototype.$s=function(t,e){return $r(t).put({bundleId:(n=e).id,createTime:Br(Nn(n.createTime)),version:n.version});var n},t.prototype.Bs=function(t,e){return Xr(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Qr(e.bundledQuery),readTime:Kr(e.readTime)};var e}))},t.prototype.qs=function(t,e){return Xr(t).put(function(t){return{name:t.name,readTime:Br(Nn(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function $r(t){return Rr(t,kr.store)}function Xr(t){return Rr(t,Pr.store)}var Zr=function(){function t(){this.Us=new ti}return t.prototype.Qs=function(t,e){return this.Us.add(e),Zn.resolve()},t.prototype.Ks=function(t,e){return Zn.resolve(this.Us.getEntries(e))},t}(),ti=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.et(),n=t.Z(),r=this.index[e]||new We(F.J),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.et(),n=t.Z(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new We(F.J)).rt()},t}(),ei=function(){function t(){this.Ws=new ti}return t.prototype.Qs=function(t,e){var n=this;if(!this.Ws.has(e)){var r=e.et(),i=e.Z();t.ps((function(){n.Ws.add(e)}));var o={collectionId:r,parent:dr(i)};return ni(t).put(o)}return Zn.resolve()},t.prototype.Ks=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[w(e),""],!1,!0);return ni(t).os(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(mr(o.parent))}return n}))},t}();function ni(t){return Rr(t,xr.store)}var ri={js:!1,Gs:0,zs:0,Hs:0},ii=function(){function t(t,e,n){this.Js=t,this.Ys=e,this.Xs=n}return t.Zs=function(e){return new t(e,t.ti,t.ei)},t}();function oi(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){if(t.code!==_.FAILED_PRECONDITION||t.message!==lr)throw t;return c("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}ii.ti=10,ii.ei=1e3,ii.ni=new ii(41943040,ii.ti,ii.ei),ii.si=new ii(-1,0,0);var ui=function(){function t(t,e){this.ii=t,this.ri=e,this.oi={}}return t.prototype.get=function(t){var e=this.ii(t),n=this.oi[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],u=o[0],s=o[1];if(this.ri(u,t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.ii(t),r=this.oi[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.ri(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.oi[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.ii(t),n=this.oi[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.ri(n[r][0],t))return 1===n.length?delete this.oi[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){H(this.oi,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],u=o[0],s=o[1];t(u,s)}}))},t.prototype.nt=function(){return J(this.oi)},t}(),si=function(){function t(){this.ci=new ui((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.ai=!1}return t.prototype.ui=function(t){var e=this.ci.get(t);return e?e.readTime:U.min()},t.prototype.hi=function(t,e){this.li(),this.ci.set(t.key,{_i:t,readTime:e})},t.prototype.fi=function(t,e){void 0===e&&(e=null),this.li(),this.ci.set(t,{_i:null,readTime:e})},t.prototype.di=function(t,e){this.li();var n=this.ci.get(e);return void 0!==n?Zn.resolve(n._i):this.wi(t,e)},t.prototype.getEntries=function(t,e){return this.Ei(t,e)},t.prototype.apply=function(t){return this.li(),this.ai=!0,this.Ti(t)},t.prototype.li=function(){},t}();function ai(t,e,n){var r=t.store(Ir.store),i=t.store(_r.store),o=[],u=IDBKeyRange.only(n.batchId),s=0,a=r.ls({range:u},(function(t,e,n){return s++,n.delete()}));o.push(a.next((function(){d(1===s)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=_r.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Zn.$n(o).next((function(){return c}))}function ci(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw p();e=t.noDocument}return JSON.stringify(e).length}var hi=function(){function t(t,e,n,r){this.userId=t,this.Kt=e,this.Ii=n,this.mi=r,this.Ai={}}return t.Ri=function(e,n,r,i){return d(""!==e.uid),new t(e.A()?e.uid:"",n,r,i)},t.prototype.Pi=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return li(t).ls({index:Ir.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.yi=function(t,e,n,r){var i=this,o=pi(t),u=li(t);return u.add({}).next((function(s){d("number"==typeof s);for(var a=new Vr(s,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Vn(t.Ms,e)})),i=n.mutations.map((function(e){return Vn(t.Ms,e)}));return new Ir(e,n.batchId,n.Ds.toMillis(),r,i)}(i.Kt,i.userId,a),h=[],f=new We((function(t,e){return g(t.ot(),e.ot())})),l=0,p=r;l<p.length;l++){var v=p[l],y=_r.key(i.userId,v.key.path,s);f=f.add(v.key.path.Z()),h.push(u.put(c)),h.push(o.put(y,_r.PLACEHOLDER))}return f.forEach((function(e){h.push(i.Ii.Qs(t,e))})),t.ps((function(){i.Ai[s]=a.keys()})),Zn.$n(h).next((function(){return a}))}))},t.prototype.gi=function(t,e){var n=this;return li(t).get(e).next((function(t){return t?(d(t.userId===n.userId),Hr(n.Kt,t)):null}))},t.prototype.Vi=function(t,e){var n=this;return this.Ai[e]?Zn.resolve(this.Ai[e]):this.gi(t,e).next((function(t){if(t){var r=t.keys();return n.Ai[e]=r,r}return null}))},t.prototype.pi=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return li(t).ls({index:Ir.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(d(e.batchId>=r),o=Hr(n.Kt,e)),i.done()})).next((function(){return o}))},t.prototype.bi=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return li(t).ls({index:Ir.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.vi=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return li(t).os(Ir.userMutationsIndex,n).next((function(t){return t.map((function(t){return Hr(e.Kt,t)}))}))},t.prototype.Si=function(t,e){var n=this,r=_r.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return pi(t).ls({range:i},(function(r,i,u){var s=r[0],a=r[1],c=r[2],h=mr(a);if(s===n.userId&&e.path.isEqual(h))return li(t).get(c).next((function(t){if(!t)throw p();d(t.userId===n.userId),o.push(Hr(n.Kt,t))}));u.done()})).next((function(){return o}))},t.prototype.Di=function(t,e){var n=this,r=new We(g),i=[];return e.forEach((function(e){var o=_r.prefixForPath(n.userId,e.path),u=IDBKeyRange.lowerBound(o),s=pi(t).ls({range:u},(function(t,i,o){var u=t[0],s=t[1],a=t[2],c=mr(s);u===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(s)})),Zn.$n(i).next((function(){return n.Ci(t,r)}))},t.prototype.xi=function(t,e){var n=this,r=e.path,i=r.length+1,o=_r.prefixForPath(this.userId,r),u=IDBKeyRange.lowerBound(o),s=new We(g);return pi(t).ls({range:u},(function(t,e,o){var u=t[0],a=t[1],c=t[2],h=mr(a);u===n.userId&&r.st(h)?h.length===i&&(s=s.add(c)):o.done()})).next((function(){return n.Ci(t,s)}))},t.prototype.Ci=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(li(t).get(e).next((function(t){if(null===t)throw p();d(t.userId===n.userId),r.push(Hr(n.Kt,t))})))})),Zn.$n(i).next((function(){return r}))},t.prototype.Ni=function(t,e){var n=this;return ai(t.vs,this.userId,e).next((function(r){return t.ps((function(){n.Fi(e.batchId)})),Zn.forEach(r,(function(e){return n.mi.Oi(t,e)}))}))},t.prototype.Fi=function(t){delete this.Ai[t]},t.prototype.ki=function(t){var e=this;return this.Pi(t).next((function(n){if(!n)return Zn.resolve();var r=IDBKeyRange.lowerBound(_r.prefixForUser(e.userId)),i=[];return pi(t).ls({range:r},(function(t,n,r){if(t[0]===e.userId){var o=mr(t[1]);i.push(o)}else r.done()})).next((function(){d(0===i.length)}))}))},t.prototype.Mi=function(t,e){return fi(t,this.userId,e)},t.prototype.Li=function(t){var e=this;return di(t).get(this.userId).next((function(t){return t||new wr(e.userId,-1,"")}))},t}();function fi(t,e,n){var r=_r.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),u=!1;return pi(t).ls({range:o,hs:!0},(function(t,n,r){var o=t[0],s=t[1];t[2],o===e&&s===i&&(u=!0),r.done()})).next((function(){return u}))}function li(t){return Rr(t,Ir.store)}function pi(t){return Rr(t,_r.store)}function di(t){return Rr(t,wr.store)}var vi=function(){function t(t){this.$i=t}return t.prototype.next=function(){return this.$i+=2,this.$i},t.Bi=function(){return new t(0)},t.qi=function(){return new t(-1)},t}(),yi=function(){function t(t,e){this.mi=t,this.Kt=e}return t.prototype.Ui=function(t){var e=this;return this.Qi(t).next((function(n){var r=new vi(n.highestTargetId);return n.highestTargetId=r.next(),e.Ki(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.Wi=function(t){return this.Qi(t).next((function(t){return U.W(new M(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.ji=function(t){return this.Qi(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.Gi=function(t,e,n){var r=this;return this.Qi(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.G()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ki(t,i)}))},t.prototype.zi=function(t,e){var n=this;return this.Hi(t,e).next((function(){return n.Qi(t).next((function(r){return r.targetCount+=1,n.Ji(e,r),n.Ki(t,r)}))}))},t.prototype.Yi=function(t,e){return this.Hi(t,e)},t.prototype.Xi=function(t,e){var n=this;return this.Zi(t,e.targetId).next((function(){return mi(t).delete(e.targetId)})).next((function(){return n.Qi(t)})).next((function(e){return d(e.targetCount>0),e.targetCount-=1,n.Ki(t,e)}))},t.prototype.tr=function(t,e,n){var r=this,i=0,o=[];return mi(t).ls((function(u,s){var a=Jr(s);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.Xi(t,a)))})).next((function(){return Zn.$n(o)})).next((function(){return i}))},t.prototype.mn=function(t,e){return mi(t).ls((function(t,n){var r=Jr(n);e(r)}))},t.prototype.Qi=function(t){return gi(t).get(Sr.key).next((function(t){return d(null!==t),t}))},t.prototype.Ki=function(t,e){return gi(t).put(Sr.key,e)},t.prototype.Hi=function(t,e){return mi(t).put(Wr(this.Kt,e))},t.prototype.Ji=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.er=function(t){return this.Qi(t).next((function(t){return t.targetCount}))},t.prototype.nr=function(t,e){var n=Tt(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return mi(t).ls({range:r,index:jr.queryTargetsIndexName},(function(t,n,r){var o=Jr(n);Nt(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.sr=function(t,e,n){var r=this,i=[],o=bi(t);return e.forEach((function(e){var u=dr(e.path);i.push(o.put(new Ar(n,u))),i.push(r.mi.ir(t,n,e))})),Zn.$n(i)},t.prototype.rr=function(t,e,n){var r=this,i=bi(t);return Zn.forEach(e,(function(e){var o=dr(e.path);return Zn.$n([i.delete([n,o]),r.mi.cr(t,n,e)])}))},t.prototype.Zi=function(t,e){var n=bi(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.ar=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=bi(t),i=on();return r.ls({range:n,hs:!0},(function(t,e,n){var r=mr(t[1]),o=new B(r);i=i.add(o)})).next((function(){return i}))},t.prototype.Mi=function(t,e){var n=dr(e.path),r=IDBKeyRange.bound([n],[w(n)],!1,!0),i=0;return bi(t).ls({index:Ar.documentTargetsIndex,hs:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.Dn=function(t,e){return mi(t).get(e).next((function(t){return t?Jr(t):null}))},t}();function mi(t){return Rr(t,jr.store)}function gi(t){return Rr(t,Sr.store)}function bi(t){return Rr(t,Ar.store)}function wi(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],u=g(n,i);return 0===u?g(r,o):u}var Ii=function(){function t(t){this.ur=t,this.buffer=new We(wi),this.hr=0}return t.prototype.lr=function(){return++this.hr},t.prototype._r=function(t){var e=[t,this.lr()];if(this.buffer.size<this.ur)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();wi(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),_i=function(){function t(t,e){this.dr=t,this.fs=e,this.wr=!1,this.Er=null}return t.prototype.start=function(t){-1!==this.dr.params.Js&&this.Tr(t)},t.prototype.stop=function(){this.Er&&(this.Er.cancel(),this.Er=null)},Object.defineProperty(t.prototype,"Ir",{get:function(){return null!==this.Er},enumerable:!1,configurable:!0}),t.prototype.Tr=function(t){var e=this,n=this.wr?3e5:6e4;c("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.Er=this.fs.mr("lru_garbage_collection",n,(function(){return Object(u.b)(e,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:this.Er=null,this.wr=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Ar(this.dr)];case 2:return n.sent(),[3,7];case 3:return ir(e=n.sent())?(c("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,oi(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.Tr(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),Ei=function(){function t(t,e){this.Rr=t,this.params=e}return t.prototype.Pr=function(t,e){return this.Rr.yr(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.gr=function(t,e){var n=this;if(0===e)return Zn.resolve(V.U);var r=new Ii(e);return this.Rr.mn(t,(function(t){return r._r(t.sequenceNumber)})).next((function(){return n.Rr.Vr(t,(function(t){return r._r(t)}))})).next((function(){return r.maxValue}))},t.prototype.tr=function(t,e,n){return this.Rr.tr(t,e,n)},t.prototype.pr=function(t,e){return this.Rr.pr(t,e)},t.prototype.br=function(t,e){var n=this;return-1===this.params.Js?(c("LruGarbageCollector","Garbage collection skipped; disabled"),Zn.resolve(ri)):this.vr(t).next((function(r){return r<n.params.Js?(c("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.Js),ri):n.Sr(t,e)}))},t.prototype.vr=function(t){return this.Rr.vr(t)},t.prototype.Sr=function(t,e){var n,i,o,u,s,h,f,l=this,p=Date.now();return this.Pr(t,this.params.Ys).next((function(e){return e>l.params.Xs?(c("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+l.params.Xs+" from "+e),i=l.params.Xs):i=e,u=Date.now(),l.gr(t,i)})).next((function(r){return n=r,s=Date.now(),l.tr(t,n,e)})).next((function(e){return o=e,h=Date.now(),l.pr(t,n)})).next((function(t){return f=Date.now(),a()<=r.a.DEBUG&&c("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(u-p)+"ms\n\tDetermined least recently used "+i+" in "+(s-u)+"ms\n\tRemoved "+o+" targets in "+(h-s)+"ms\n\tRemoved "+t+" documents in "+(f-h)+"ms\nTotal Duration: "+(f-p)+"ms"),Zn.resolve({js:!0,Gs:i,zs:o,Hs:t})}))},t}(),Oi=function(){function t(t,e){this.db=t,this.dr=function(t,e){return new Ei(t,e)}(this,e)}return t.prototype.yr=function(t){var e=this.Dr(t);return this.db.Cr().er(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.Dr=function(t){var e=0;return this.Vr(t,(function(t){e++})).next((function(){return e}))},t.prototype.mn=function(t,e){return this.db.Cr().mn(t,e)},t.prototype.Vr=function(t,e){return this.Nr(t,(function(t,n){return e(n)}))},t.prototype.ir=function(t,e,n){return Ti(t,n)},t.prototype.cr=function(t,e,n){return Ti(t,n)},t.prototype.tr=function(t,e,n){return this.db.Cr().tr(t,e,n)},t.prototype.Oi=function(t,e){return Ti(t,e)},t.prototype.Fr=function(t,e){return function(t,e){var n=!1;return di(t)._s((function(r){return fi(t,r,e).next((function(t){return t&&(n=!0),Zn.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.pr=function(t,e){var n=this,r=this.db.kr().Or(),i=[],o=0;return this.Nr(t,(function(u,s){if(s<=e){var a=n.Fr(t,u).next((function(e){if(!e)return o++,r.di(t,u).next((function(){return r.fi(u),bi(t).delete([0,dr(u.path)])}))}));i.push(a)}})).next((function(){return Zn.$n(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.Lt(t.Ss);return this.db.Cr().Yi(t,n)},t.prototype.Mr=function(t,e){return Ti(t,e)},t.prototype.Nr=function(t,e){var n,r=bi(t),i=V.U;return r.ls({index:Ar.documentTargetsIndex},(function(t,r){var o=t[0],u=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==V.U&&e(new B(mr(n)),i),i=s,n=u):i=V.U})).next((function(){i!==V.U&&e(new B(mr(n)),i)}))},t.prototype.vr=function(t){return this.db.kr().Lr(t)},t}();function Ti(t,e){return bi(t).put(function(t,e){return new Ar(0,dr(t.path),e)}(e,t.Ss))}var Ni=function(){function t(t,e){this.Kt=t,this.Ii=e}return t.prototype.hi=function(t,e,n){return Si(t).put(xi(e),n)},t.prototype.fi=function(t,e){var n=Si(t),r=xi(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.$r(t,r)}))},t.prototype.di=function(t,e){var n=this;return Si(t).get(xi(e)).next((function(t){return n.Br(t)}))},t.prototype.qr=function(t,e){var n=this;return Si(t).get(xi(e)).next((function(t){var e=n.Br(t);return e?{_i:e,size:ci(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=Xe();return this.Ur(t,e,(function(t,e){var i=n.Br(e);r=r.Ht(t,i)})).next((function(){return r}))},t.prototype.Qr=function(t,e){var n=this,r=Xe(),i=new Ke(B.J);return this.Ur(t,e,(function(t,e){var o=n.Br(e);o?(r=r.Ht(t,o),i=i.Ht(t,ci(e))):(r=r.Ht(t,null),i=i.Ht(t,0))})).next((function(){return{Kr:r,Wr:i}}))},t.prototype.Ur=function(t,e,n){if(e.nt())return Zn.resolve();var r=IDBKeyRange.bound(e.first().path.rt(),e.last().path.rt()),i=e.ee(),o=i.ce();return Si(t).ls({range:r},(function(t,e,r){for(var u=B.Tt(t);o&&B.J(o,u)<0;)n(o,null),o=i.ce();o&&o.isEqual(u)&&(n(o,e),o=i.ae()?i.ce():null),o?r.rs(o.path.rt()):r.done()})).next((function(){for(;o;)n(o,null),o=i.ae()?i.ce():null}))},t.prototype.jr=function(t,e,n){var r=this,i=tn(),o=e.path.length+1,u={};if(n.isEqual(U.min())){var s=e.path.rt();u.range=IDBKeyRange.lowerBound(s)}else{var a=e.path.rt(),c=zr(n);u.range=IDBKeyRange.lowerBound([a,c],!0),u.index=Tr.collectionReadTimeIndex}return Si(t).ls(u,(function(t,n,u){if(t.length===o){var s=qr(r.Kt,n);e.path.st(s.key.path)?s instanceof wt&&re(e,s)&&(i=i.Ht(s.key,s)):u.done()}})).next((function(){return i}))},t.prototype.Or=function(t){return new ji(this,!!t&&t.Gr)},t.prototype.Lr=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Ai(t).get(Nr.key).next((function(t){return d(!!t),t}))},t.prototype.$r=function(t,e){return Ai(t).put(Nr.key,e)},t.prototype.Br=function(t){if(t){var e=qr(this.Kt,t);return e instanceof It&&e.version.isEqual(U.min())?null:e}return null},t}(),ji=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).zr=e,r.Gr=n,r.Hr=new ui((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return Object(u.c)(e,t),e.prototype.Ti=function(t){var e=this,n=[],r=0,i=new We((function(t,e){return g(t.ot(),e.ot())}));return this.ci.forEach((function(o,u){var s=e.Hr.get(o);if(u._i){var a=Fr(e.zr.Kt,u._i,e.ui(o));i=i.add(o.path.Z());var c=ci(a);r+=c-s,n.push(e.zr.hi(t,o,a))}else if(r-=s,e.Gr){var h=Fr(e.zr.Kt,new It(o,U.min()),e.ui(o));n.push(e.zr.hi(t,o,h))}else n.push(e.zr.fi(t,o))})),i.forEach((function(r){n.push(e.zr.Ii.Qs(t,r))})),n.push(this.zr.updateMetadata(t,r)),Zn.$n(n)},e.prototype.wi=function(t,e){var n=this;return this.zr.qr(t,e).next((function(t){return null===t?(n.Hr.set(e,0),null):(n.Hr.set(e,t.size),t._i)}))},e.prototype.Ei=function(t,e){var n=this;return this.zr.Qr(t,e).next((function(t){var e=t.Kr;return t.Wr.forEach((function(t,e){n.Hr.set(t,e)})),e}))},e}(si);function Ai(t){return Rr(t,Nr.store)}function Si(t){return Rr(t,Tr.store)}function xi(t){return t.path.rt()}var Di=function(){function t(t){this.Kt=t}return t.prototype.Yn=function(t,e,n,r){var i=this;d(n<r&&n>=0&&r<=11);var o=new tr("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(br.store)}(t),function(t){t.createObjectStore(wr.store,{keyPath:wr.keyPath}),t.createObjectStore(Ir.store,{keyPath:Ir.keyPath,autoIncrement:!0}).createIndex(Ir.userMutationsIndex,Ir.userMutationsKeyPath,{unique:!0}),t.createObjectStore(_r.store)}(t),ki(t),function(t){t.createObjectStore(Tr.store)}(t));var u=Zn.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Ar.store),t.deleteObjectStore(jr.store),t.deleteObjectStore(Sr.store)}(t),ki(t)),u=u.next((function(){return function(t){var e=t.store(Sr.store),n=new Sr(0,0,U.min().G(),0);return e.put(Sr.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(u=u.next((function(){return function(t,e){return e.store(Ir.store).os().next((function(n){t.deleteObjectStore(Ir.store),t.createObjectStore(Ir.store,{keyPath:Ir.keyPath,autoIncrement:!0}).createIndex(Ir.userMutationsIndex,Ir.userMutationsKeyPath,{unique:!0});var r=e.store(Ir.store),i=n.map((function(t){return r.put(t)}));return Zn.$n(i)}))}(t,o)}))),u=u.next((function(){!function(t){t.createObjectStore(Dr.store,{keyPath:Dr.keyPath})}(t)}))),n<5&&r>=5&&(u=u.next((function(){return i.Jr(o)}))),n<6&&r>=6&&(u=u.next((function(){return function(t){t.createObjectStore(Nr.store)}(t),i.Yr(o)}))),n<7&&r>=7&&(u=u.next((function(){return i.Xr(o)}))),n<8&&r>=8&&(u=u.next((function(){return i.Zr(t,o)}))),n<9&&r>=9&&(u=u.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Tr.store);e.createIndex(Tr.readTimeIndex,Tr.readTimeIndexPath,{unique:!1}),e.createIndex(Tr.collectionReadTimeIndex,Tr.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(u=u.next((function(){return i.eo(o)}))),n<11&&r>=11&&(u=u.next((function(){!function(t){t.createObjectStore(kr.store,{keyPath:kr.keyPath})}(t),function(t){t.createObjectStore(Pr.store,{keyPath:Pr.keyPath})}(t)}))),u},t.prototype.Yr=function(t){var e=0;return t.store(Tr.store).ls((function(t,n){e+=ci(n)})).next((function(){var n=new Nr(e);return t.store(Nr.store).put(Nr.key,n)}))},t.prototype.Jr=function(t){var e=this,n=t.store(wr.store),r=t.store(Ir.store);return n.os().next((function(n){return Zn.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.os(Ir.userMutationsIndex,i).next((function(r){return Zn.forEach(r,(function(r){d(r.userId===n.userId);var i=Hr(e.Kt,r);return ai(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.Xr=function(t){var e=t.store(Ar.store),n=t.store(Tr.store);return t.store(Sr.store).get(Sr.key).next((function(t){var r=[];return n.ls((function(n,i){var o=new F(n),u=function(t){return[0,dr(t)]}(o);r.push(e.get(u).next((function(n){return n?Zn.resolve():function(n){return e.put(new Ar(0,dr(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return Zn.$n(r)}))}))},t.prototype.Zr=function(t,e){t.createObjectStore(xr.store,{keyPath:xr.keyPath});var n=e.store(xr.store),r=new ti,i=function(t){if(r.add(t)){var e=t.et(),i=t.Z();return n.put({collectionId:e,parent:dr(i)})}};return e.store(Tr.store).ls({hs:!0},(function(t,e){var n=new F(t);return i(n.Z())})).next((function(){return e.store(_r.store).ls({hs:!0},(function(t,e){t[0];var n=t[1],r=(t[2],mr(n));return i(r.Z())}))}))},t.prototype.eo=function(t){var e=this,n=t.store(jr.store);return n.ls((function(t,r){var i=Jr(r),o=Wr(e.Kt,i);return n.put(o)}))},t}();function ki(t){t.createObjectStore(Ar.store,{keyPath:Ar.keyPath}).createIndex(Ar.documentTargetsIndex,Ar.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(jr.store,{keyPath:jr.keyPath}).createIndex(jr.queryTargetsIndexName,jr.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Sr.store)}var Pi="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ci=function(){function t(e,n,r,i,o,u,s,a,c,f){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.no=o,this.window=u,this.document=s,this.so=c,this.io=f,this.ro=null,this.oo=!1,this.isPrimary=!1,this.networkEnabled=!0,this.co=null,this.inForeground=!1,this.ao=null,this.uo=null,this.ho=Number.NEGATIVE_INFINITY,this.lo=function(t){return Promise.resolve()},!t.Wn())throw new E(_.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.mi=new Oi(this,i),this._o=n+"main",this.Kt=new Ur(a),this.fo=new er(this._o,11,new Di(this.Kt)),this.wo=new yi(this.mi,this.Kt),this.Ii=new ei,this.Eo=function(t,e){return new Ni(t,e)}(this.Kt,this.Ii),this.To=new Yr,this.window&&this.window.localStorage?this.Io=this.window.localStorage:(this.Io=null,!1===f&&h("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.mo().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new E(_.FAILED_PRECONDITION,Pi);return t.Ao(),t.Ro(),t.Po(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.wo.ji(e)}))})).then((function(e){t.ro=new V(e,t.so)})).then((function(){t.oo=!0})).catch((function(e){return t.fo&&t.fo.close(),Promise.reject(e)}))},t.prototype.yo=function(t){var e=this;return this.lo=function(n){return Object(u.b)(e,void 0,void 0,(function(){return Object(u.d)(this,(function(e){return this.Ir?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.Vo=function(t){var e=this;this.fo.Zn((function(n){return Object(u.b)(e,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.po=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.no.ys((function(){return Object(u.b)(e,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return this.Ir?[4,this.mo()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.mo=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Ri(e).put(new Dr(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.bo(e).next((function(e){e||(t.isPrimary=!1,t.no.vo((function(){return t.lo(!1)})))}))})).next((function(){return t.So(e)})).next((function(n){return t.isPrimary&&!n?t.Do(e).next((function(){return!1})):!!n&&t.Co(e).next((function(){return!0}))}))})).catch((function(e){if(ir(e))return c("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return c("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.no.vo((function(){return t.lo(e)})),t.isPrimary=e}))},t.prototype.bo=function(t){var e=this;return Li(t).get(br.key).next((function(t){return Zn.resolve(e.xo(t))}))},t.prototype.No=function(t){return Ri(t).delete(this.clientId)},t.prototype.Fo=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e,n,r,i=this;return Object(u.d)(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.Oo(this.ho,18e5)?[3,2]:(this.ho=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=Rr(t,Dr.store);return e.os().next((function(t){var n=i.ko(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return Zn.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Io)for(e=0,n=t;e<n.length;e++)r=n[e],this.Io.removeItem(this.Mo(r.clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.Po=function(){var t=this;this.uo=this.no.mr("client_metadata_refresh",4e3,(function(){return t.mo().then((function(){return t.Fo()})).then((function(){return t.Po()}))}))},t.prototype.xo=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.So=function(t){var e=this;return this.io?Zn.resolve(!0):Li(t).get(br.key).next((function(n){if(null!==n&&e.Oo(n.leaseTimestampMs,5e3)&&!e.Lo(n.ownerId)){if(e.xo(n)&&e.networkEnabled)return!0;if(!e.xo(n)){if(!n.allowTabSynchronization)throw new E(_.FAILED_PRECONDITION,Pi);return!1}}return!(!e.networkEnabled||!e.inForeground)||Ri(t).os().next((function(t){return void 0===e.ko(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&c("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.$o=function(){return Object(u.b)(this,void 0,void 0,(function(){var t=this;return Object(u.d)(this,(function(e){switch(e.label){case 0:return this.oo=!1,this.Bo(),this.uo&&(this.uo.cancel(),this.uo=null),this.qo(),this.Uo(),[4,this.fo.runTransaction("shutdown","readwrite",[br.store,Dr.store],(function(e){var n=new Lr(e,V.U);return t.Do(n).next((function(){return t.No(n)}))}))];case 1:return e.sent(),this.fo.close(),this.Qo(),[2]}}))}))},t.prototype.ko=function(t,e){var n=this;return t.filter((function(t){return n.Oo(t.updateTimeMs,e)&&!n.Lo(t.clientId)}))},t.prototype.Ko=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Ri(e).os().next((function(e){return t.ko(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"Ir",{get:function(){return this.oo},enumerable:!1,configurable:!0}),t.prototype.Wo=function(t){return hi.Ri(t,this.Kt,this.Ii,this.mi)},t.prototype.Cr=function(){return this.wo},t.prototype.kr=function(){return this.Eo},t.prototype.jo=function(){return this.Ii},t.prototype.Go=function(){return this.To},t.prototype.runTransaction=function(t,e,n){var r=this;c("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.fo.runTransaction(t,o,Cr,(function(o){return i=new Lr(o,r.ro?r.ro.next():V.U),"readwrite-primary"===e?r.bo(i).next((function(t){return!!t||r.So(i)})).next((function(e){if(!e)throw h("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.no.vo((function(){return r.lo(!1)})),new E(_.FAILED_PRECONDITION,lr);return n(i)})).next((function(t){return r.Co(i).next((function(){return t}))})):r.zo(i).next((function(){return n(i)}))})).then((function(t){return i.bs(),t}))},t.prototype.zo=function(t){var e=this;return Li(t).get(br.key).next((function(t){if(null!==t&&e.Oo(t.leaseTimestampMs,5e3)&&!e.Lo(t.ownerId)&&!e.xo(t)&&!(e.io||e.allowTabSynchronization&&t.allowTabSynchronization))throw new E(_.FAILED_PRECONDITION,Pi)}))},t.prototype.Co=function(t){var e=new br(this.clientId,this.allowTabSynchronization,Date.now());return Li(t).put(br.key,e)},t.Wn=function(){return er.Wn()},t.prototype.Do=function(t){var e=this,n=Li(t);return n.get(br.key).next((function(t){return e.xo(t)?(c("IndexedDbPersistence","Releasing primary lease."),n.delete(br.key)):Zn.resolve()}))},t.prototype.Oo=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(h("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.Ao=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ao=function(){t.no.ys((function(){return t.inForeground="visible"===t.document.visibilityState,t.mo()}))},this.document.addEventListener("visibilitychange",this.ao),this.inForeground="visible"===this.document.visibilityState)},t.prototype.qo=function(){this.ao&&(this.document.removeEventListener("visibilitychange",this.ao),this.ao=null)},t.prototype.Ro=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.co=function(){e.Bo(),e.no.ys((function(){return e.$o()}))},this.window.addEventListener("unload",this.co))},t.prototype.Uo=function(){this.co&&(this.window.removeEventListener("unload",this.co),this.co=null)},t.prototype.Lo=function(t){var e;try{var n=null!==(null===(e=this.Io)||void 0===e?void 0:e.getItem(this.Mo(t)));return c("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return h("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.Bo=function(){if(this.Io)try{this.Io.setItem(this.Mo(this.clientId),String(Date.now()))}catch(t){h("Failed to set zombie client id.",t)}},t.prototype.Qo=function(){if(this.Io)try{this.Io.removeItem(this.Mo(this.clientId))}catch(t){}},t.prototype.Mo=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Li(t){return Rr(t,br.store)}function Ri(t){return Rr(t,Dr.store)}function Vi(t,e){var n=t.projectId;return t.m||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Mi=function(){function t(t,e,n){this.Eo=t,this.Ho=e,this.Ii=n}return t.prototype.Jo=function(t,e){var n=this;return this.Ho.Si(t,e).next((function(r){return n.Yo(t,e,r)}))},t.prototype.Yo=function(t,e,n){return this.Eo.di(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].Ns(e,t);return t}))},t.prototype.Xo=function(t,e,n){var r=Xe();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].Ns(t,e);r=r.Ht(t,e)})),r},t.prototype.Zo=function(t,e){var n=this;return this.Eo.getEntries(t,e).next((function(e){return n.tc(t,e)}))},t.prototype.tc=function(t,e){var n=this;return this.Ho.Di(t,e).next((function(r){var i=n.Xo(t,e,r),o=$e();return i.forEach((function(t,e){e||(e=new It(t,U.min())),o=o.Ht(t,e)})),o}))},t.prototype.jr=function(t,e,n){return function(t){return B.Et(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.ec(t,e.path):Yt(e)?this.nc(t,e,n):this.sc(t,e,n)},t.prototype.ec=function(t,e){return this.Jo(t,new B(e)).next((function(t){var e=tn();return t instanceof wt&&(e=e.Ht(t.key,t)),e}))},t.prototype.nc=function(t,e,n){var r=this,i=e.collectionGroup,o=tn();return this.Ii.Ks(t,i).next((function(u){return Zn.forEach(u,(function(u){var s=function(t,e){return new Gt(e,null,t.Nt.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,u.child(i));return r.sc(t,s,n).next((function(t){t.forEach((function(t,e){o=o.Ht(t,e)}))}))})).next((function(){return o}))}))},t.prototype.sc=function(t,e,n){var r,i,o=this;return this.Eo.jr(t,e,n).next((function(n){return r=n,o.Ho.xi(t,e)})).next((function(e){return i=e,o.ic(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],u=0,s=o.mutations;u<s.length;u++){var a=s[u],c=a.key,h=r.get(c),f=Ae(a,h,h,o.Ds);r=f instanceof wt?r.Ht(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){re(e,n)||(r=r.remove(t))})),r}))},t.prototype.ic=function(t,e,n){for(var r=on(),i=0,o=e;i<o.length;i++)for(var u=0,s=o[i].mutations;u<s.length;u++){var a=s[u];a instanceof Pe&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Eo.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof wt&&(c=c.Ht(t,e))})),c}))},t}(),Ui=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.rc=n,this.oc=r}return t.cc=function(e,n){for(var r=on(),i=on(),o=0,u=n.docChanges;o<u.length;o++){var s=u[o];switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),qi=function(){function t(){}return t.prototype.ac=function(t){this.uc=t},t.prototype.jr=function(t,e,n,i){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.Nt.length||1===t.Nt.length&&t.Nt[0].field.ht())}(e)||n.isEqual(U.min())?this.hc(t,e):this.uc.Zo(t,i).next((function(u){var s=o.lc(e,u);return(Ht(e)||Jt(e))&&o._c(e.limitType,s,i,n)?o.hc(t,e):(a()<=r.a.DEBUG&&c("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ne(e)),o.uc.jr(t,e,n).next((function(t){return s.forEach((function(e){t=t.Ht(e.key,e)})),t})))}))},t.prototype.lc=function(t,e){var n=new We(ie(t));return e.forEach((function(e,r){r instanceof wt&&re(t,r)&&(n=n.add(r))})),n},t.prototype._c=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.u(r)>0)},t.prototype.hc=function(t,e){return a()<=r.a.DEBUG&&c("QueryEngine","Using full collection scan to execute query:",ne(e)),this.uc.jr(t,e,U.min())},t}(),Fi=function(){function t(t,e,n,r){this.persistence=t,this.fc=e,this.Kt=r,this.dc=new Ke(g),this.wc=new ui((function(t){return Tt(t)}),Nt),this.Ec=U.min(),this.Ho=t.Wo(n),this.Tc=t.kr(),this.wo=t.Cr(),this.Ic=new Mi(this.Tc,this.Ho,this.persistence.jo()),this.To=t.Go(),this.fc.ac(this.Ic)}return t.prototype.Ar=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.br(n,e.dc)}))},t}();function zi(t,e,n,r){return new Fi(t,e,n,r)}function Gi(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(u.d)(this,(function(u){switch(u.label){case 0:return n=v(t),r=n.Ho,i=n.Ic,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n.Ho.vi(t).next((function(u){return o=u,r=n.persistence.Wo(e),i=new Mi(n.Tc,r,n.persistence.jo()),r.vi(t)})).next((function(e){for(var n=[],r=[],u=on(),s=0,a=o;s<a.length;s++){var c=a[s];n.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];u=u.add(l.key)}}for(var p=0,d=e;p<d.length;p++){var v=d[p];r.push(v.batchId);for(var y=0,m=v.mutations;y<m.length;y++){var g=m[y];u=u.add(g.key)}}return i.Zo(t,u).next((function(t){return{mc:t,Ac:n,Rc:r}}))}))}))];case 1:return o=u.sent(),[2,(n.Ho=r,n.Ic=i,n.fc.ac(n.Ic),o)]}}))}))}function Bi(t,e){var n=v(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.Tc.Or({Gr:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),u=Zn.resolve();return o.forEach((function(t){u=u.next((function(){return r.di(e,t)})).next((function(e){var o=e,u=n.ks.get(t);d(null!==u),(!o||o.version.u(u)<0)&&(o=i.Cs(t,o,n))&&r.hi(o,n.Os)}))})),u.next((function(){return t.Ho.Ni(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.Ho.ki(t)})).next((function(){return n.Ic.Zo(t,r)}))}))}function Ki(t){var e=v(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.wo.Wi(t)}))}function Hi(t,e){var n=v(t),r=e.Mt,i=n.dc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Tc.Or({Gr:!0});i=n.dc;var u=[];e.Oe.forEach((function(e,o){var s=i.get(o);if(s){u.push(n.wo.rr(t,e.Ke,o).next((function(){return n.wo.sr(t,e.Ue,o)})));var a=e.resumeToken;if(a.o()>0){var c=s.$t(a,r).Lt(t.Ss);i=i.Ht(o,c),function(t,e,n){return d(e.resumeToken.o()>0),0===t.resumeToken.o()||e.Mt.j()-t.Mt.j()>=3e8||n.Ue.size+n.Qe.size+n.Ke.size>0}(s,c,e)&&u.push(n.wo.Yi(t,c))}}}));var s=$e();if(e.Me.forEach((function(r,i){e.Le.has(r)&&u.push(n.persistence.mi.Mr(t,r))})),u.push(Ji(t,o,e.Me,r,void 0).next((function(t){s=t}))),!r.isEqual(U.min())){var a=n.wo.Wi(t).next((function(e){return n.wo.Gi(t,t.Ss,r)}));u.push(a)}return Zn.$n(u).next((function(){return o.apply(t)})).next((function(){return n.Ic.tc(t,s)}))})).then((function(t){return n.dc=i,t}))}function Ji(t,e,n,r,i){var o=on();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=$e();return n.forEach((function(n,u){var s=t.get(n),a=(null==i?void 0:i.get(n))||r;u instanceof It&&u.version.isEqual(U.min())?(e.fi(n,a),o=o.Ht(n,u)):null==s||u.version.u(s.version)>0||0===u.version.u(s.version)&&s.hasPendingWrites?(e.hi(u,a),o=o.Ht(n,u)):c("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",u.version)})),o}))}function Wi(t,e){var n=v(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n.Ho.pi(t,e)}))}function Qi(t,e){var n=v(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.wo.nr(t,e).next((function(i){return i?(r=i,Zn.resolve(r)):n.wo.Ui(t).next((function(i){return r=new ue(e,i,0,t.Ss),n.wo.zi(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.dc.get(t.targetId);return(null===r||t.Mt.u(r.Mt)>0)&&(n.dc=n.dc.Ht(t.targetId,t),n.wc.set(e,t.targetId)),t}))}function Yi(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(u.d)(this,(function(u){switch(u.label){case 0:r=v(t),i=r.dc.get(e),o=n?"readwrite":"readwrite-primary",u.label=1;case 1:return u.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.mi.removeTarget(t,i)}))];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:if(!ir(s=u.sent()))throw s;return c("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.dc=r.dc.remove(e),r.wc.delete(i.target),[2]}}))}))}function $i(t,e,n){var r=v(t),i=U.min(),o=on();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=v(t),i=r.wc.get(n);return void 0!==i?Zn.resolve(r.dc.get(i)):r.wo.nr(e,n)}(r,t,Xt(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.wo.ar(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.fc.jr(t,e,n?i:U.min(),n?o:on())})).next((function(t){return{documents:t,Pc:o}}))}))}function Xi(t,e){var n=v(t),r=v(n.wo),i=n.dc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.Dn(t,e).next((function(t){return t?t.target:null}))}))}function Zi(t){var e=v(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=v(t),i=$e(),o=zr(n),u=Si(e),s=IDBKeyRange.lowerBound(o,!0);return u.ls({index:Tr.readTimeIndex,range:s},(function(t,e){var n=qr(r.Kt,e);i=i.Ht(n.key,n),o=e.readTime})).next((function(){return{gs:i,readTime:Gr(o)}}))}(e.Tc,t,e.Ec)})).then((function(t){var n=t.gs,r=t.readTime;return e.Ec=r,n}))}function to(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){return[2,(e=v(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=Si(t),n=U.min();return e.ls({index:Tr.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Gr(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.Ec=t}))]}))}))}function eo(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o,s,a,c,h,f,l,p,d;return Object(u.d)(this,(function(u){switch(u.label){case 0:for(i=v(t),o=on(),s=$e(),a=nn(),c=0,h=n;c<h.length;c++)f=h[c],l=e.yc(f.metadata.name),f.document&&(o=o.add(l)),s=s.Ht(l,e.gc(f)),a=a.Ht(l,e.Vc(f.metadata.readTime));return p=i.Tc.Or({Gr:!0}),[4,Qi(i,function(t){return Xt(Kt(F.ct("__bundle__/docs/"+t)))}(r))];case 1:return d=u.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return Ji(t,p,s,U.min(),a).next((function(e){return p.apply(t),e})).next((function(e){return i.wo.Zi(t,d.targetId).next((function(){return i.wo.sr(t,o,d.targetId)})).next((function(){return i.Ic.tc(t,e)}))}))}))]}}))}))}function no(t,e,n){return void 0===n&&(n=on()),Object(u.b)(this,void 0,void 0,(function(){var r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return[4,Qi(t,Xt(Qr(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=v(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=Nn(e.readTime);if(r.Mt.u(o)>=0)return i.To.qs(t,e);var u=r.$t(I.h,o);return i.dc=i.dc.Ht(u.targetId,u),i.wo.Yi(t,u).next((function(){return i.wo.Zi(t,r.targetId)})).next((function(){return i.wo.sr(t,n,r.targetId)})).next((function(){return i.To.qs(t,e)}))}))]}}))}))}var ro=function(){function t(t){this.Kt=t,this.bc=new Map,this.vc=new Map}return t.prototype.Ls=function(t,e){return Zn.resolve(this.bc.get(e))},t.prototype.$s=function(t,e){var n;return this.bc.set(e.id,{id:(n=e).id,version:n.version,createTime:Nn(n.createTime)}),Zn.resolve()},t.prototype.Bs=function(t,e){return Zn.resolve(this.vc.get(e))},t.prototype.qs=function(t,e){return this.vc.set(e.name,function(t){return{name:t.name,query:Qr(t.bundledQuery),readTime:Nn(t.readTime)}}(e)),Zn.resolve()},t}(),io=function(){function t(){this.Sc=new We(oo.Dc),this.Cc=new We(oo.xc)}return t.prototype.nt=function(){return this.Sc.nt()},t.prototype.ir=function(t,e){var n=new oo(t,e);this.Sc=this.Sc.add(n),this.Cc=this.Cc.add(n)},t.prototype.Nc=function(t,e){var n=this;t.forEach((function(t){return n.ir(t,e)}))},t.prototype.cr=function(t,e){this.Fc(new oo(t,e))},t.prototype.Oc=function(t,e){var n=this;t.forEach((function(t){return n.cr(t,e)}))},t.prototype.kc=function(t){var e=this,n=new B(new F([])),r=new oo(n,t),i=new oo(n,t+1),o=[];return this.Cc.Ae([r,i],(function(t){e.Fc(t),o.push(t.key)})),o},t.prototype.Mc=function(){var t=this;this.Sc.forEach((function(e){return t.Fc(e)}))},t.prototype.Fc=function(t){this.Sc=this.Sc.delete(t),this.Cc=this.Cc.delete(t)},t.prototype.Lc=function(t){var e=new B(new F([])),n=new oo(e,t),r=new oo(e,t+1),i=on();return this.Cc.Ae([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.Mi=function(t){var e=new oo(t,0),n=this.Sc.Pe(e);return null!==n&&t.isEqual(n.key)},t}(),oo=function(){function t(t,e){this.key=t,this.$c=e}return t.Dc=function(t,e){return B.J(t.key,e.key)||g(t.$c,e.$c)},t.xc=function(t,e){return g(t.$c,e.$c)||B.J(t.key,e.key)},t}(),uo=function(){function t(t,e){this.Ii=t,this.mi=e,this.Ho=[],this.Bc=1,this.qc=new We(oo.Dc)}return t.prototype.Pi=function(t){return Zn.resolve(0===this.Ho.length)},t.prototype.yi=function(t,e,n,r){var i=this.Bc;this.Bc++,this.Ho.length>0&&this.Ho[this.Ho.length-1];var o=new Vr(i,e,n,r);this.Ho.push(o);for(var u=0,s=r;u<s.length;u++){var a=s[u];this.qc=this.qc.add(new oo(a.key,i)),this.Ii.Qs(t,a.key.path.Z())}return Zn.resolve(o)},t.prototype.gi=function(t,e){return Zn.resolve(this.Uc(e))},t.prototype.pi=function(t,e){var n=e+1,r=this.Qc(n),i=r<0?0:r;return Zn.resolve(this.Ho.length>i?this.Ho[i]:null)},t.prototype.bi=function(){return Zn.resolve(0===this.Ho.length?-1:this.Bc-1)},t.prototype.vi=function(t){return Zn.resolve(this.Ho.slice())},t.prototype.Si=function(t,e){var n=this,r=new oo(e,0),i=new oo(e,Number.POSITIVE_INFINITY),o=[];return this.qc.Ae([r,i],(function(t){var e=n.Uc(t.$c);o.push(e)})),Zn.resolve(o)},t.prototype.Di=function(t,e){var n=this,r=new We(g);return e.forEach((function(t){var e=new oo(t,0),i=new oo(t,Number.POSITIVE_INFINITY);n.qc.Ae([e,i],(function(t){r=r.add(t.$c)}))})),Zn.resolve(this.Kc(r))},t.prototype.xi=function(t,e){var n=e.path,r=n.length+1,i=n;B.Et(i)||(i=i.child(""));var o=new oo(new B(i),0),u=new We(g);return this.qc.Re((function(t){var e=t.key.path;return!!n.st(e)&&(e.length===r&&(u=u.add(t.$c)),!0)}),o),Zn.resolve(this.Kc(u))},t.prototype.Kc=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.Uc(t);null!==r&&n.push(r)})),n},t.prototype.Ni=function(t,e){var n=this;d(0===this.Wc(e.batchId,"removed")),this.Ho.shift();var r=this.qc;return Zn.forEach(e.mutations,(function(i){var o=new oo(i.key,e.batchId);return r=r.delete(o),n.mi.Oi(t,i.key)})).next((function(){n.qc=r}))},t.prototype.Fi=function(t){},t.prototype.Mi=function(t,e){var n=new oo(e,0),r=this.qc.Pe(n);return Zn.resolve(e.isEqual(r&&r.key))},t.prototype.ki=function(t){return this.Ho.length,Zn.resolve()},t.prototype.Wc=function(t,e){return this.Qc(t)},t.prototype.Qc=function(t){return 0===this.Ho.length?0:t-this.Ho[0].batchId},t.prototype.Uc=function(t){var e=this.Qc(t);return e<0||e>=this.Ho.length?null:this.Ho[e]},t}(),so=function(){function t(t,e){this.Ii=t,this.jc=e,this.docs=new Ke(B.J),this.size=0}return t.prototype.hi=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,u=this.jc(e);return this.docs=this.docs.Ht(r,{_i:e,size:u,readTime:n}),this.size+=u-o,this.Ii.Qs(t,r.path.Z())},t.prototype.fi=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.di=function(t,e){var n=this.docs.get(e);return Zn.resolve(n?n._i:null)},t.prototype.getEntries=function(t,e){var n=this,r=Xe();return e.forEach((function(t){var e=n.docs.get(t);r=r.Ht(t,e?e._i:null)})),Zn.resolve(r)},t.prototype.jr=function(t,e,n){for(var r=tn(),i=new B(e.path.child("")),o=this.docs.ne(i);o.ae();){var u=o.ce(),s=u.key,a=u.value,c=a._i,h=a.readTime;if(!e.path.st(s.path))break;h.u(n)<=0||c instanceof wt&&re(e,c)&&(r=r.Ht(c.key,c))}return Zn.resolve(r)},t.prototype.Gc=function(t,e){return Zn.forEach(this.docs,(function(t){return e(t)}))},t.prototype.Or=function(t){return new ao(this)},t.prototype.Lr=function(t){return Zn.resolve(this.size)},t}(),ao=function(t){function e(e){var n=this;return(n=t.call(this)||this).zr=e,n}return Object(u.c)(e,t),e.prototype.Ti=function(t){var e=this,n=[];return this.ci.forEach((function(r,i){i&&i._i?n.push(e.zr.hi(t,i._i,e.ui(r))):e.zr.fi(r)})),Zn.$n(n)},e.prototype.wi=function(t,e){return this.zr.di(t,e)},e.prototype.Ei=function(t,e){return this.zr.getEntries(t,e)},e}(si),co=function(){function t(t){this.persistence=t,this.zc=new ui((function(t){return Tt(t)}),Nt),this.lastRemoteSnapshotVersion=U.min(),this.highestTargetId=0,this.Hc=0,this.Jc=new io,this.targetCount=0,this.Yc=vi.Bi()}return t.prototype.mn=function(t,e){return this.zc.forEach((function(t,n){return e(n)})),Zn.resolve()},t.prototype.Wi=function(t){return Zn.resolve(this.lastRemoteSnapshotVersion)},t.prototype.ji=function(t){return Zn.resolve(this.Hc)},t.prototype.Ui=function(t){return this.highestTargetId=this.Yc.next(),Zn.resolve(this.highestTargetId)},t.prototype.Gi=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Hc&&(this.Hc=e),Zn.resolve()},t.prototype.Hi=function(t){this.zc.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Yc=new vi(e),this.highestTargetId=e),t.sequenceNumber>this.Hc&&(this.Hc=t.sequenceNumber)},t.prototype.zi=function(t,e){return this.Hi(e),this.targetCount+=1,Zn.resolve()},t.prototype.Yi=function(t,e){return this.Hi(e),Zn.resolve()},t.prototype.Xi=function(t,e){return this.zc.delete(e.target),this.Jc.kc(e.targetId),this.targetCount-=1,Zn.resolve()},t.prototype.tr=function(t,e,n){var r=this,i=0,o=[];return this.zc.forEach((function(u,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.zc.delete(u),o.push(r.Zi(t,s.targetId)),i++)})),Zn.$n(o).next((function(){return i}))},t.prototype.er=function(t){return Zn.resolve(this.targetCount)},t.prototype.nr=function(t,e){var n=this.zc.get(e)||null;return Zn.resolve(n)},t.prototype.sr=function(t,e,n){return this.Jc.Nc(e,n),Zn.resolve()},t.prototype.rr=function(t,e,n){this.Jc.Oc(e,n);var r=this.persistence.mi,i=[];return r&&e.forEach((function(e){i.push(r.Oi(t,e))})),Zn.$n(i)},t.prototype.Zi=function(t,e){return this.Jc.kc(e),Zn.resolve()},t.prototype.ar=function(t,e){var n=this.Jc.Lc(e);return Zn.resolve(n)},t.prototype.Mi=function(t,e){return Zn.resolve(this.Jc.Mi(e))},t}(),ho=function(){function t(t,e){var n=this;this.Xc={},this.ro=new V(0),this.oo=!1,this.oo=!0,this.mi=t(this),this.wo=new co(this),this.Ii=new Zr,this.Eo=function(t,e){return new so(t,(function(t){return n.mi.Zc(t)}))}(this.Ii),this.Kt=new Ur(e),this.To=new ro(this.Kt)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.$o=function(){return this.oo=!1,Promise.resolve()},Object.defineProperty(t.prototype,"Ir",{get:function(){return this.oo},enumerable:!1,configurable:!0}),t.prototype.Vo=function(){},t.prototype.po=function(){},t.prototype.jo=function(){return this.Ii},t.prototype.Wo=function(t){var e=this.Xc[t.R()];return e||(e=new uo(this.Ii,this.mi),this.Xc[t.R()]=e),e},t.prototype.Cr=function(){return this.wo},t.prototype.kr=function(){return this.Eo},t.prototype.Go=function(){return this.To},t.prototype.runTransaction=function(t,e,n){var r=this;c("MemoryPersistence","Starting transaction:",t);var i=new fo(this.ro.next());return this.mi.ta(),n(i).next((function(t){return r.mi.ea(i).next((function(){return t}))})).Mn().then((function(t){return i.bs(),t}))},t.prototype.na=function(t,e){return Zn.Bn(Object.values(this.Xc).map((function(n){return function(){return n.Mi(t,e)}})))},t}(),fo=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ss=e,n}return Object(u.c)(e,t),e}(pr),lo=function(){function t(t){this.persistence=t,this.sa=new io,this.ia=null}return t.ra=function(e){return new t(e)},Object.defineProperty(t.prototype,"oa",{get:function(){if(this.ia)return this.ia;throw p()},enumerable:!1,configurable:!0}),t.prototype.ir=function(t,e,n){return this.sa.ir(n,e),this.oa.delete(n.toString()),Zn.resolve()},t.prototype.cr=function(t,e,n){return this.sa.cr(n,e),this.oa.add(n.toString()),Zn.resolve()},t.prototype.Oi=function(t,e){return this.oa.add(e.toString()),Zn.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.sa.kc(e.targetId).forEach((function(t){return n.oa.add(t.toString())}));var r=this.persistence.Cr();return r.ar(t,e.targetId).next((function(t){t.forEach((function(t){return n.oa.add(t.toString())}))})).next((function(){return r.Xi(t,e)}))},t.prototype.ta=function(){this.ia=new Set},t.prototype.ea=function(t){var e=this,n=this.persistence.kr().Or();return Zn.forEach(this.oa,(function(r){var i=B.ft(r);return e.ca(t,i).next((function(t){t||n.fi(i)}))})).next((function(){return e.ia=null,n.apply(t)}))},t.prototype.Mr=function(t,e){var n=this;return this.ca(t,e).next((function(t){t?n.oa.delete(e.toString()):n.oa.add(e.toString())}))},t.prototype.Zc=function(t){return 0},t.prototype.ca=function(t,e){var n=this;return Zn.Bn([function(){return Zn.resolve(n.sa.Mi(e))},function(){return n.persistence.Cr().Mi(t,e)},function(){return n.persistence.na(t,e)}])},t}();function po(t,e){return"firestore_clients_"+t+"_"+e}function vo(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.A()&&(r+="_"+e.uid),r}function yo(t,e){return"firestore_targets_"+t+"_"+e}var mo=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.aa=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),u=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(u=new E(i.error.code,i.error.message)),o?new t(e,n,i.state,u):(h("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.ua=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),go=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.aa=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new E(r.error.code,r.error.message)),i?new t(e,r.state,o):(h("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.ua=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),bo=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.aa=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=sn(),u=0;i&&u<r.activeTargetIds.length;++u)i=rt(r.activeTargetIds[u]),o=o.add(r.activeTargetIds[u]);return i?new t(e,o):(h("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),wo=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.aa=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(h("SharedClientState","Failed to parse online state: "+e),null)},t}(),Io=function(){function t(){this.activeTargetIds=sn()}return t.prototype.ha=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.la=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.ua=function(){var t={activeTargetIds:this.activeTargetIds.rt(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),_o=function(){function t(t,e,n,r,i){this.window=t,this.no=e,this.persistenceKey=n,this._a=r,this.fa=null,this.da=null,this.L=null,this.wa=this.Ea.bind(this),this.Ta=new Ke(g),this.Ir=!1,this.Ia=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ma=po(this.persistenceKey,this._a),this.Aa=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Ta=this.Ta.Ht(this._a,new Io),this.Ra=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Pa=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.ya=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.ga=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Va=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.wa)}return t.Wn=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,c,h,f,l=this;return Object(u.d)(this,(function(u){switch(u.label){case 0:return[4,this.fa.Ko()];case 1:for(t=u.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this._a&&(i=this.getItem(po(this.persistenceKey,r)))&&(o=bo.aa(r,i))&&(this.Ta=this.Ta.Ht(o.clientId,o));for(this.pa(),(s=this.storage.getItem(this.ga))&&(a=this.ba(s))&&this.va(a),c=0,h=this.Ia;c<h.length;c++)f=h[c],this.Ea(f);return this.Ia=[],this.window.addEventListener("unload",(function(){return l.$o()})),this.Ir=!0,[2]}}))}))},t.prototype.q=function(t){this.setItem(this.Aa,JSON.stringify(t))},t.prototype.Sa=function(){return this.Da(this.Ta)},t.prototype.Ca=function(t){var e=!1;return this.Ta.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.xa=function(t){this.Na(t,"pending")},t.prototype.Fa=function(t,e,n){this.Na(t,e,n),this.Oa(t)},t.prototype.ka=function(t){var e="not-current";if(this.Ca(t)){var n=this.storage.getItem(yo(this.persistenceKey,t));if(n){var r=go.aa(t,n);r&&(e=r.state)}}return this.Ma.ha(t),this.pa(),e},t.prototype.La=function(t){this.Ma.la(t),this.pa()},t.prototype.$a=function(t){return this.Ma.activeTargetIds.has(t)},t.prototype.Ba=function(t){this.removeItem(yo(this.persistenceKey,t))},t.prototype.qa=function(t,e,n){this.Ua(t,e,n)},t.prototype.Qa=function(t,e,n){var r=this;e.forEach((function(t){r.Oa(t)})),this.currentUser=t,n.forEach((function(t){r.xa(t)}))},t.prototype.Ka=function(t){this.Wa(t)},t.prototype.ja=function(){this.Ga()},t.prototype.$o=function(){this.Ir&&(this.window.removeEventListener("storage",this.wa),this.removeItem(this.ma),this.Ir=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return c("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){c("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){c("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Ea=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(c("SharedClientState","EVENT",n.key,n.newValue),n.key===this.ma)return void h("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.no.vo((function(){return Object(u.b)(e,void 0,void 0,(function(){var t,e,r,i,o,s;return Object(u.d)(this,(function(u){if(this.Ir){if(null!==n.key)if(this.Ra.test(n.key)){if(null==n.newValue)return t=this.za(n.key),[2,this.Ha(t,null)];if(e=this.Ja(n.key,n.newValue))return[2,this.Ha(e.clientId,e)]}else if(this.Pa.test(n.key)){if(null!==n.newValue&&(r=this.Ya(n.key,n.newValue)))return[2,this.Xa(r)]}else if(this.ya.test(n.key)){if(null!==n.newValue&&(i=this.Za(n.key,n.newValue)))return[2,this.tu(i)]}else if(n.key===this.ga){if(null!==n.newValue&&(o=this.ba(n.newValue)))return[2,this.va(o)]}else if(n.key===this.Aa)(s=function(t){var e=V.U;if(null!=t)try{var n=JSON.parse(t);d("number"==typeof n),e=n}catch(t){h("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==V.U&&this.L(s);else if(n.key===this.Va)return[2,this.fa.eu()]}else this.Ia.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Ma",{get:function(){return this.Ta.get(this._a)},enumerable:!1,configurable:!0}),t.prototype.pa=function(){this.setItem(this.ma,this.Ma.ua())},t.prototype.Na=function(t,e,n){var r=new mo(this.currentUser,t,e,n),i=vo(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ua())},t.prototype.Oa=function(t){var e=vo(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Wa=function(t){var e={clientId:this._a,onlineState:t};this.storage.setItem(this.ga,JSON.stringify(e))},t.prototype.Ua=function(t,e,n){var r=yo(this.persistenceKey,t),i=new go(t,e,n);this.setItem(r,i.ua())},t.prototype.Ga=function(){this.setItem(this.Va,"value-not-used")},t.prototype.za=function(t){var e=this.Ra.exec(t);return e?e[1]:null},t.prototype.Ja=function(t,e){var n=this.za(t);return bo.aa(n,e)},t.prototype.Ya=function(t,e){var n=this.Pa.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return mo.aa(new D(i),r,e)},t.prototype.Za=function(t,e){var n=this.ya.exec(t),r=Number(n[1]);return go.aa(r,e)},t.prototype.ba=function(t){return wo.aa(t)},t.prototype.Xa=function(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.fa.nu(t.batchId,t.state,t.error)]:(c("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.tu=function(t){return this.fa.su(t.targetId,t.state,t.error)},t.prototype.Ha=function(t,e){var n=this,r=e?this.Ta.Ht(t,e):this.Ta.remove(t),i=this.Da(this.Ta),o=this.Da(r),u=[],s=[];return o.forEach((function(t){i.has(t)||u.push(t)})),i.forEach((function(t){o.has(t)||s.push(t)})),this.fa.iu(u,s).then((function(){n.Ta=r}))},t.prototype.va=function(t){this.Ta.get(t.clientId)&&this.da(t.onlineState)},t.prototype.Da=function(t){var e=sn();return t.forEach((function(t,n){e=e.ye(n.activeTargetIds)})),e},t}(),Eo=function(){function t(){this.ru=new Io,this.ou={},this.da=null,this.L=null}return t.prototype.xa=function(t){},t.prototype.Fa=function(t,e,n){},t.prototype.ka=function(t){return this.ru.ha(t),this.ou[t]||"not-current"},t.prototype.qa=function(t,e,n){this.ou[t]=e},t.prototype.La=function(t){this.ru.la(t)},t.prototype.$a=function(t){return this.ru.activeTargetIds.has(t)},t.prototype.Ba=function(t){delete this.ou[t]},t.prototype.Sa=function(){return this.ru.activeTargetIds},t.prototype.Ca=function(t){return this.ru.activeTargetIds.has(t)},t.prototype.start=function(){return this.ru=new Io,Promise.resolve()},t.prototype.Qa=function(t,e,n){},t.prototype.Ka=function(t){},t.prototype.$o=function(){},t.prototype.q=function(t){},t.prototype.ja=function(){},t}(),Oo=function(){function t(){}return t.prototype.cu=function(t){},t.prototype.$o=function(){},t}(),To=function(){function t(){var t=this;this.au=function(){return t.uu()},this.hu=function(){return t.lu()},this._u=[],this.fu()}return t.prototype.cu=function(t){this._u.push(t)},t.prototype.$o=function(){window.removeEventListener("online",this.au),window.removeEventListener("offline",this.hu)},t.prototype.fu=function(){window.addEventListener("online",this.au),window.addEventListener("offline",this.hu)},t.prototype.uu=function(){c("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this._u;t<e.length;t++)(0,e[t])(0)},t.prototype.lu=function(){c("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this._u;t<e.length;t++)(0,e[t])(1)},t.Wn=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),No={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},jo=function(){function t(t){this.du=t.du,this.wu=t.wu}return t.prototype.Eu=function(t){this.Tu=t},t.prototype.Iu=function(t){this.mu=t},t.prototype.onMessage=function(t){this.Au=t},t.prototype.close=function(){this.wu()},t.prototype.send=function(t){this.du(t)},t.prototype.Ru=function(){this.Tu()},t.prototype.Pu=function(t){this.mu(t)},t.prototype.yu=function(t){this.Au(t)},t}(),Ao=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.I=e.I,n}return Object(u.c)(e,t),e.prototype.Du=function(t,e,n,r){return new Promise((function(i,u){var s=new o.f;s.listenOnce(o.c.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case o.a.NO_ERROR:var e=s.getResponseJson();c("Connection","XHR received:",JSON.stringify(e)),i(e);break;case o.a.TIMEOUT:c("Connection",'RPC "'+t+'" timed out'),u(new E(_.DEADLINE_EXCEEDED,"Request time out"));break;case o.a.HTTP_ERROR:var n=s.getStatus();if(c("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(_).indexOf(e)>=0?e:_.UNKNOWN}(r.status);u(new E(a,r.message))}else u(new E(_.UNKNOWN,"Server responded with status "+s.getStatus()))}else u(new E(_.UNAVAILABLE,"Connection failed."));break;default:p()}}finally{c("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.xu=function(t,e){var n=[this.Vu,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Object(o.g)(),u=Object(o.h)(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.T.projectId+"/databases/"+this.T.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.I};this.Su(s.initMessageHeaders,e),Object(i.l)()||Object(i.n)()||Object(i.j)()||Object(i.k)()||Object(i.o)()||Object(i.i)()||(s.httpHeadersOverwriteParam="$httpHeaders");var a=n.join("");c("Connection","Creating WebChannel: "+a,s);var h=r.createWebChannel(a,s),l=!1,p=!1,v=new jo({du:function(t){p?c("Connection","Not sending because WebChannel is closed:",t):(l||(c("Connection","Opening WebChannel transport."),h.open(),l=!0),c("Connection","WebChannel sending:",t),h.send(t))},wu:function(){return h.close()}}),y=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return y(h,o.e.EventType.OPEN,(function(){p||c("Connection","WebChannel transport opened.")})),y(h,o.e.EventType.CLOSE,(function(){p||(p=!0,c("Connection","WebChannel transport closed"),v.Pu())})),y(h,o.e.EventType.ERROR,(function(t){p||(p=!0,f("Connection","WebChannel transport errored:",t),v.Pu(new E(_.UNAVAILABLE,"The operation could not be completed")))})),y(h,o.e.EventType.MESSAGE,(function(t){var e;if(!p){var n=t.data[0];d(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){c("Connection","WebChannel received error:",i);var o=i.status,u=function(t){var e=Me[t];if(void 0!==e)return Be(e)}(o),s=i.message;void 0===u&&(u=_.INTERNAL,s="Unknown error status: "+o+" with message "+i.message),p=!0,v.Pu(new E(u,s)),h.close()}else c("Connection","WebChannel received:",n),v.yu(n)}})),y(u,o.b.STAT_EVENT,(function(t){t.stat===o.d.PROXY?c("Connection","Detected buffering proxy"):t.stat===o.d.NOPROXY&&c("Connection","Detected no buffering proxy")})),setTimeout((function(){v.Ru()}),0),v},e}(function(){function t(t){this.gu=t,this.T=t.T;var e=t.ssl?"https":"http";this.Vu=e+"://"+t.host,this.pu="projects/"+this.T.projectId+"/databases/"+this.T.database+"/documents"}return t.prototype.bu=function(t,e,n,r){var i=this.vu(t,e);c("RestConnection","Sending: ",i,n);var o={};return this.Su(o,r),this.Du(t,i,o,n).then((function(t){return c("RestConnection","Received: ",t),t}),(function(e){throw f("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Cu=function(t,e,n,r){return this.bu(t,e,n,r)},t.prototype.Su=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.2.1",t["Content-Type"]="text/plain",e)for(var n in e.V)e.V.hasOwnProperty(n)&&(t[n]=e.V[n])},t.prototype.vu=function(t,e){var n=No[t];return this.Vu+"/v1/"+e+":"+n},t}());function So(){return"undefined"!=typeof window?window:null}function xo(){return"undefined"!=typeof document?document:null}function Do(t){return new _n(t,!0)}var ko=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.no=t,this.ds=e,this.Nu=n,this.Fu=r,this.Ou=i,this.ku=0,this.Mu=null,this.Lu=Date.now(),this.reset()}return t.prototype.reset=function(){this.ku=0},t.prototype.$u=function(){this.ku=this.Ou},t.prototype.Bu=function(t){var e=this;this.cancel();var n=Math.floor(this.ku+this.qu()),r=Math.max(0,Date.now()-this.Lu),i=Math.max(0,n-r);i>0&&c("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.ku+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Mu=this.no.mr(this.ds,i,(function(){return e.Lu=Date.now(),t()})),this.ku*=this.Fu,this.ku<this.Nu&&(this.ku=this.Nu),this.ku>this.Ou&&(this.ku=this.Ou)},t.prototype.Uu=function(){null!==this.Mu&&(this.Mu.Ps(),this.Mu=null)},t.prototype.cancel=function(){null!==this.Mu&&(this.Mu.cancel(),this.Mu=null)},t.prototype.qu=function(){return(Math.random()-.5)*this.ku},t}(),Po=function(){function t(t,e,n,r,i,o){this.no=t,this.Qu=n,this.Ku=r,this.Wu=i,this.listener=o,this.state=0,this.ju=0,this.Gu=null,this.stream=null,this.zu=new ko(t,e)}return t.prototype.Hu=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.Ju=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.Yu()},t.prototype.stop=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return this.Hu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.Xu=function(){this.state=0,this.zu.reset()},t.prototype.Zu=function(){var t=this;this.Ju()&&null===this.Gu&&(this.Gu=this.no.mr(this.Qu,6e4,(function(){return t.th()})))},t.prototype.eh=function(t){this.nh(),this.stream.send(t)},t.prototype.th=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){return this.Ju()?[2,this.close(0)]:[2]}))}))},t.prototype.nh=function(){this.Gu&&(this.Gu.cancel(),this.Gu=null)},t.prototype.close=function(t,e){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(n){switch(n.label){case 0:return this.nh(),this.zu.cancel(),this.ju++,3!==t?this.zu.reset():e&&e.code===_.RESOURCE_EXHAUSTED?(h(e.toString()),h("Using maximum backoff delay to prevent overloading the backend."),this.zu.$u()):e&&e.code===_.UNAUTHENTICATED&&this.Wu.v(),null!==this.stream&&(this.sh(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Iu(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.sh=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.ih(this.ju),n=this.ju;this.Wu.getToken().then((function(e){t.ju===n&&t.rh(e)}),(function(n){e((function(){var e=new E(_.UNKNOWN,"Fetching auth token failed: "+n.message);return t.oh(e)}))}))},t.prototype.rh=function(t){var e=this,n=this.ih(this.ju);this.stream=this.ah(t),this.stream.Eu((function(){n((function(){return e.state=2,e.listener.Eu()}))})),this.stream.Iu((function(t){n((function(){return e.oh(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.Yu=function(){var t=this;this.state=4,this.zu.Bu((function(){return Object(u.b)(t,void 0,void 0,(function(){return Object(u.d)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.oh=function(t){return c("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.ih=function(t){var e=this;return function(n){e.no.ys((function(){return e.ju===t?n():(c("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Co=function(t){function e(e,n,r,i,o){var u=this;return(u=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).Kt=i,u}return Object(u.c)(e,t),e.prototype.ah=function(t){return this.Ku.xu("Listen",t)},e.prototype.onMessage=function(t){this.zu.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:p()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.qt?(d(void 0===e||"string"==typeof e),I.fromBase64String(e||"")):(d(void 0===e||e instanceof Uint8Array),I.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),u=(s=e.targetChange.cause)&&function(t){var e=void 0===t.code?_.UNKNOWN:Be(t.code);return new E(e,t.message||"")}(s);n=new vn(r,i,o,u||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=xn(t,r.document.name),o=Nn(r.document.updateTime);var s=new yt({mapValue:{fields:r.document.fields}}),a=(u=new wt(i,o,s,{}),r.targetIds||[]),c=r.removedTargetIds||[];n=new pn(a,c,u.key,u)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=xn(t,r.document),o=r.readTime?Nn(r.readTime):U.min(),s=new It(i,o),u=r.removedTargetIds||[],n=new pn([],u,s.key,s);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=xn(t,r.document),o=r.removedTargetIds||[],n=new pn([],o,i,null);else{if(!("filter"in e))return p();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new ze(r),o=h.targetId,n=new dn(o,i)}return n}(this.Kt,t),n=function(t){if(!("targetChange"in t))return U.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?U.min():e.readTime?Nn(e.readTime):U.min()}(t);return this.listener.uh(e,n)},e.prototype.hh=function(t){var e={};e.database=Pn(this.Kt),e.addTarget=function(t,e){var n,r=e.target;return(n=jt(r)?{documents:Un(t,r)}:{query:qn(t,r)}).targetId=e.targetId,e.resumeToken.o()>0?n.resumeToken=On(t,e.resumeToken):e.Mt.u(U.min())>0&&(n.readTime=En(t,e.Mt.G())),n}(this.Kt,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return p()}}(0,e.kt);return null==n?null:{"goog-listen-tags":n}}(this.Kt,t);n&&(e.labels=n),this.eh(e)},e.prototype.lh=function(t){var e={};e.database=Pn(this.Kt),e.removeTarget=t,this.eh(e)},e}(Po),Lo=function(t){function e(e,n,r,i,o){var u=this;return(u=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).Kt=i,u._h=!1,u}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"fh",{get:function(){return this._h},enumerable:!1,configurable:!0}),e.prototype.start=function(){this._h=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.sh=function(){this._h&&this.dh([])},e.prototype.ah=function(t){return this.Ku.xu("Write",t)},e.prototype.onMessage=function(t){if(d(!!t.streamToken),this.lastStreamToken=t.streamToken,this._h){this.zu.reset();var e=function(t,e){return t&&t.length>0?(d(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?Nn(t.updateTime):Nn(e);n.isEqual(U.min())&&(n=Nn(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new Ee(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=Nn(t.commitTime);return this.listener.wh(n,e)}return d(!t.writeResults||0===t.writeResults.length),this._h=!0,this.listener.Eh()},e.prototype.Th=function(){var t={};t.database=Pn(this.Kt),this.eh(t)},e.prototype.dh=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Vn(e.Kt,t)}))};this.eh(n)},e}(Po),Ro=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Ku=n,i.Kt=r,i.Ih=!1,i}return Object(u.c)(e,t),e.prototype.mh=function(){if(this.Ih)throw new E(_.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.bu=function(t,e,n){var r=this;return this.mh(),this.credentials.getToken().then((function(i){return r.Ku.bu(t,e,n,i)})).catch((function(t){throw t.code===_.UNAUTHENTICATED&&r.credentials.v(),t}))},e.prototype.Cu=function(t,e,n){var r=this;return this.mh(),this.credentials.getToken().then((function(i){return r.Ku.Cu(t,e,n,i)})).catch((function(t){throw t.code===_.UNAUTHENTICATED&&r.credentials.v(),t}))},e.prototype.terminate=function(){this.Ih=!1},e}((function(){})),Vo=function(){function t(t,e){this.fs=t,this.da=e,this.state="Unknown",this.Ah=0,this.Rh=null,this.Ph=!0}return t.prototype.yh=function(){var t=this;0===this.Ah&&(this.gh("Unknown"),this.Rh=this.fs.mr("online_state_timeout",1e4,(function(){return t.Rh=null,t.Vh("Backend didn't respond within 10 seconds."),t.gh("Offline"),Promise.resolve()})))},t.prototype.ph=function(t){"Online"===this.state?this.gh("Unknown"):(this.Ah++,this.Ah>=1&&(this.bh(),this.Vh("Connection failed 1 times. Most recent error: "+t.toString()),this.gh("Offline")))},t.prototype.set=function(t){this.bh(),this.Ah=0,"Online"===t&&(this.Ph=!1),this.gh(t)},t.prototype.gh=function(t){t!==this.state&&(this.state=t,this.da(t))},t.prototype.Vh=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Ph?(h(e),this.Ph=!1):c("OnlineStateTracker",e)},t.prototype.bh=function(){null!==this.Rh&&(this.Rh.cancel(),this.Rh=null)},t}(),Mo=function(t,e,n,r,i){var o=this;this.Sh=t,this.Dh=e,this.fs=n,this.Ch={},this.xh=[],this.Nh=new Map,this.Fh=new Set,this.Oh=[],this.kh=i,this.kh.cu((function(t){n.ys((function(){return Object(u.b)(o,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return Jo(this)?(c("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return(e=v(t)).Fh.add(4),[4,qo(e)];case 1:return n.sent(),e.Mh.set("Unknown"),e.Fh.delete(4),[4,Uo(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Mh=new Vo(n,r)};function Uo(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:if(!Jo(t))return[3,4];e=0,n=t.Oh,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function qo(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:e=0,n=t.Oh,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Fo(t,e){var n=v(t);n.Nh.has(e.targetId)||(n.Nh.set(e.targetId,e),Ho(n)?Ko(n):au(n).Ju()&&Go(n,e))}function zo(t,e){var n=v(t),r=au(n);n.Nh.delete(e),r.Ju()&&Bo(n,e),0===n.Nh.size&&(r.Ju()?r.Zu():Jo(n)&&n.Mh.set("Unknown"))}function Go(t,e){t.Lh.cn(e.targetId),au(t).hh(e)}function Bo(t,e){t.Lh.cn(e),au(t).lh(e)}function Ko(t){t.Lh=new mn({Sn:function(e){return t.Ch.Sn(e)},Dn:function(e){return t.Nh.get(e)||null}}),au(t).start(),t.Mh.yh()}function Ho(t){return Jo(t)&&!au(t).Hu()&&t.Nh.size>0}function Jo(t){return 0===v(t).Fh.size}function Wo(t){t.Lh=void 0}function Qo(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){return t.Nh.forEach((function(e,n){Go(t,e)})),[2]}))}))}function Yo(t,e){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(n){return Wo(t),Ho(t)?(t.Mh.ph(e),Ko(t)):t.Mh.set("Unknown"),[2]}))}))}function $o(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o;return Object(u.d)(this,(function(s){switch(s.label){case 0:if(t.Mh.set("Online"),!(e instanceof vn&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o;return Object(u.d)(this,(function(u){switch(u.label){case 0:n=e.cause,r=0,i=e.targetIds,u.label=1;case 1:return r<i.length?(o=i[r],t.Nh.has(o)?[4,t.Ch.$h(o,n)]:[3,3]):[3,5];case 2:u.sent(),t.Nh.delete(o),t.Lh.removeTarget(o),u.label=3;case 3:u.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),c("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Xo(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof pn?t.Lh.wn(e):e instanceof dn?t.Lh.yn(e):t.Lh.In(e),n.isEqual(U.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Ki(t.Sh)];case 8:return i=s.sent(),n.u(i)>=0?[4,function(t,e){var n=t.Lh.pn(e);return n.Oe.forEach((function(n,r){if(n.resumeToken.o()>0){var i=t.Nh.get(r);i&&t.Nh.set(r,i.$t(n.resumeToken,e))}})),n.ke.forEach((function(e){var n=t.Nh.get(e);if(n){t.Nh.set(e,n.$t(I.h,n.Mt)),Bo(t,e);var r=new ue(n.target,e,1,n.sequenceNumber);Go(t,r)}})),t.Ch.Bh(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return c("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Xo(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function Xo(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r=this;return Object(u.d)(this,(function(i){switch(i.label){case 0:if(!ir(e))throw e;return t.Fh.add(1),[4,qo(t)];case 1:return i.sent(),t.Mh.set("Offline"),n||(n=function(){return Ki(t.Sh)}),t.fs.vo((function(){return Object(u.b)(r,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return c("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Fh.delete(1),[4,Uo(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Zo(t,e){return e().catch((function(n){return Xo(t,n,e)}))}function tu(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n,r,i,o;return Object(u.d)(this,(function(u){switch(u.label){case 0:e=v(t),n=cu(e),r=e.xh.length>0?e.xh[e.xh.length-1].batchId:-1,u.label=1;case 1:if(!function(t){return Jo(t)&&t.xh.length<10}(e))return[3,7];u.label=2;case 2:return u.trys.push([2,4,,6]),[4,Wi(e.Sh,r)];case 3:return null===(i=u.sent())?(0===e.xh.length&&n.Zu(),[3,7]):(r=i.batchId,function(t,e){t.xh.push(e);var n=cu(t);n.Ju()&&n.fh&&n.dh(e.mutations)}(e,i),[3,6]);case 4:return o=u.sent(),[4,Xo(e,o)];case 5:return u.sent(),[3,6];case 6:return[3,1];case 7:return eu(e)&&nu(e),[2]}}))}))}function eu(t){return Jo(t)&&!cu(t).Hu()&&t.xh.length>0}function nu(t){cu(t).start()}function ru(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){return cu(t).Th(),[2]}))}))}function iu(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n,r,i;return Object(u.d)(this,(function(o){for(e=cu(t),n=0,r=t.xh;n<r.length;n++)i=r[n],e.dh(i.mutations);return[2]}))}))}function ou(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return r=t.xh.shift(),i=Mr.from(r,e,n),[4,Zo(t,(function(){return t.Ch.qh(i)}))];case 1:return o.sent(),[4,tu(t)];case 2:return o.sent(),[2]}}))}))}function uu(t,e){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(n){switch(n.label){case 0:return e&&cu(t).fh?[4,function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:return Ge(r=e.code)&&r!==_.ABORTED?(n=t.xh.shift(),cu(t).Xu(),[4,Zo(t,(function(){return t.Ch.Uh(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,tu(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return eu(t)&&nu(t),[2]}}))}))}function su(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n;return Object(u.d)(this,(function(r){switch(r.label){case 0:return n=v(t),e?(n.Fh.delete(2),[4,Uo(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Fh.add(2),[4,qo(n)]);case 3:r.sent(),n.Mh.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function au(t){var e=this;return t.Qh||(t.Qh=function(t,e,n){var r=v(t);return r.mh(),new Co(e,r.Ku,r.credentials,r.Kt,n)}(t.Dh,t.fs,{Eu:Qo.bind(null,t),Iu:Yo.bind(null,t),uh:$o.bind(null,t)}),t.Oh.push((function(n){return Object(u.b)(e,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return n?(t.Qh.Xu(),Ho(t)?Ko(t):t.Mh.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Qh.stop()];case 2:e.sent(),Wo(t),e.label=3;case 3:return[2]}}))}))}))),t.Qh}function cu(t){var e=this;return t.Kh||(t.Kh=function(t,e,n){var r=v(t);return r.mh(),new Lo(e,r.Ku,r.credentials,r.Kt,n)}(t.Dh,t.fs,{Eu:ru.bind(null,t),Iu:uu.bind(null,t),Eh:iu.bind(null,t),wh:ou.bind(null,t)}),t.Oh.push((function(n){return Object(u.b)(e,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return n?(t.Kh.Xu(),[4,tu(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kh.stop()];case 3:e.sent(),t.xh.length>0&&(c("RemoteStore","Stopping write stream with "+t.xh.length+" pending writes"),t.xh=[]),e.label=4;case 4:return[2]}}))}))}))),t.Kh}var hu=function(){this.Wh=void 0,this.listeners=[]},fu=function(){this.queries=new ui((function(t){return ee(t)}),te),this.onlineState="Unknown",this.jh=new Set};function lu(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,c;return Object(u.d)(this,(function(u){switch(u.label){case 0:if(n=v(t),r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new hu),!i)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),s=o,[4,n.Gh(r)];case 2:return s.Wh=u.sent(),[3,4];case 3:return a=u.sent(),c=hr(a,"Initialization of query '"+ne(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zh(n.onlineState),o.Wh&&e.Hh(o.Wh)&&yu(n),[2]}}))}))}function pu(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(u.d)(this,(function(u){return n=v(t),r=e.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.Jh(r))]:[2]}))}))}function du(t,e){for(var n=v(t),r=!1,i=0,o=e;i<o.length;i++){var u=o[i],s=u.query,a=n.queries.get(s);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Hh(u)&&(r=!0);a.Wh=u}}r&&yu(n)}function vu(t,e,n){var r=v(t),i=r.queries.get(e);if(i)for(var o=0,u=i.listeners;o<u.length;o++)u[o].onError(n);r.queries.delete(e)}function yu(t){t.jh.forEach((function(t){t.next()}))}var mu=function(){function t(t,e,n){this.query=t,this.Yh=e,this.Xh=!1,this.Zh=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hh=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new hn(t.query,t.docs,t.De,e,t.Ce,t.fromCache,t.xe,!0)}var o=!1;return this.Xh?this.tl(t)&&(this.Yh.next(t),o=!0):this.el(t,this.onlineState)&&(this.nl(t),o=!0),this.Zh=t,o},t.prototype.onError=function(t){this.Yh.error(t)},t.prototype.zh=function(t){this.onlineState=t;var e=!1;return this.Zh&&!this.Xh&&this.el(this.Zh,t)&&(this.nl(this.Zh),e=!0),e},t.prototype.el=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.sl&&n||t.docs.nt()&&"Offline"!==e)},t.prototype.tl=function(t){if(t.docChanges.length>0)return!0;var e=this.Zh&&this.Zh.hasPendingWrites!==t.hasPendingWrites;return!(!t.xe&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.nl=function(t){t=hn.Fe(t.query,t.docs,t.Ce,t.fromCache),this.Xh=!0,this.Yh.next(t)},t}(),gu=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.il=function(){return"metadata"in this.payload},t}(),bu=function(){function t(t){this.Kt=t}return t.prototype.yc=function(t){return xn(this.Kt,t)},t.prototype.gc=function(t){return t.metadata.exists?Rn(this.Kt,t.document,!1):new It(this.yc(t.metadata.name),this.Vc(t.metadata.readTime))},t.prototype.Vc=function(t){return Nn(t)},t}();!function(){function t(t,e,n){this.rl=t,this.Sh=e,this.Kt=n,this.queries=[],this.documents=[],this.progress=wu(t)}t.prototype.ol=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.cl=function(t){for(var e=new Map,n=new bu(this.Kt),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var u=n.yc(o.metadata.name),s=0,a=o.metadata.queries;s<a.length;s++){var c=a[s],h=(e.get(c)||on()).add(u);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e,n,r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return[4,eo(this.Sh,new bu(this.Kt),this.documents,this.rl.id)];case 1:t=o.sent(),e=this.cl(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?(i=r[n],[4,no(this.Sh,i,e.get(i.name))]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new fr(Object.assign({},this.progress),t))]}}))}))}}();function wu(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var Iu=function(t){this.key=t},_u=function(t){this.key=t},Eu=function(){function t(t,e){this.query=t,this.al=e,this.ul=null,this.qe=!1,this.hl=on(),this.Ce=on(),this.ll=ie(t),this._l=new an(this.ll)}return Object.defineProperty(t.prototype,"fl",{get:function(){return this.al},enumerable:!1,configurable:!0}),t.prototype.dl=function(t,e){var n=this,r=e?e.wl:new cn,i=e?e._l:this._l,o=e?e.Ce:this.Ce,u=i,s=!1,a=Ht(this.query)&&i.size===this.query.limit?i.last():null,c=Jt(this.query)&&i.size===this.query.limit?i.first():null;if(t.Zt((function(t,e){var h=i.get(t),f=e instanceof wt?e:null;f&&(f=re(n.query,f)?f:null);var l=!!h&&n.Ce.has(h.key),p=!!f&&(f.bt||n.Ce.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.El(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.ll(f,a)>0||c&&n.ll(f,c)<0)&&(s=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(s=!0)),d&&(f?(u=u.add(f),o=p?o.add(t):o.delete(t)):(u=u.delete(t),o=o.delete(t)))})),Ht(this.query)||Jt(this.query))for(;u.size>this.query.limit;){var h=Ht(this.query)?u.last():u.first();u=u.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{_l:u,wl:r,_c:s,Ce:o}},t.prototype.El=function(t,e){return t.bt&&e.hasCommittedMutations&&!e.bt},t.prototype.Ti=function(t,e,n){var r=this,i=this._l;this._l=t._l,this.Ce=t.Ce;var o=t.wl.Se();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return p()}};return n(t)-n(e)}(t.type,e.type)||r.ll(t.doc,e.doc)})),this.Tl(n);var u=e?this.Il():[],s=0===this.hl.size&&this.qe?1:0,a=s!==this.ul;return this.ul=s,0!==o.length||a?{snapshot:new hn(this.query,t._l,i,o,t.Ce,0===s,a,!1),ml:u}:{ml:u}},t.prototype.zh=function(t){return this.qe&&"Offline"===t?(this.qe=!1,this.Ti({_l:this._l,wl:new cn,Ce:this.Ce,_c:!1},!1)):{ml:[]}},t.prototype.Al=function(t){return!this.al.has(t)&&!!this._l.has(t)&&!this._l.get(t).bt},t.prototype.Tl=function(t){var e=this;t&&(t.Ue.forEach((function(t){return e.al=e.al.add(t)})),t.Qe.forEach((function(t){})),t.Ke.forEach((function(t){return e.al=e.al.delete(t)})),this.qe=t.qe)},t.prototype.Il=function(){var t=this;if(!this.qe)return[];var e=this.hl;this.hl=on(),this._l.forEach((function(e){t.Al(e.key)&&(t.hl=t.hl.add(e.key))}));var n=[];return e.forEach((function(e){t.hl.has(e)||n.push(new _u(e))})),this.hl.forEach((function(t){e.has(t)||n.push(new Iu(t))})),n},t.prototype.Rl=function(t){this.al=t.Pc,this.hl=on();var e=this.dl(t.documents);return this.Ti(e,!0)},t.prototype.Pl=function(){return hn.Fe(this.query,this._l,this.Ce,0===this.ul)},t}(),Ou=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Tu=function(t){this.key=t,this.yl=!1},Nu=function(){function t(t,e,n,r,i,o){this.Sh=t,this.gl=e,this.Vl=n,this.pl=r,this.currentUser=i,this.bl=o,this.vl={},this.Sl=new ui((function(t){return ee(t)}),te),this.Dl=new Map,this.Cl=[],this.xl=new Ke(B.J),this.Nl=new Map,this.Fl=new io,this.Ol={},this.kl=new Map,this.Ml=vi.qi(),this.onlineState="Unknown",this.Ll=void 0}return Object.defineProperty(t.prototype,"$l",{get:function(){return!0===this.Ll},enumerable:!1,configurable:!0}),t}();function ju(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return Object(u.d)(this,(function(u){switch(u.label){case 0:return n=ns(t),(o=n.Sl.get(e))?(r=o.targetId,n.pl.ka(r),i=o.view.Pl(),[3,4]):[3,1];case 1:return[4,Qi(n.Sh,Xt(e))];case 2:return s=u.sent(),a=n.pl.ka(s.targetId),r=s.targetId,[4,Au(n,e,r,"current"===a)];case 3:i=u.sent(),n.$l&&Fo(n.gl,s),u.label=4;case 4:return[2,i]}}))}))}function Au(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o,s,a,c,h;return Object(u.d)(this,(function(f){switch(f.label){case 0:return t.Bl=function(e,n,r){return function(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o,s;return Object(u.d)(this,(function(u){switch(u.label){case 0:return(i=e.view.dl(n))._c?[4,$i(t.Sh,e.query,!1).then((function(t){var n=t.documents;return e.view.dl(n,i)}))]:[3,2];case 1:i=u.sent(),u.label=2;case 2:return o=r&&r.Oe.get(e.targetId),s=e.view.Ti(i,t.$l,o),[2,(Fu(t,e.targetId,s.ml),s.snapshot)]}}))}))}(t,e,n,r)},[4,$i(t.Sh,e,!0)];case 1:return i=f.sent(),o=new Eu(e,i.Pc),s=o.dl(i.documents),a=ln.Be(n,r&&"Offline"!==t.onlineState),c=o.Ti(s,t.$l,a),Fu(t,n,c.ml),h=new Ou(e,n,o),[2,(t.Sl.set(e,h),t.Dl.has(n)?t.Dl.get(n).push(e):t.Dl.set(n,[e]),c.snapshot)]}}))}))}function Su(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return n=v(t),r=n.Sl.get(e),(i=n.Dl.get(r.targetId)).length>1?[2,(n.Dl.set(r.targetId,i.filter((function(t){return!te(t,e)}))),void n.Sl.delete(e))]:n.$l?(n.pl.La(r.targetId),n.pl.Ca(r.targetId)?[3,2]:[4,Yi(n.Sh,r.targetId,!1).then((function(){n.pl.Ba(r.targetId),zo(n.gl,r.targetId),Uu(n,r.targetId)})).catch(oi)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Uu(n,r.targetId),[4,Yi(n.Sh,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function xu(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(u.d)(this,(function(u){switch(u.label){case 0:r=rs(t),u.label=1;case 1:return u.trys.push([1,5,,6]),[4,function(t,e){var n,r=v(t),i=M.now(),o=e.reduce((function(t,e){return t.add(e.key)}),on());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Ic.Zo(t,o).next((function(o){n=o;for(var u=[],s=0,a=e;s<a.length;s++){var c=a[s],h=Se(c,n.get(c.key));null!=h&&u.push(new Pe(c.key,h,gt(h.proto.mapValue),Oe.exists(!0)))}return r.Ho.yi(t,i,u,e)}))})).then((function(t){var e=t.Fs(n);return{batchId:t.batchId,ci:e}}))}(r.Sh,e)];case 2:return i=u.sent(),r.pl.xa(i.batchId),function(t,e,n){var r=t.Ol[t.currentUser.R()];r||(r=new Ke(g)),r=r.Ht(e,n),t.Ol[t.currentUser.R()]=r}(r,i.batchId,n),[4,Bu(r,i.ci)];case 3:return u.sent(),[4,tu(r.gl)];case 4:return u.sent(),[3,6];case 5:return o=u.sent(),s=hr(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function Du(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:n=v(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Hi(n.Sh,e)];case 2:return r=i.sent(),e.Oe.forEach((function(t,e){var r=n.Nl.get(e);r&&(d(t.Ue.size+t.Qe.size+t.Ke.size<=1),t.Ue.size>0?r.yl=!0:t.Qe.size>0?d(r.yl):t.Ke.size>0&&(d(r.yl),r.yl=!1))})),[4,Bu(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,oi(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function ku(t,e,n){var r=v(t);if(r.$l&&0===n||!r.$l&&1===n){var i=[];r.Sl.forEach((function(t,n){var r=n.view.zh(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=v(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zh(e)&&(r=!0)})),r&&yu(n)}(r.Vl,e),i.length&&r.vl.uh(i),r.onlineState=e,r.$l&&r.pl.Ka(e)}}function Pu(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s,a,c;return Object(u.d)(this,(function(u){switch(u.label){case 0:return(r=v(t)).pl.qa(e,"rejected",n),i=r.Nl.get(e),(o=i&&i.key)?(s=(s=new Ke(B.J)).Ht(o,new It(o,U.min())),a=on().add(o),c=new fn(U.min(),new Map,new We(g),s,a),[4,Du(r,c)]):[3,2];case 1:return u.sent(),r.xl=r.xl.remove(o),r.Nl.delete(e),Gu(r),[3,4];case 2:return[4,Yi(r.Sh,e,!1).then((function(){return Uu(r,e,n)})).catch(oi)];case 3:u.sent(),u.label=4;case 4:return[2]}}))}))}function Cu(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:n=v(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Bi(n.Sh,e)];case 2:return i=o.sent(),Mu(n,r,null),Vu(n,r),n.pl.Fa(r,"acknowledged"),[4,Bu(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,oi(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Lu(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:r=v(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=v(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n.Ho.gi(t,e).next((function(e){return d(null!==e),r=e.keys(),n.Ho.Ni(t,e)})).next((function(){return n.Ho.ki(t)})).next((function(){return n.Ic.Zo(t,r)}))}))}(r.Sh,e)];case 2:return i=o.sent(),Mu(r,e,n),Vu(r,e),r.pl.Fa(e,"rejected",n),[4,Bu(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,oi(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Ru(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s;return Object(u.d)(this,(function(u){switch(u.label){case 0:Jo((n=v(t)).gl)||c("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,function(t){var e=v(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e.Ho.bi(t)}))}(n.Sh)];case 2:return-1===(r=u.sent())?[2,void e.resolve()]:((i=n.kl.get(r)||[]).push(e),n.kl.set(r,i),[3,4]);case 3:return o=u.sent(),s=hr(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function Vu(t,e){(t.kl.get(e)||[]).forEach((function(t){t.resolve()})),t.kl.delete(e)}function Mu(t,e,n){var r=v(t),i=r.Ol[r.currentUser.R()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Ol[r.currentUser.R()]=i}}function Uu(t,e,n){void 0===n&&(n=null),t.pl.La(e);for(var r=0,i=t.Dl.get(e);r<i.length;r++){var o=i[r];t.Sl.delete(o),n&&t.vl.ql(o,n)}t.Dl.delete(e),t.$l&&t.Fl.kc(e).forEach((function(e){t.Fl.Mi(e)||qu(t,e)}))}function qu(t,e){var n=t.xl.get(e);null!==n&&(zo(t.gl,n),t.xl=t.xl.remove(e),t.Nl.delete(n),Gu(t))}function Fu(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Iu?(t.Fl.ir(o.key,e),zu(t,o)):o instanceof _u?(c("SyncEngine","Document no longer in limbo: "+o.key),t.Fl.cr(o.key,e),t.Fl.Mi(o.key)||qu(t,o.key)):p()}}function zu(t,e){var n=e.key;t.xl.get(n)||(c("SyncEngine","New document in limbo: "+n),t.Cl.push(n),Gu(t))}function Gu(t){for(;t.Cl.length>0&&t.xl.size<t.bl;){var e=t.Cl.shift(),n=t.Ml.next();t.Nl.set(n,new Tu(e)),t.xl=t.xl.Ht(e,n),Fo(t.gl,new ue(Xt(Kt(e.path)),n,2,V.U))}}function Bu(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s;return Object(u.d)(this,(function(a){switch(a.label){case 0:return r=v(t),i=[],o=[],s=[],r.Sl.nt()?[3,3]:(r.Sl.forEach((function(t,u){s.push(r.Bl(u,e,n).then((function(t){if(t){r.$l&&r.pl.qa(u.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Ui.cc(u.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.vl.uh(i),[4,function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,h,f,l;return Object(u.d)(this,(function(u){switch(u.label){case 0:n=v(t),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Zn.forEach(e,(function(e){return Zn.forEach(e.rc,(function(r){return n.persistence.mi.ir(t,e.targetId,r)})).next((function(){return Zn.forEach(e.oc,(function(r){return n.persistence.mi.cr(t,e.targetId,r)}))}))}))}))];case 2:return u.sent(),[3,4];case 3:if(!ir(r=u.sent()))throw r;return c("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)s=o[i],a=s.targetId,s.fromCache||(h=n.dc.get(a),f=h.Mt,l=h.Bt(f),n.dc=n.dc.Ht(a,l));return[2]}}))}))}(r.Sh,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function Ku(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:return(n=v(t)).currentUser.isEqual(e)?[3,3]:(c("SyncEngine","User change. New user:",e.R()),[4,Gi(n.Sh,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.kl.forEach((function(t){t.forEach((function(t){t.reject(new E(_.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.kl.clear()}(n),n.pl.Qa(e,r.Ac,r.Rc),[4,Bu(n,r.mc)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Hu(t,e){var n=v(t),r=n.Nl.get(e);if(r&&r.yl)return on().add(r.key);var i=on(),o=n.Dl.get(e);if(!o)return i;for(var u=0,s=o;u<s.length;u++){var a=s[u],c=n.Sl.get(a);i=i.ye(c.view.fl)}return i}function Ju(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return[4,$i((n=v(t)).Sh,e.query,!0)];case 1:return r=o.sent(),i=e.view.Rl(r),[2,(n.$l&&Fu(n,e.targetId,i.ml),i)]}}))}))}function Wu(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){return[2,Zi((e=v(t)).Sh).then((function(t){return Bu(e,t)}))]}))}))}function Qu(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o;return Object(u.d)(this,(function(u){switch(u.label){case 0:return[4,function(t,e){var n=v(t),r=v(n.Ho);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.Vi(t,e).next((function(e){return e?n.Ic.Zo(t,e):Zn.resolve(null)}))}))}((i=v(t)).Sh,e)];case 1:return null===(o=u.sent())?[3,6]:"pending"!==n?[3,3]:[4,tu(i.gl)];case 2:return u.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Mu(i,e,r||null),Vu(i,e),function(t,e){v(v(t).Ho).Fi(e)}(i.Sh,e)):p(),u.label=4;case 4:return[4,Bu(i,o)];case 5:return u.sent(),[3,7];case 6:c("SyncEngine","Cannot apply mutation batch with id: "+e),u.label=7;case 7:return[2]}}))}))}function Yu(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,h;return Object(u.d)(this,(function(u){switch(u.label){case 0:return ns(n=v(t)),rs(n),!0!==e||!0===n.Ll?[3,3]:(r=n.pl.Sa(),[4,$u(n,r.rt())]);case 1:return i=u.sent(),n.Ll=!0,[4,su(n.gl,!0)];case 2:for(u.sent(),o=0,s=i;o<s.length;o++)a=s[o],Fo(n.gl,a);return[3,7];case 3:return!1!==e||!1===n.Ll?[3,7]:(c=[],h=Promise.resolve(),n.Dl.forEach((function(t,e){n.pl.$a(e)?c.push(e):h=h.then((function(){return Uu(n,e),Yi(n.Sh,e,!0)})),zo(n.gl,e)})),[4,h]);case 4:return u.sent(),[4,$u(n,c)];case 5:return u.sent(),function(t){var e=v(t);e.Nl.forEach((function(t,n){zo(e.gl,n)})),e.Fl.Mc(),e.Nl=new Map,e.xl=new Ke(B.J)}(n),n.Ll=!1,[4,su(n.gl,!1)];case 6:u.sent(),u.label=7;case 7:return[2]}}))}))}function $u(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a,c,h,f,l,p,d,y,m;return Object(u.d)(this,(function(u){switch(u.label){case 0:n=v(t),r=[],i=[],o=0,s=e,u.label=1;case 1:return o<s.length?(a=s[o],c=void 0,(h=n.Dl.get(a))&&0!==h.length?[4,Qi(n.Sh,Xt(h[0]))]:[3,7]):[3,13];case 2:c=u.sent(),f=0,l=h,u.label=3;case 3:return f<l.length?(p=l[f],d=n.Sl.get(p),[4,Ju(n,d)]):[3,6];case 4:(y=u.sent()).snapshot&&i.push(y.snapshot),u.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Xi(n.Sh,a)];case 8:return m=u.sent(),[4,Qi(n.Sh,m)];case 9:return c=u.sent(),[4,Au(n,Xu(m),a,!1)];case 10:u.sent(),u.label=11;case 11:r.push(c),u.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vl.uh(i),r)]}}))}))}function Xu(t){return Bt(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Zu(t){var e=v(t);return v(v(e.Sh).persistence).Ko()}function ts(t,e,n,r){return Object(u.b)(this,void 0,void 0,(function(){var i,o,s;return Object(u.d)(this,(function(u){switch(u.label){case 0:return(i=v(t)).Ll?(c("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Dl.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Zi(i.Sh)];case 3:return o=u.sent(),s=fn.$e(e,"current"===n),[4,Bu(i,o,s)];case 4:return u.sent(),[3,8];case 5:return[4,Yi(i.Sh,e,!0)];case 6:return u.sent(),Uu(i,e,r),[3,8];case 7:p(),u.label=8;case 8:return[2]}}))}))}function es(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s,a,h,f,l,p,d;return Object(u.d)(this,(function(v){switch(v.label){case 0:if(!(r=ns(t)).Ll)return[3,10];i=0,o=e,v.label=1;case 1:return i<o.length?(s=o[i],r.Dl.has(s)?(c("SyncEngine","Adding an already active target "+s),[3,5]):[4,Xi(r.Sh,s)]):[3,6];case 2:return a=v.sent(),[4,Qi(r.Sh,a)];case 3:return h=v.sent(),[4,Au(r,Xu(a),h.targetId,!1)];case 4:v.sent(),Fo(r.gl,h),v.label=5;case 5:return i++,[3,1];case 6:f=function(t){return Object(u.d)(this,(function(e){switch(e.label){case 0:return r.Dl.has(t)?[4,Yi(r.Sh,t,!1).then((function(){zo(r.gl,t),Uu(r,t)})).catch(oi)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,p=n,v.label=7;case 7:return l<p.length?(d=p[l],[5,f(d)]):[3,10];case 8:v.sent(),v.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function ns(t){var e=v(t);return e.gl.Ch.Bh=Du.bind(null,e),e.gl.Ch.Sn=Hu.bind(null,e),e.gl.Ch.$h=Pu.bind(null,e),e.vl.uh=du.bind(null,e.Vl),e.vl.ql=vu.bind(null,e.Vl),e}function rs(t){var e=v(t);return e.gl.Ch.qh=Cu.bind(null,e),e.gl.Ch.Uh=Lu.bind(null,e),e}var is=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return this.Kt=Do(t.gu.T),this.pl=this.jl(t),this.persistence=this.Gl(t),[4,this.persistence.start()];case 1:return e.sent(),this.zl=this.Hl(t),this.Sh=this.Jl(t),[2]}}))}))},t.prototype.Hl=function(t){return null},t.prototype.Jl=function(t){return zi(this.persistence,new qi,t.Yl,this.Kt)},t.prototype.Gl=function(t){return new ho(lo.ra,this.Kt)},t.prototype.jl=function(t){return new Eo},t.prototype.terminate=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return this.zl&&this.zl.stop(),[4,this.pl.$o()];case 1:return t.sent(),[4,this.persistence.$o()];case 2:return t.sent(),[2]}}))}))},t}(),os=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Xl=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(u.c)(e,t),e.prototype.initialize=function(e){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,to(this.Sh)];case 2:return n.sent(),[4,this.Xl.initialize(this,e)];case 3:return n.sent(),[4,rs(this.Xl.fa)];case 4:return n.sent(),[4,tu(this.Xl.gl)];case 5:return n.sent(),[2]}}))}))},e.prototype.Jl=function(t){return zi(this.persistence,new qi,t.Yl,this.Kt)},e.prototype.Hl=function(t){var e=this.persistence.mi.dr;return new _i(e,t.fs)},e.prototype.Gl=function(t){var e=Vi(t.gu.T,t.gu.persistenceKey),n=void 0!==this.cacheSizeBytes?ii.Zs(this.cacheSizeBytes):ii.ni;return new Ci(this.synchronizeTabs,e,t.clientId,n,t.fs,So(),xo(),this.Kt,this.pl,!!this.forceOwnership)},e.prototype.jl=function(t){return new Eo},e}(is),us=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Xl=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(u.c)(e,t),e.prototype.initialize=function(e){return Object(u.b)(this,void 0,void 0,(function(){var n,r=this;return Object(u.d)(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Xl.fa,this.pl instanceof _o?(this.pl.fa={nu:Qu.bind(null,n),su:ts.bind(null,n),iu:es.bind(null,n),Ko:Zu.bind(null,n),eu:Wu.bind(null,n)},[4,this.pl.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.yo((function(t){return Object(u.b)(r,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return[4,Yu(this.Xl.fa,t)];case 1:return e.sent(),this.zl&&(t&&!this.zl.Ir?this.zl.start(this.Sh):t||this.zl.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.jl=function(t){var e=So();if(!_o.Wn(e))throw new E(_.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Vi(t.gu.T,t.gu.persistenceKey);return new _o(e,t.fs,n,t.clientId,t.Yl)},e}(os),ss=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n=this;return Object(u.d)(this,(function(r){switch(r.label){case 0:return this.Sh?[3,2]:(this.Sh=t.Sh,this.pl=t.pl,this.Dh=this.Zl(e),this.gl=this.t_(e),this.Vl=this.e_(e),this.fa=this.n_(e,!t.synchronizeTabs),this.pl.da=function(t){return ku(n.fa,t,1)},this.gl.Ch.s_=Ku.bind(null,this.fa),[4,su(this.gl,this.fa.$l)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.e_=function(t){return new fu},t.prototype.Zl=function(t){var e,n=Do(t.gu.T),r=(e=t.gu,new Ao(e));return function(t,e,n){return new Ro(t,e,n)}(t.credentials,r,n)},t.prototype.t_=function(t){var e,n,r,i,o,u=this;return e=this.Sh,n=this.Dh,r=t.fs,i=function(t){return ku(u.fa,t,0)},o=To.Wn()?new To:new Oo,new Mo(e,n,r,i,o)},t.prototype.n_=function(t,e){return function(t,e,n,r,i,o,u){var s=new Nu(t,e,n,r,i,o);return u&&(s.Ll=!0),s}(this.Sh,this.gl,this.Vl,this.pl,t.Yl,t.bl,e)},t.prototype.terminate=function(){return function(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return e=v(t),c("RemoteStore","RemoteStore shutting down."),e.Fh.add(5),[4,qo(e)];case 1:return n.sent(),e.kh.$o(),e.Mh.set("Unknown"),[2]}}))}))}(this.gl)},t}();var as=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.i_(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.i_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.r_=function(){this.muted=!0},t.prototype.i_=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),cs=(function(){function t(t,e){var n=this;this.o_=t,this.Kt=e,this.metadata=new Xn,this.buffer=new Uint8Array,this.c_=new TextDecoder("utf-8"),this.a_().then((function(t){t&&t.il()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.o_.cancel()},t.prototype.getMetadata=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Kl=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.a_())]}}))}))},t.prototype.a_=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e,n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:return[4,this.u_()];case 1:return null===(t=i.sent())?[2,null]:(e=this.c_.decode(t),n=Number(e),isNaN(n)&&this.h_("length string ("+e+") is not valid number"),[4,this.l_(n)]);case 2:return r=i.sent(),[2,new gu(JSON.parse(r),t.length+n)]}}))}))},t.prototype.__=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.u_=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return this.__()<0?[4,this.f_()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.__())<0&&this.h_("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.l_=function(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.f_()]:[3,3];case 1:n.sent()&&this.h_("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.c_.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.h_=function(t){throw this.o_.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.f_=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return[4,this.o_.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new E(_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.d_=new G(t)}return t.prototype.isEqual=function(t){return this.d_.isEqual(t.d_)},t}()),hs=function(t){this._methodName=t};function fs(t,e,n){if(!n)throw new E(_.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function ls(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new E(_.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ps(t,e,n,r){if(!0===e&&!0===r)throw new E(_.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function ds(t){if(!B.Et(t))throw new E(_.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function vs(t){if(B.Et(t))throw new E(_.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function ys(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":p()}function ms(t,e){if("_delegate"in t&&(t=t._),!(t instanceof e)){if(e.name===t.constructor.name)throw new E(_.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=ys(t);throw new E(_.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function gs(t,e){if(e<=0)throw new E(_.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var bs=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new E(_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new E(_.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,ps("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),ws=new Map,Is=function(){function t(t,e){this.w_="(lite)",this.E_=new bs({}),this.T_=!1,t instanceof x?(this.I_=t,this.m_=new P):(this.A_=t,this.I_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new E(_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new x(t.options.projectId)}(t),this.m_=new C(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this.A_)throw new E(_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.A_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"R_",{get:function(){return this.T_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"P_",{get:function(){return void 0!==this.y_},enumerable:!1,configurable:!0}),t.prototype.g_=function(t){if(this.T_)throw new E(_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this.E_=new bs(t),void 0!==t.credentials&&(this.m_=function(t){if(!t)return new P;switch(t.type){case"gapi":var e=t.client;return d(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new R(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new E(_.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype.V_=function(){return this.E_},t.prototype.p_=function(){return this.T_=!0,this.E_},t.prototype._delete=function(){return this.y_||(this.y_=this.b_()),this.y_},t.prototype.b_=function(){return this,(t=ws.get(this))&&(c("ComponentProvider","Removing Datastore"),ws.delete(this),t.terminate()),Promise.resolve();var t},t}(),_s=function(){function t(t,e,n){this.v_=e,this.S_=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"D_",{get:function(){return this.S_.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.S_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this.S_.path.ot()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Os(this.firestore,this.v_,this.S_.path.Z())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this.S_)},t}(),Es=function(){function t(t,e,n){this.v_=e,this.C_=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this.C_)},t}(),Os=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Kt(r))||this).firestore=e,i.D_=r,i.type="collection",i}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.C_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.C_.path.ot()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.D_.Z();return t.nt()?null:new _s(this.firestore,null,new B(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this.D_)},e}(Es);function Ts(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof T&&(t=t._),fs("collection","path",e),t instanceof Is)return vs(n=F.ct.apply(F,Object(u.g)([e],r))),new Os(t,null,n);if(!(t instanceof _s||t instanceof Os))throw new E(_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return vs(n=F.ct.apply(F,Object(u.g)([t.path],r)).child(F.ct(e))),new Os(t.firestore,null,n)}function Ns(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof T&&(t=t._),1===arguments.length&&(e=m.t()),fs("doc","path",e),t instanceof Is)return ds(n=F.ct.apply(F,Object(u.g)([e],r))),new _s(t,null,new B(n));if(!(t instanceof _s||t instanceof Os))throw new E(_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ds(n=t.D_.child(F.ct.apply(F,Object(u.g)([e],r)))),new _s(t.firestore,t instanceof Os?t.v_:null,new B(n))}function js(t,e){return t instanceof T&&(t=t._),e instanceof T&&(e=e._),(t instanceof _s||t instanceof Os)&&(e instanceof _s||e instanceof Os)&&t.firestore===e.firestore&&t.path===e.path&&t.v_===e.v_}function As(t,e){return t instanceof T&&(t=t._),e instanceof T&&(e=e._),t instanceof Es&&e instanceof Es&&t.firestore===e.firestore&&te(t.C_,e.C_)&&t.v_===e.v_}var Ss=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new E(_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new E(_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.x_=t,this.N_=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.x_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.N_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.x_===t.x_&&this.N_===t.N_},t.prototype.toJSON=function(){return{latitude:this.x_,longitude:this.N_}},t.prototype.K=function(t){return g(this.x_,t.x_)||g(this.N_,t.N_)},t}(),xs=/^__.*__$/,Ds=function(){function t(t,e,n){this.data=t,this.zt=e,this.fieldTransforms=n}return t.prototype.F_=function(t,e){return null!==this.zt?new Pe(t,this.data,this.zt,e,this.fieldTransforms):new ke(t,this.data,e,this.fieldTransforms)},t}(),ks=function(){function t(t,e,n){this.data=t,this.zt=e,this.fieldTransforms=n}return t.prototype.F_=function(t,e){return new Pe(t,this.data,this.zt,e,this.fieldTransforms)},t}();function Ps(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw p()}}var Cs=function(){function t(t,e,n,r,i,o){this.settings=t,this.T=e,this.Kt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.O_(),this.fieldTransforms=i||[],this.zt=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k_",{get:function(){return this.settings.k_},enumerable:!1,configurable:!0}),t.prototype.M_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.T,this.Kt,this.ignoreUndefinedProperties,this.fieldTransforms,this.zt)},t.prototype.L_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.M_({path:n,B_:!1});return r.q_(t),r},t.prototype.U_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.M_({path:n,B_:!1});return r.O_(),r},t.prototype.Q_=function(t){return this.M_({path:void 0,B_:!0})},t.prototype.K_=function(t){return ta(t,this.settings.methodName,this.settings.W_||!1,this.path,this.settings.j_)},t.prototype.contains=function(t){return void 0!==this.zt.find((function(e){return t.st(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.st(e.field)}))},t.prototype.O_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.q_(this.path.get(t))},t.prototype.q_=function(t){if(0===t.length)throw this.K_("Document fields must not be empty");if(Ps(this.k_)&&xs.test(t))throw this.K_('Document fields cannot begin and end with "__"')},t}(),Ls=function(){function t(t,e,n){this.T=t,this.ignoreUndefinedProperties=e,this.Kt=n||Do(t)}return t.prototype.G_=function(t,e,n,r){return void 0===r&&(r=!1),new Cs({k_:t,methodName:e,j_:n,path:G.at(),B_:!1,W_:r},this.T,this.Kt,this.ignoreUndefinedProperties)},t}();function Rs(t){var e=t.p_(),n=Do(t.I_);return new Ls(t.I_,!!e.ignoreUndefinedProperties,n)}function Vs(t,e,n,r,i,o){void 0===o&&(o={});var u=t.G_(o.merge||o.mergeFields?2:0,e,n,i);Ys("Data must be an object, but it was:",u,r);var s,a,c=Ws(r,u);if(o.merge)s=new W(u.zt),a=u.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=$s(e,l[f],n);if(!u.contains(p))throw new E(_.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");ea(h,p)||h.push(p)}s=new W(h),a=u.fieldTransforms.filter((function(t){return s.It(t.field)}))}else s=null,a=u.fieldTransforms;return new Ds(new yt(c),s,a)}var Ms=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.z_=function(t){if(2!==t.k_)throw 1===t.k_?t.K_(this._methodName+"() can only appear at the top level of your update data"):t.K_(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.zt.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(hs);function Us(t,e,n){return new Cs({k_:3,j_:e.settings.j_,methodName:t._methodName,B_:n},e.T,e.Kt,e.ignoreUndefinedProperties)}var qs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.z_=function(t){return new _e(t.path,new de)},e.prototype.isEqual=function(t){return t instanceof e},e}(hs),Fs=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).H_=n,r}return Object(u.c)(e,t),e.prototype.z_=function(t){var e=Us(this,t,!0),n=this.H_.map((function(t){return Js(t,e)})),r=new ve(n);return new _e(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(hs),zs=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).H_=n,r}return Object(u.c)(e,t),e.prototype.z_=function(t){var e=Us(this,t,!0),n=this.H_.map((function(t){return Js(t,e)})),r=new me(n);return new _e(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(hs),Gs=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).J_=n,r}return Object(u.c)(e,t),e.prototype.z_=function(t){var e=new be(t.Kt,ce(t.Kt,this.J_));return new _e(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(hs);function Bs(t,e,n,r){var i=t.G_(1,e,n);Ys("Data must be an object, but it was:",i,r);var o=[],u=new mt;H(r,(function(t,r){var s=Zs(e,t,n);r instanceof T&&(r=r._);var a=i.U_(s);if(r instanceof Ms)o.push(s);else{var c=Js(r,a);null!=c&&(o.push(s),u.set(s,c))}}));var s=new W(o);return new ks(u.yt(),s,i.fieldTransforms)}function Ks(t,e,n,r,i,o){var u=t.G_(1,e,n),s=[$s(e,r,n)],a=[i];if(o.length%2!=0)throw new E(_.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)s.push($s(e,o[c])),a.push(o[c+1]);for(var h=[],f=new mt,l=s.length-1;l>=0;--l)if(!ea(h,s[l])){var p=s[l],d=a[l];d instanceof T&&(d=d._);var v=u.U_(p);if(d instanceof Ms)h.push(p);else{var y=Js(d,v);null!=y&&(h.push(p),f.set(p,y))}}var m=new W(h);return new ks(f.yt(),m,u.fieldTransforms)}function Hs(t,e,n,r){return void 0===r&&(r=!1),Js(n,t.G_(r?4:3,e))}function Js(t,e){if(t instanceof T&&(t=t._),Qs(t))return Ys("Unsupported field value:",e,t),Ws(t,e);if(t instanceof hs)return function(t,e){if(!Ps(e.k_))throw e.K_(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.K_(t._methodName+"() is not currently supported inside arrays");var n=t.z_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.zt.push(e.path),t instanceof Array){if(e.settings.B_&&4!==e.k_)throw e.K_("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var u=Js(o[i],e.Q_(r));null==u&&(u={nullValue:"NULL_VALUE"}),n.push(u),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof T&&(t=t._),null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ce(e.Kt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=M.fromDate(t);return{timestampValue:En(e.Kt,n)}}if(t instanceof M)return n=new M(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:En(e.Kt,n)};if(t instanceof Ss)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof O)return{bytesValue:On(e.Kt,t.l)};if(t instanceof _s){n=e.T;var r=t.firestore.I_;if(!r.isEqual(n))throw e.K_("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:jn(t.firestore.I_||e.T,t.S_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.K_("Unsupported field value: "+ys(t))}(t,e)}function Ws(t,e){var n={};return J(t)?e.path&&e.path.length>0&&e.zt.push(e.path):H(t,(function(t,r){var i=Js(r,e.L_(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Qs(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof M||t instanceof Ss||t instanceof O||t instanceof _s||t instanceof hs)}function Ys(t,e,n){if(!Qs(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=ys(n);throw"an object"===r?e.K_(t+" a custom object"):e.K_(t+" "+r)}}function $s(t,e,n){if(e instanceof T&&(e=e._),e instanceof cs)return e.d_;if("string"==typeof e)return Zs(t,e);throw ta("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Xs=new RegExp("[~\\*/\\[\\]]");function Zs(t,e,n){if(e.search(Xs)>=0)throw ta("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(cs.bind.apply(cs,Object(u.g)([void 0],e.split("."))))).d_}catch(r){throw ta("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function ta(t,e,n,r,i){var o=r&&!r.nt(),u=void 0!==i,s="Function "+e+"() called with invalid data";n&&(s+=" (via `toFirestore()`)");var a="";return(o||u)&&(a+=" (found",o&&(a+=" in field "+r),u&&(a+=" in document "+i),a+=")"),new E(_.INVALID_ARGUMENT,(s+=". ")+t+a)}function ea(t,e){return t.some((function(t){return t.isEqual(e)}))}var na=function(){function t(t){this.Dh=t,this.Y_=new Map,this.mutations=[],this.X_=!1,this.Z_=null,this.tf=new Set}return t.prototype.ef=function(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n=this;return Object(u.d)(this,(function(r){switch(r.label){case 0:if(this.nf(),this.mutations.length>0)throw new E(_.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return Object(u.d)(this,(function(u){switch(u.label){case 0:return n=v(t),r=Pn(n.Kt)+"/documents",i={documents:e.map((function(t){return Sn(n.Kt,t)}))},[4,n.Cu("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){d(!!e.found),e.found.name,e.found.updateTime;var n=xn(t,e.found.name),r=Nn(e.found.updateTime),i=new yt({mapValue:{fields:e.found.fields}});return new wt(n,r,i,{})}(t,e):"missing"in e?function(t,e){d(!!e.missing),d(!!e.readTime);var n=xn(t,e.missing),r=Nn(e.readTime);return new It(n,r)}(t,e):p()}(n.Kt,t);s.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());d(!!e),a.push(e)})),a)]}}))}))}(this.Dh,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof It||t instanceof wt?n.sf(t):p()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.F_(t,this.Gt(t))),this.tf.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.F_(t,this.rf(t)))}catch(t){this.Z_=t}this.tf.add(t.toString())},t.prototype.delete=function(t){this.write(new qe(t,this.Gt(t))),this.tf.add(t.toString())},t.prototype.commit=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e=this;return Object(u.d)(this,(function(n){switch(n.label){case 0:if(this.nf(),this.Z_)throw this.Z_;return t=this.Y_,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=B.ft(n);e.mutations.push(new Fe(r,e.Gt(r)))})),[4,function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return n=v(t),r=Pn(n.Kt)+"/documents",i={writes:e.map((function(t){return Vn(n.Kt,t)}))},[4,n.bu("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.Dh,this.mutations)];case 1:return n.sent(),this.X_=!0,[2]}}))}))},t.prototype.sf=function(t){var e;if(t instanceof wt)e=t.version;else{if(!(t instanceof It))throw p();e=U.min()}var n=this.Y_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new E(_.ABORTED,"Document version changed between two reads.")}else this.Y_.set(t.key.toString(),e)},t.prototype.Gt=function(t){var e=this.Y_.get(t.toString());return!this.tf.has(t.toString())&&e?Oe.updateTime(e):Oe.Wt()},t.prototype.rf=function(t){var e=this.Y_.get(t.toString());if(!this.tf.has(t.toString())&&e){if(e.isEqual(U.min()))throw new E(_.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Oe.updateTime(e)}return Oe.exists(!0)},t.prototype.write=function(t){this.nf(),this.mutations.push(t)},t.prototype.nf=function(){},t}(),ra=function(){function t(t,e,n,r){this.fs=t,this.Dh=e,this.updateFunction=n,this.Ts=r,this.cf=5,this.zu=new ko(this.fs,"transaction_retry")}return t.prototype.run=function(){this.af()},t.prototype.af=function(){var t=this;this.zu.Bu((function(){return Object(u.b)(t,void 0,void 0,(function(){var t,e,n=this;return Object(u.d)(this,(function(r){return t=new na(this.Dh),(e=this.uf(t))&&e.then((function(e){n.fs.ys((function(){return t.commit().then((function(){n.Ts.resolve(e)})).catch((function(t){n.hf(t)}))}))})).catch((function(t){n.hf(t)})),[2]}))}))}))},t.prototype.uf=function(t){try{var e=this.updateFunction(t);return!et(e)&&e.catch&&e.then?e:(this.Ts.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Ts.reject(t),null}},t.prototype.hf=function(t){var e=this;this.cf>0&&this.lf(t)?(this.cf-=1,this.fs.ys((function(){return e.af(),Promise.resolve()}))):this.Ts.reject(t)},t.prototype.lf=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ge(e)}return!1},t}(),ia=function(){function t(t,e,n){var r=this;this.credentials=t,this.fs=e,this.gu=n,this.user=D.UNAUTHENTICATED,this.clientId=m.t(),this._f=function(){},this.N=new Xn,this.credentials.S((function(t){c("FirestoreClient","Received user=",t.uid),r.user=t,r._f(t),r.N.resolve()}))}return t.prototype.getConfiguration=function(){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return[4,this.N.promise];case 1:return[2,(t.sent(),{fs:this.fs,gu:this.gu,clientId:this.clientId,credentials:this.credentials,Yl:this.user,bl:100})]}}))}))},t.prototype.ff=function(t){var e=this;this._f=t,this.N.promise.then((function(){return e._f(e.user)}))},t.prototype.df=function(){if(this.fs.wf)throw new E(_.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.fs.Ef();var e=new Xn;return this.fs.Tf((function(){return Object(u.b)(t,void 0,void 0,(function(){var t,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.If?[4,this.If.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.mf?[4,this.mf.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.D(),e.resolve(),[3,6];case 5:return t=r.sent(),n=hr(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function oa(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r,i=this;return Object(u.d)(this,(function(o){switch(o.label){case 0:return t.fs.Af(),c("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.Yl,t.ff((function(n){r.isEqual(n)||(r=n,t.fs.vo((function(){return Object(u.b)(i,void 0,void 0,(function(){return Object(u.d)(this,(function(t){switch(t.label){case 0:return[4,Gi(e.Sh,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.Vo((function(){return t.terminate()})),t.mf=e,[2]}}))}))}function ua(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:return t.fs.Af(),[4,sa(t)];case 1:return n=i.sent(),c("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.ff((function(n){return t.fs.vo((function(){return function(t,e){return Object(u.b)(this,void 0,void 0,(function(){var n,r;return Object(u.d)(this,(function(i){switch(i.label){case 0:return(n=v(t)).fs.Af(),c("RemoteStore","RemoteStore received new credentials"),r=Jo(n),n.Fh.add(3),[4,qo(n)];case 1:return i.sent(),r&&n.Mh.set("Unknown"),[4,n.Ch.s_(e)];case 2:return i.sent(),n.Fh.delete(3),[4,Uo(n)];case 3:return i.sent(),[2]}}))}))}(e.gl,n)}))})),t.If=e,[2]}}))}))}function sa(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return t.mf?[3,2]:(c("FirestoreClient","Using default OfflineComponentProvider"),[4,oa(t,new is)]);case 1:e.sent(),e.label=2;case 2:return[2,t.mf]}}))}))}function aa(t){return Object(u.b)(this,void 0,void 0,(function(){return Object(u.d)(this,(function(e){switch(e.label){case 0:return t.If?[3,2]:(c("FirestoreClient","Using default OnlineComponentProvider"),[4,ua(t,new ss)]);case 1:e.sent(),e.label=2;case 2:return[2,t.If]}}))}))}function ca(t){return sa(t).then((function(t){return t.persistence}))}function ha(t){return sa(t).then((function(t){return t.Sh}))}function fa(t){return aa(t).then((function(t){return t.gl}))}function la(t){return aa(t).then((function(t){return t.fa}))}function pa(t){return Object(u.b)(this,void 0,void 0,(function(){var e,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:return[4,aa(t)];case 1:return e=r.sent(),[2,((n=e.Vl).Gh=ju.bind(null,e.fa),n.Jh=Su.bind(null,e.fa),n)]}}))}))}function da(t,e,n){var r=this;void 0===n&&(n={});var i=new Xn;return t.fs.ys((function(){return Object(u.b)(r,void 0,void 0,(function(){var r;return Object(u.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new as({next:function(o){e.ys((function(){return pu(t,u)}));var s=o.docs.has(n);!s&&o.fromCache?i.reject(new E(_.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&o.fromCache&&r&&"server"===r.source?i.reject(new E(_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),u=new mu(Kt(n.path),o,{includeMetadataChanges:!0,sl:!0});return lu(t,u)},[4,pa(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.fs,e,n,i])]}}))}))})),i.promise}function va(t,e,n){var r=this;void 0===n&&(n={});var i=new Xn;return t.fs.ys((function(){return Object(u.b)(r,void 0,void 0,(function(){var r;return Object(u.d)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new as({next:function(n){e.ys((function(){return pu(t,u)})),n.fromCache&&"server"===r.source?i.reject(new E(_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),u=new mu(n,o,{includeMetadataChanges:!0,sl:!0});return lu(t,u)},[4,pa(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.fs,e,n,i])]}}))}))})),i.promise}var ya=function(){function t(){var t=this;this.Rf=Promise.resolve(),this.Pf=[],this.yf=!1,this.gf=[],this.Vf=null,this.pf=!1,this.bf=[],this.zu=new ko(this,"async_queue_retry"),this.vf=function(){var e=xo();e&&c("AsyncQueue","Visibility state changed to "+e.visibilityState),t.zu.Uu()};var e=xo();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.vf)}return Object.defineProperty(t.prototype,"wf",{get:function(){return this.yf},enumerable:!1,configurable:!0}),t.prototype.ys=function(t){this.enqueue(t)},t.prototype.Tf=function(t){this.Sf(),this.Df(t)},t.prototype.Ef=function(){if(!this.yf){this.yf=!0;var t=xo();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.vf)}},t.prototype.enqueue=function(t){return this.Sf(),this.yf?new Promise((function(t){})):this.Df(t)},t.prototype.vo=function(t){var e=this;this.ys((function(){return e.Pf.push(t),e.Cf()}))},t.prototype.Cf=function(){return Object(u.b)(this,void 0,void 0,(function(){var t,e=this;return Object(u.d)(this,(function(n){switch(n.label){case 0:if(0===this.Pf.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.Pf[0]()];case 2:return n.sent(),this.Pf.shift(),this.zu.reset(),[3,4];case 3:if(!ir(t=n.sent()))throw t;return c("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.Pf.length>0&&this.zu.Bu((function(){return e.Cf()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Df=function(t){var e=this,n=this.Rf.then((function(){return e.pf=!0,t().catch((function(t){throw e.Vf=t,e.pf=!1,h("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.pf=!1,t}))}));return this.Rf=n,n},t.prototype.mr=function(t,e,n){var r=this;this.Sf(),this.bf.indexOf(t)>-1&&(e=0);var i=cr.Is(this,t,e,n,(function(t){return r.xf(t)}));return this.gf.push(i),i},t.prototype.Sf=function(){this.Vf&&p()},t.prototype.Af=function(){},t.prototype.Nf=function(){return Object(u.b)(this,void 0,void 0,(function(){var t;return Object(u.d)(this,(function(e){switch(e.label){case 0:return[4,t=this.Rf];case 1:e.sent(),e.label=2;case 2:if(t!==this.Rf)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.Ff=function(t){for(var e=0,n=this.gf;e<n.length;e++)if(n[e].ds===t)return!0;return!1},t.prototype.Of=function(t){var e=this;return this.Nf().then((function(){e.gf.sort((function(t,e){return t.ws-e.ws}));for(var n=0,r=e.gf;n<r.length;n++){var i=r[n];if(i.Ps(),"all"!==t&&i.ds===t)break}return e.Nf()}))},t.prototype.kf=function(t){this.bf.push(t)},t.prototype.xf=function(t){var e=this.gf.indexOf(t);this.gf.splice(e,1)},t}(),ma=-1,ga=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).Mf=new ya,r.w_="name"in e?e.name:"[DEFAULT]",r}return Object(u.c)(e,t),e.prototype.b_=function(){return this.Lf||wa(this),this.Lf.terminate()},e}(Is);function ba(t){return t.Lf||wa(t),t.Lf.df(),t.Lf}function wa(t){var e=t.p_(),n=function(t,e,n){return new S(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t.I_,t.w_,e);t.Lf=new ia(t.m_,t.Mf,n)}function Ia(t,e,n){var r=this,i=new Xn;return t.fs.enqueue((function(){return Object(u.b)(r,void 0,void 0,(function(){var r;return Object(u.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,oa(t,n)];case 1:return o.sent(),[4,ua(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===_.FAILED_PRECONDITION||t.code===_.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function _a(t){if(t.R_||t.P_)throw new E(_.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Ea=function(){function t(){}return t.prototype.$f=function(t,e){switch(void 0===e&&(e="none"),it(t)){case 0:return null;case 1:return t.booleanValue;case 2:return $(t.integerValue||t.doubleValue);case 3:return this.Bf(t.timestampValue);case 4:return this.qf(t,e);case 5:return t.stringValue;case 6:return this.Uf(X(t.bytesValue));case 7:return this.Qf(t.referenceValue);case 8:return this.Kf(t.geoPointValue);case 9:return this.Wf(t.arrayValue,e);case 10:return this.jf(t.mapValue,e);default:throw p()}},t.prototype.jf=function(t,e){var n=this,r={};return H(t.fields||{},(function(t,i){r[t]=n.$f(i,e)})),r},t.prototype.Kf=function(t){return new Ss($(t.latitude),$(t.longitude))},t.prototype.Wf=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.$f(t,e)}))},t.prototype.qf=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return Z(n)?t(n):n}(t);return null==n?null:this.$f(n,e);case"estimate":return this.Bf(tt(t));default:return null}},t.prototype.Bf=function(t){var e=Y(t);return new M(e.seconds,e.nanos)},t.prototype.Gf=function(t,e){var n=F.ct(t);d($n(n));var r=new x(n.get(1),n.get(3)),i=new B(n.X(5));return r.isEqual(e)||h("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}(),Oa=function(){function t(t,e,n,r,i){this.zf=t,this.Hf=e,this.S_=n,this.Jf=r,this.v_=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this.S_.path.et()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new _s(this.zf,this.v_,this.S_)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this.Jf},t.prototype.data=function(){if(this.Jf){if(this.v_){var t=new Ta(this.zf,this.Hf,this.S_,this.Jf,null);return this.v_.fromFirestore(t)}return this.Hf.$f(this.Jf.vt())}},t.prototype.get=function(t){if(this.Jf){var e=this.Jf.data().field(Na("DocumentSnapshot.get",t));if(null!==e)return this.Hf.$f(e)}},t}(),Ta=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Oa);function Na(t,e){return"string"==typeof e?Zs(t,e):e instanceof T?e._.d_:e.d_}function ja(t){if(Jt(t)&&0===t.Nt.length)throw new E(_.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Aa=function(){};function Sa(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o.Yf(t)}return t}var xa=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Xf=e,i.Zf=n,i.td=r,i.type="where",i}return Object(u.c)(e,t),e.prototype.Yf=function(t){var e=Rs(t.firestore),n=function(t,e,n,r,i,o,u){var s;if(i.ht()){if("array-contains"===o||"array-contains-any"===o)throw new E(_.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Va(u,o);for(var a=[],c=0,h=u;c<h.length;c++){var f=h[c];a.push(Ra(r,t,f))}s={arrayValue:{values:a}}}else s=Ra(r,t,u)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Va(u,o),s=Hs(n,"where",u,"in"===o||"not-in"===o);var l=At.create(i,o,s);return function(t,e){if(e.xt()){var n=Qt(t);if(null!==n&&!n.isEqual(e.field))throw new E(_.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Wt(t);null!==r&&Ma(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new E(_.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new E(_.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t.C_,0,e,t.firestore.I_,this.Xf,this.Zf,this.td);return new Es(t.firestore,t.v_,function(t,e){var n=t.filters.concat([e]);return new Gt(t.path,t.collectionGroup,t.Nt.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t.C_,n))},e}(Aa),Da=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Xf=e,r.ed=n,r.type="orderBy",r}return Object(u.c)(e,t),e.prototype.Yf=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new E(_.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new E(_.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ut(e,n);return function(t,e){if(null===Wt(t)){var n=Qt(t);null!==n&&Ma(t,n,e.field)}}(t,r),r}(t.C_,this.Xf,this.ed);return new Es(t.firestore,t.v_,function(t,e){var n=t.Nt.concat([e]);return new Gt(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t.C_,e))},e}(Aa),ka=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.nd=n,i.sd=r,i}return Object(u.c)(e,t),e.prototype.Yf=function(t){return new Es(t.firestore,t.v_,Zt(t.C_,this.nd,this.sd))},e}(Aa),Pa=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.rd=n,i.od=r,i}return Object(u.c)(e,t),e.prototype.Yf=function(t){var e=La(t,this.type,this.rd,this.od);return new Es(t.firestore,t.v_,function(t,e){return new Gt(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t.C_,e))},e}(Aa),Ca=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.rd=n,i.od=r,i}return Object(u.c)(e,t),e.prototype.Yf=function(t){var e=La(t,this.type,this.rd,this.od);return new Es(t.firestore,t.v_,function(t,e){return new Gt(t.path,t.collectionGroup,t.Nt.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t.C_,e))},e}(Aa);function La(t,e,n,r){if(n[0]instanceof T&&(n[0]=n[0]._),n[0]instanceof Oa)return function(t,e,n,r,i){if(!r)throw new E(_.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],u=0,s=$t(t);u<s.length;u++){var a=s[u];if(a.field.ht())o.push(ht(e,r.key));else{var c=r.field(a.field);if(Z(c))throw new E(_.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.ot();throw new E(_.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Vt(o,i)}(t.C_,t.firestore.I_,e,n[0].Jf,r);var i=Rs(t.firestore);return function(t,e,n,r,i,o){var u=t.Nt;if(i.length>u.length)throw new E(_.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var s=[],a=0;a<i.length;a++){var c=i[a];if(u[a].field.ht()){if("string"!=typeof c)throw new E(_.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Yt(t)&&-1!==c.indexOf("/"))throw new E(_.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(F.ct(c));if(!B.Et(h))throw new E(_.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new B(h);s.push(ht(e,f))}else{var l=Hs(n,r,c);s.push(l)}}return new Vt(s,o)}(t.C_,t.firestore.I_,i,e,n,r)}function Ra(t,e,n){if(n instanceof T&&(n=n._),"string"==typeof n){if(""===n)throw new E(_.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yt(e)&&-1!==n.indexOf("/"))throw new E(_.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(F.ct(n));if(!B.Et(r))throw new E(_.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return ht(t,new B(r))}if(n instanceof _s)return ht(t,n.S_);throw new E(_.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ys(n)+".")}function Va(t,e){if(!Array.isArray(t)||0===t.length)throw new E(_.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new E(_.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Ma(t,e,n){if(!n.isEqual(e))throw new E(_.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Ua(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}function qa(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Fa=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(u.c)(e,t),e.prototype.Uf=function(t){return new O(t)},e.prototype.Qf=function(t){var e=this.Gf(t,this.firestore.I_);return new _s(this.firestore,null,e)},e}(Ea),za=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Ga=function(t){function e(e,n,r,i,o,u){var s=this;return(s=t.call(this,e,n,r,i,u)||this).zf=e,s.ad=e,s.metadata=o,s}return Object(u.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this.Jf){if(this.v_){var e=new Ba(this.zf,this.Hf,this.S_,this.Jf,this.metadata,null);return this.v_.fromFirestore(e,t)}return this.Hf.$f(this.Jf.vt(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this.Jf){var n=this.Jf.data().field(Na("DocumentSnapshot.get",t));if(null!==n)return this.Hf.$f(n,e.serverTimestamps)}},e}(Oa),Ba=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Ga),Ka=function(){function t(t,e,n,r){this.zf=t,this.Hf=e,this.ud=r,this.metadata=new za(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.ud.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this.ud.docs.forEach((function(r){t.call(e,new Ba(n.zf,n.Hf,r.key,r,new za(n.ud.Ce.has(r.key),n.ud.fromCache),n.query.v_))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this.ud.Ne)throw new E(_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.hd&&this.ld===e||(this.hd=function(t,e){if(t.ud.De.nt()){var n=0;return t.ud.docChanges.map((function(e){var r=new Ba(t.zf,t.Hf,e.doc.key,e.doc,new za(t.ud.Ce.has(e.doc.key),t.ud.fromCache),t.query.v_);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t.ud.De;return t.ud.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Ba(t.zf,t.Hf,e.doc.key,e.doc,new za(t.ud.Ce.has(e.doc.key),t.ud.fromCache),t.query.v_),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Ha(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this.ld=e),this.hd},t}();function Ha(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return p()}}function Ja(t,e){return t instanceof Ga&&e instanceof Ga?t.zf===e.zf&&t.S_.isEqual(e.S_)&&(null===t.Jf?null===e.Jf:t.Jf.isEqual(e.Jf))&&t.v_===e.v_:t instanceof Ka&&e instanceof Ka&&t.zf===e.zf&&As(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.ud.isEqual(e.ud)}var Wa=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(u.c)(e,t),e.prototype.Uf=function(t){return new O(t)},e.prototype.Qf=function(t){var e=this.Gf(t,this.firestore.I_);return new _s(this.firestore,null,e)},e}(Ea);function Qa(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=ms(t,_s);var o=ms(t.firestore,ga),u=Rs(o);return e instanceof T&&(e=e._),$a(o,[("string"==typeof e||e instanceof cs?Ks(u,"updateDoc",t.S_,e,n,r):Bs(u,"updateDoc",t.S_,e)).F_(t.S_,Oe.exists(!0))])}function Ya(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t instanceof T&&(t=t._);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||Ua(i[a])||(s=i[a],a++);var c,h,f,l={includeMetadataChanges:s.includeMetadataChanges};if(Ua(i[a])){var p=i[a];i[a]=null===(e=p.next)||void 0===e?void 0:e.bind(p),i[a+1]=null===(n=p.error)||void 0===n?void 0:n.bind(p),i[a+2]=null===(r=p.complete)||void 0===r?void 0:r.bind(p)}if(t instanceof _s)h=ms(t.firestore,ga),f=Kt(t.S_.path),c={next:function(e){i[a]&&i[a](Xa(h,t,e))},error:i[a+1],complete:i[a+2]};else{var d=ms(t,Es);h=ms(d.firestore,ga),f=d.C_;var v=new Wa(h);c={next:function(t){i[a]&&i[a](new Ka(h,v,d,t))},error:i[a+1],complete:i[a+2]},ja(t.C_)}return function(t,e,n,r){var i=this,o=new as(r),s=new mu(e,o,n);return t.fs.ys((function(){return Object(u.b)(i,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return e=lu,[4,pa(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.r_(),t.fs.ys((function(){return Object(u.b)(i,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return e=pu,[4,pa(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(ba(h),f,l,c)}function $a(t,e){return function(t,e){var n=this,r=new Xn;return t.fs.ys((function(){return Object(u.b)(n,void 0,void 0,(function(){var n;return Object(u.d)(this,(function(i){switch(i.label){case 0:return n=xu,[4,la(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(ba(t),e)}function Xa(t,e,n){var r=n.docs.get(e.S_),i=new Wa(t);return new Ga(t,i,e.S_,r,new za(n.hasPendingWrites,n.fromCache),e.v_)}var Za=function(){function t(t,e){this.zf=t,this._d=e,this.fd=[],this.dd=!1,this.wd=Rs(t)}return t.prototype.set=function(t,e,n){this.Ed();var r=tc(t,this.zf),i=qa(r.v_,e,n),o=Vs(this.wd,"WriteBatch.set",r.S_,i,null!==r.v_,n);return this.fd.push(o.F_(r.S_,Oe.Wt())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this.Ed();var o,u=tc(t,this.zf);return e instanceof T&&(e=e._),o="string"==typeof e||e instanceof cs?Ks(this.wd,"WriteBatch.update",u.S_,e,n,r):Bs(this.wd,"WriteBatch.update",u.S_,e),this.fd.push(o.F_(u.S_,Oe.exists(!0))),this},t.prototype.delete=function(t){this.Ed();var e=tc(t,this.zf);return this.fd=this.fd.concat(new qe(e.S_,Oe.Wt())),this},t.prototype.commit=function(){return this.Ed(),this.dd=!0,this.fd.length>0?this._d(this.fd):Promise.resolve()},t.prototype.Ed=function(){if(this.dd)throw new E(_.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function tc(t,e){if(t instanceof T&&(t=t._),t.firestore!==e)throw new E(_.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var ec=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).zf=e,r}return Object(u.c)(e,t),e.prototype.get=function(e){var n=this,r=tc(e,this.zf),i=new Wa(this.zf);return t.prototype.get.call(this,e).then((function(t){return new Ga(n.zf,i,r.S_,t.Jf,new za(!1,!1),r.v_)}))},e}(function(){function t(t,e){this.zf=t,this.Td=e,this.wd=Rs(t)}return t.prototype.get=function(t){var e=this,n=tc(t,this.zf),r=new Fa(this.zf);return this.Td.ef([n.S_]).then((function(t){if(!t||1!==t.length)return p();var i=t[0];if(i instanceof It)return new Oa(e.zf,r,n.S_,null,n.v_);if(i instanceof wt)return new Oa(e.zf,r,i.key,i,n.v_);throw p()}))},t.prototype.set=function(t,e,n){var r=tc(t,this.zf),i=qa(r.v_,e,n),o=Vs(this.wd,"Transaction.set",r.S_,i,null!==r.v_,n);return this.Td.set(r.S_,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,u=tc(t,this.zf);return e instanceof T&&(e=e._),o="string"==typeof e||e instanceof cs?Ks(this.wd,"Transaction.update",u.S_,e,n,r):Bs(this.wd,"Transaction.update",u.S_,e),this.Td.update(u.S_,o),this},t.prototype.delete=function(t){var e=tc(t,this.zf);return this.Td.delete(e.S_),this},t}()),nc=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){_a(t=ms(t,ga));var n=ba(t),r=t.p_(),i=new ss;return Ia(n,i,new os(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){_a(t=ms(t,ga));var e=ba(t),n=t.p_(),r=new ss;return Ia(e,r,new us(r,n.cacheSizeBytes))}(t._)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t.R_&&!t.P_)throw new E(_.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Xn;return t.Mf.Tf((function(){return Object(u.b)(e,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return er.Wn()?(e=t+"main",[4,er.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Vi(t.I_,t.w_))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._)},t}(),rc=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n)||this).Id=r,i.INTERNAL={delete:function(){return i.terminate()}},e instanceof x||(i.md=e),i}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"I_",{get:function(){return this._.I_},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._.V_()),t)).merge,this._.g_(t)},e.prototype.useEmulator=function(t,e){"firestore.googleapis.com"!==this._.V_().host&&f("Host has been set in both settings() and useEmulator(), emulator host will be used"),this.settings({host:t+":"+e,ssl:!1,merge:!0})},e.prototype.enableNetwork=function(){return function(t){var e=this;return t.fs.enqueue((function(){return Object(u.b)(e,void 0,void 0,(function(){var e,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:return[4,ca(t)];case 1:return e=r.sent(),[4,fa(t)];case 2:return n=r.sent(),[2,(e.po(!0),function(t){var e=v(t);return e.Fh.delete(0),Uo(e)}(n))]}}))}))}))}(ba(ms(this._,ga)))},e.prototype.disableNetwork=function(){return function(t){var e=this;return t.fs.enqueue((function(){return Object(u.b)(e,void 0,void 0,(function(){var e,n;return Object(u.d)(this,(function(r){switch(r.label){case 0:return[4,ca(t)];case 1:return e=r.sent(),[4,fa(t)];case 2:return n=r.sent(),[2,(e.po(!1),function(t){return Object(u.b)(this,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return(e=v(t)).Fh.add(0),[4,qo(e)];case 1:return n.sent(),e.Mh.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(ba(ms(this._,ga)))},e.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&ps("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Id.enableMultiTabIndexedDbPersistence(this):this.Id.enableIndexedDbPersistence(this,n)},e.prototype.clearPersistence=function(){return this.Id.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.app._removeServiceInstance("firestore-exp"),this._._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Xn;return t.fs.ys((function(){return Object(u.b)(e,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(r){switch(r.label){case 0:return e=Ru,[4,la(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(ba(ms(this._,ga)))},e.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new as(e);return t.fs.ys((function(){return Object(u.b)(n,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){v(t).jh.add(e),e.next()},[4,pa(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.r_(),t.fs.ys((function(){return Object(u.b)(n,void 0,void 0,(function(){var e;return Object(u.d)(this,(function(n){switch(n.label){case 0:return e=function(t,e){v(t).jh.delete(e)},[4,pa(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(ba(t=ms(t,ga)),Ua(e)?e:{next:e})}(this._,t)},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.md)throw new E(_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.md},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new mc(this,Ts(this._,t))}catch(t){throw cc(t,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new ac(this,Ns(this._,t))}catch(t){throw cc(t,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new dc(this,function(t,e){if(t=ms(t,Is),fs("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new E(_.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Es(t,null,function(t){return new Gt(F.at(),t)}(e))}(this._,t))}catch(t){throw cc(t,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Xn;return t.fs.ys((function(){return Object(u.b)(n,void 0,void 0,(function(){var n;return Object(u.d)(this,(function(i){switch(i.label){case 0:return[4,function(t){return aa(t).then((function(t){return t.Dh}))}(t)];case 1:return n=i.sent(),new ra(t.fs,n,e,r).run(),[2]}}))}))})),r.promise}(ba(t),(function(n){return e(new ec(t,n))}))}(this._,(function(n){return t(new uc(e,n))}))},e.prototype.batch=function(){var t=this;return ba(this._),new sc(new Za(this._,(function(e){return $a(t._,e)})))},e.prototype.loadBundle=function(t){throw new E(_.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new E(_.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(T),ic=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(u.c)(e,t),e.prototype.Uf=function(t){return new A(new O(t))},e.prototype.Qf=function(t){var e=this.Gf(t,this.firestore.I_);return ac.Ad(e,this.firestore,null)},e}(Ea);function oc(t){var e;e=t,s.setLogLevel(e)}var uc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).zf=e,r}return Object(u.c)(e,t),e.prototype.get=function(t){var e=this,n=gc(t);return this._.get(n).then((function(t){return new lc(e.zf,t)}))},e.prototype.set=function(t,e,n){var r=gc(t);return n?(ls("Transaction.set",n),this._.set(r,e,n)):this._.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=gc(t);return 2===arguments.length?this._.update(s,e):(r=this._).update.apply(r,Object(u.g)([s,e,n],i)),this},e.prototype.delete=function(t){var e=gc(t);return this._.delete(e),this},e}(T),sc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.set=function(t,e,n){var r=gc(t);return n?(ls("WriteBatch.set",n),this._.set(r,e,n)):this._.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=gc(t);return 2===arguments.length?this._.update(s,e):(r=this._).update.apply(r,Object(u.g)([s,e,n],i)),this},e.prototype.delete=function(t){var e=gc(t);return this._.delete(e),this},e.prototype.commit=function(){return this._.commit()},e}(T),ac=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r.Hf=new ic(e),r}return Object(u.c)(e,t),e.Rd=function(t,n,r){if(t.length%2!=0)throw new E(_.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.ot()+" has "+t.length);return new e(n,new _s(n._,r,new B(t)))},e.Ad=function(t,n,r){return new e(n,new _s(n._,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new mc(this.firestore,this._.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new mc(this.firestore,Ts(this._,t))}catch(t){throw cc(t,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return t instanceof T&&(t=t._),t instanceof _s&&js(this._,t)},e.prototype.set=function(t,e){e=ls("DocumentReference.set",e);try{return function(t,e,n){t=ms(t,_s);var r=ms(t.firestore,ga),i=qa(t.v_,e,n);return $a(r,[Vs(Rs(r),"setDoc",t.S_,i,null!==t.v_,n).F_(t.S_,Oe.Wt())])}(this._,t,e)}catch(t){throw cc(t,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Qa(this._,t):Qa.apply(void 0,Object(u.g)([this._,t,e],n))}catch(t){throw cc(t,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return $a(ms((t=this._).firestore,ga),[new qe(t.S_,Oe.Wt())]);var t},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=hc(e),i=fc(e,(function(e){return new lc(t.firestore,new Ga(t.firestore._,t.Hf,e.S_,e.Jf,e.metadata,t._.v_))}));return Ya(this._,r,i)},e.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=ms(t,_s);var e=ms(t.firestore,ga),n=ba(e),r=new Wa(e);return function(t,e){var n=this,r=new Xn;return t.fs.ys((function(){return Object(u.b)(n,void 0,void 0,(function(){var n;return Object(u.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i;return Object(u.d)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=v(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Ic.Jo(t,e)}))}(t,e)];case 1:return(i=o.sent())instanceof wt?n.resolve(i):i instanceof It?n.resolve(null):n.reject(new E(_.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=hr(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,ha(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t.S_).then((function(n){return new Ga(e,r,t.S_,n,new za(n instanceof wt&&n.bt,!0),t.v_)}))}(this._):"server"===(null==t?void 0:t.source)?function(t){t=ms(t,_s);var e=ms(t.firestore,ga);return da(ba(e),t.S_,{source:"server"}).then((function(n){return Xa(e,t,n)}))}(this._):function(t){t=ms(t,_s);var e=ms(t.firestore,ga);return da(ba(e),t.S_).then((function(n){return Xa(e,t,n)}))}(this._)).then((function(t){return new lc(e.firestore,new Ga(e.firestore._,e.Hf,t.S_,t.Jf,t.metadata,e._.v_))}))},e.prototype.withConverter=function(t){return new e(this.firestore,this._.withConverter(t))},e}(T);function cc(t,e,n){return t.message=t.message.replace(e,n),t}function hc(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Ua(r))return r}return{}}function fc(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Ua(t[0])?t[0]:Ua(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var lc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).zf=e,r}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"ref",{get:function(){return new ac(this.zf,this._.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this._.data(t)},e.prototype.get=function(t,e){return this._.get(t,e)},e.prototype.isEqual=function(t){return Ja(this._,t._)},e}(T),pc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.prototype.data=function(t){return this._.data(t)},e}(lc),dc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r.Hf=new ic(e),r}return Object(u.c)(e,t),e.prototype.where=function(t,n,r){try{return new e(this.firestore,Sa(this._,function(t,e,n){var r=e,i=Na("where",t);return new xa(i,r,n)}(t,n,r)))}catch(t){throw cc(t,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,Sa(this._,function(t,e){void 0===e&&(e="asc");var n=e,r=Na("orderBy",t);return new Da(r,n)}(t,n)))}catch(t){throw cc(t,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,Sa(this._,function(t){return gs("limit",t),new ka("limit",t,"F")}(t)))}catch(t){throw cc(t,"limit()","Query.limit()")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,Sa(this._,function(t){return gs("limitToLast",t),new ka("limitToLast",t,"L")}(t)))}catch(t){throw cc(t,"limitToLast()","Query.limitToLast()")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Sa(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Pa("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw cc(t,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Sa(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Pa("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw cc(t,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Sa(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ca("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw cc(t,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Sa(this._,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ca("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw cc(t,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return As(this._,t._)},e.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=ms(t,Es);var e=ms(t.firestore,ga),n=ba(e),r=new Wa(e);return function(t,e){var n=this,r=new Xn;return t.fs.ys((function(){return Object(u.b)(n,void 0,void 0,(function(){var n;return Object(u.d)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(u.b)(this,void 0,void 0,(function(){var r,i,o,s,a;return Object(u.d)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,$i(t,e,!0)];case 1:return a=u.sent(),r=new Eu(e,a.Pc),i=r.dl(a.documents),o=r.Ti(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=hr(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,ha(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t.C_).then((function(n){return new Ka(e,r,t,n)}))}(this._):"server"===(null==t?void 0:t.source)?function(t){t=ms(t,Es);var e=ms(t.firestore,ga),n=ba(e),r=new Wa(e);return va(n,t.C_,{source:"server"}).then((function(n){return new Ka(e,r,t,n)}))}(this._):function(t){t=ms(t,Es);var e=ms(t.firestore,ga),n=ba(e),r=new Wa(e);return ja(t.C_),va(n,t.C_).then((function(n){return new Ka(e,r,t,n)}))}(this._)).then((function(t){return new yc(e.firestore,new Ka(e.firestore._,e.Hf,e._,t.ud))}))},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=hc(e),i=fc(e,(function(e){return new yc(t.firestore,new Ka(t.firestore._,t.Hf,t._,e.ud))}));return Ya(this._,r,i)},e.prototype.withConverter=function(t){return new e(this.firestore,this._.withConverter(t))},e}(T),vc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).zf=e,r}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new pc(this.zf,this._.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._.newIndex},enumerable:!1,configurable:!0}),e}(T),yc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).zf=e,r}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"query",{get:function(){return new dc(this.zf,this._.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this._.docs.map((function(e){return new pc(t.zf,e)}))},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var e=this;return this._.docChanges(t).map((function(t){return new vc(e.zf,t)}))},e.prototype.forEach=function(t,e){var n=this;this._.forEach((function(r){t.call(e,new pc(n.zf,r))}))},e.prototype.isEqual=function(t){return Ja(this._,t._)},e}(T),mc=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._=n,r}return Object(u.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._.parent;return t?new ac(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new ac(this.firestore,void 0===t?Ns(this._):Ns(this._,t))}catch(t){throw cc(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=ms(t.firestore,ga),r=Ns(t),i=qa(t.v_,e);return $a(n,[Vs(Rs(t.firestore),"addDoc",r.S_,i,null!==t.v_,{}).F_(r.S_,Oe.exists(!1))]).then((function(){return r}))}(this._,t).then((function(t){return new ac(e.firestore,t)}))},e.prototype.isEqual=function(t){return js(this._,t._)},e.prototype.withConverter=function(t){return new e(this.firestore,this._.withConverter(t))},e}(dc);function gc(t){return t instanceof T&&(t=t._),ms(t,_s)}var bc=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,new(cs.bind.apply(cs,Object(u.g)([void 0],e))))||this}return Object(u.c)(e,t),e.documentId=function(){return new e(G.lt().ot())},e.prototype.isEqual=function(t){return t instanceof T&&(t=t._),t instanceof cs&&this._.d_.isEqual(t.d_)},e}(T),wc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(u.c)(e,t),e.serverTimestamp=function(){var t=new qs("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new Ms("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Fs("arrayUnion",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new zs("arrayRemove",t)}.apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=function(t){return new Gs("increment",t)}(t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this._.isEqual(t._)},e}(T);!function(){function t(){this.Pd={},this.yd=new Xn,this.gd={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this.Pd={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this.yd.promise.catch(t)},t.prototype.then=function(t,e){return this.yd.promise.then(t,e)},t.prototype.Ul=function(t){this.Ql(t),this.Pd.complete&&this.Pd.complete(),this.yd.resolve(t)},t.prototype.Wl=function(t){this.gd.taskState="Error",this.Pd.next&&this.Pd.next(this.gd),this.Pd.error&&this.Pd.error(t),this.yd.reject(t)},t.prototype.Ql=function(t){this.gd=t,this.Pd.next&&this.Pd.next(t)}}()}).call(this,n("8oxB"))}}]);